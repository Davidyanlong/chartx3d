var _get=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Chartx=function(){"use strict";var t,e="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(t){return void 0===t?"undefined":_typeof2(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":_typeof2(t)},i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r={},s={},o=Array.prototype,a=Object.prototype,l=Function.prototype,h=o.push,u=o.slice,c=o.concat,d=a.toString,f=a.hasOwnProperty,p=o.forEach,v=o.map,y=o.filter,m=o.every,g=o.some,_=o.indexOf,x=Array.isArray,b=Object.keys,w=(l.bind,Math.pow(2,53)-1),k=(t="length",function(e){return null==e?void 0:e[t]}),S=function(t){var e=k(t);return"number"==typeof e&&e>=0&&e<=w};r.values=function(t){for(var e=r.keys(t),i=e.length,n=new Array(i),s=0;s<i;s++)n[s]=t[e[s]];return n},r.keys=b||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)r.has(t,i)&&e.push(i);return e},r.has=function(t,e){return f.call(t,e)};var C=r.each=r.forEach=function(t,e,i){if(null!=t)if(p&&t.forEach===p)t.forEach(e,i);else if(t.length===+t.length){for(var n=0,o=t.length;n<o;n++)if(e.call(i,t[n],n,t)===s)return}else{var a=r.keys(t);for(n=0,o=a.length;n<o;n++)if(e.call(i,t[a[n]],a[n],t)===s)return}};r.compact=function(t){return r.filter(t,r.identity)},r.filter=r.select=function(t,e,i){var n=[];return null==t?n:y&&t.filter===y?t.filter(e,i):(C(t,function(t,r,s){e.call(i,t,r,s)&&n.push(t)}),n)},C(["Arguments","Function","String","Number","Date","RegExp"],function(t){r["is"+t]=function(e){return d.call(e)=="[object "+t+"]"}}),r.isArguments=function(t){return!(!t||!r.has(t,"callee"))},r.isFunction=function(t){return"function"==typeof t},r.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},r.isNaN=function(t){return r.isNumber(t)&&t!=+t},r.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==d.call(t)},r.isNull=function(t){return null===t},r.isEmpty=function(t){if(null==t)return!0;if(r.isArray(t)||r.isString(t))return 0===t.length;for(var e in t)if(r.has(t,e))return!1;return!0},r.isElement=function(t){return!(!t||1!==t.nodeType)},r.isArray=x||function(t){return"[object Array]"==d.call(t)},r.isObject=function(t){return t===Object(t)},r.identity=function(t){return t},r.indexOf=function(t,e,i){if(null==t)return-1;var n=0,s=t.length;if(i){if("number"!=typeof i)return t[n=r.sortedIndex(t,e)]===e?n:-1;n=i<0?Math.max(0,s+i):i}if(_&&t.indexOf===_)return t.indexOf(e,i);for(;n<s;n++)if(t[n]===e)return n;return-1},r.isWindow=function(t){return null!=t&&t==t.window};r.flatten=function(t,e){return function t(e,i,n){return i&&r.every(e,r.isArray)?c.apply(n,e):(C(e,function(e){r.isArray(e)||r.isArguments(e)?i?h.apply(n,e):t(e,i,n):n.push(e)}),n)}(t,e,[])},r.every=r.all=function(t,e,i){e||(e=r.identity);var n=!0;return null==t?n:m&&t.every===m?t.every(e,i):(C(t,function(t,r,o){if(!(n=n&&e.call(i,t,r,o)))return s}),!!n)},r.min=function(t,e,i){if(!e&&r.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&r.isEmpty(t))return 1/0;var n={computed:1/0,value:1/0};return C(t,function(t,r,s){var o=e?e.call(i,t,r,s):t;o<n.computed&&(n={value:t,computed:o})}),n.value},r.max=function(t,e,i){if(!e&&r.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&r.isEmpty(t))return-1/0;var n={computed:-1/0,value:-1/0};return C(t,function(t,r,s){var o=e?e.call(i,t,r,s):t;o>n.computed&&(n={value:t,computed:o})}),n.value},r.find=r.detect=function(t,e,i){var n;return A(t,function(t,r,s){if(e.call(i,t,r,s))return n=t,!0}),n};var A=r.some=r.any=function(t,e,i){e||(e=r.identity);var n=!1;return null==t?n:g&&t.some===g?t.some(e,i):(C(t,function(t,r,o){if(n||(n=e.call(i,t,r,o)))return s}),!!n)};function L(t){return parseFloat(t.toPrecision(14))}r.without=function(t){return r.difference(t,u.call(arguments,1))},r.difference=function(t){var e=c.apply(o,u.call(arguments,1));return r.filter(t,function(t){return!r.contains(e,t)})},r.uniq=r.unique=function(t,e,i,n){r.isFunction(e)&&(n=i,i=e,e=!1);var s=i?r.map(t,i,n):t,o=[],a=[];return C(s,function(i,n){(e?n&&a[a.length-1]===i:r.contains(a,i))||(a.push(i),o.push(t[n]))}),o},r.map=r.collect=function(t,e,i){var n=[];return null==t?n:v&&t.map===v?t.map(e,i):(C(t,function(t,r,s){n.push(e.call(i,t,r,s))}),n)},r.contains=r.include=function(t,e){return null!=t&&(_&&t.indexOf===_?-1!=t.indexOf(e):A(t,function(t){return t===e}))},r.pluck=function(t,e){return r.map(t,function(t){return t[e]})},r.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},r.shuffle=function(t){return r.sample(t,1/0)},r.sample=function(t,e,i){if(null==e||i)return S(t)||(t=r.values(t)),t[r.random(t.length-1)];var n=S(t)?r.clone(t):r.values(t),s=k(n);e=Math.max(Math.min(e,s),0);for(var o=s-1,a=0;a<e;a++){var l=r.random(a,o),h=n[a];n[a]=n[l],n[l]=h}return n.slice(0,e)},r.extend=function(){var t,i,n,s,o=arguments[0]||{},a=1,l=arguments.length,h=!1;for("boolean"==typeof o&&(h=o,o=arguments[1]||{},a=2),"object"===(void 0===o?"undefined":e(o))||r.isFunction(o)||(o={}),l===a&&(o=this,--a);a<l;a++)if(null!=(t=arguments[a]))for(i in t)n=o[i],o!==(s=t[i])&&(h&&s&&r.isObject(s)&&s.constructor===Object?o[i]=r.extend(h,n,s):o[i]=s);return o},r.clone=function(t){return r.isObject(t)?r.isArray(t)?t.slice():r.extend(!0,{},t):t};var M=function(t,e,i){return r.uniq(function(t,e,i){t=r.without(t,void 0,null,"");var n=i&&i.scale?parseFloat(i.scale):1,s=i&&i.isInt?1:0;isNaN(n)&&(n=1);var o=r.max(t),a=o;o*=n;var l=r.min(t);if(l==o)return o>0?[l=0,o]:o<0?[o,0]:[0,o=1];var h=o-l;if(h){var u=l;(l-=.05*h)<0&&u>=0&&(l=0),o+=.05*h}var c=.3*(o-l);c=function(t,e){var i,n=[1,2,5,10];i=t/e;for(var r=0;r<n.length&&(t=n[r],!(i<=(n[r]+(n[r+1]||n[r]))/2));r++);return t*=e}(c,Math.pow(10,Math.floor(Math.log(c)/Math.LN10))),s&&(c=Math.ceil(c));var d,f,p=L(Math.floor(l/c)*c),v=L(Math.ceil(o/c)*c),y=[];for(d=p;d<=v&&(y.push(d),(d=L(d+c))!==f);)f=d;return y.length>=3&&y[y.length-2]>=a&&y.pop(),y}(t,0,i))},P=(function(){function t(e,n){i(this,t),this.layoutType="proportion",this.dataOrg=n||[],this.dataSection=[],this.dataSectionLayout=[],this.axisLength=1,this._cellCount=null,this._cellLength=null,this.waterLine=null,this.dataSectionGroup=[],this.middleweight=null,this.symmetric=!1,this.origin=null,this.originPos=0,this._originTrans=0,this._min=null,this._max=null,this.sort=null,this.posParseToInt=!1}n(t,[{key:"resetDataOrg",value:function(t){this.dataSection=[],this.dataSectionGroup=[],this.dataOrg=t,this._cellCount=null,this._cellLength=null}},{key:"calculateProps",value:function(){var t=this;"proportion"==this.layoutType&&(null==this._min&&(this._min=r.min(this.dataSection)),null==this._max&&(this._max=r.max(this.dataSection)),"origin"in this._opt||(this.origin=0,r.max(this.dataSection)<0&&(this.origin=r.max(this.dataSection)),r.min(this.dataSection)>0&&(this.origin=r.min(this.dataSection))),this._originTrans=this._getOriginTrans(this.origin),this.originPos=this.getPosOfVal(this.origin)),this.dataSectionLayout=[],r.each(this.dataSection,function(e,i){var n=i;"proportion"==t.layoutType&&(n=t.getIndexOfVal(e));var r=parseInt(t.getPosOf({ind:i,val:e}),10);t.dataSectionLayout.push({val:e,ind:n,pos:r})})}},{key:"setDataSection",value:function(){if(!this._opt.dataSection||this._opt.dataSection&&!this._opt.dataSection.length)if("proportion"==this.layoutType){var t=this._getDataSection();if(this.waterLine&&t.push(this.waterLine),"origin"in this._opt&&t.push(this._opt.origin),1==t.length&&t.push(2*t[0]),this.symmetric){var e=r.min(t),i=r.max(t);Math.abs(e)>Math.abs(i)?t.push(Math.abs(e)):t.push(-Math.abs(i))}for(var n=0,s=t.length;n<s;n++)t[n]=Number(t[n]),isNaN(t[n])&&(t.splice(n,1),n--,s--);if(this.dataSection=M(t,3),this.symmetric){e=r.min(this.dataSection),i=r.max(this.dataSection);Math.abs(e)>Math.abs(i)?this.dataSection.push(Math.abs(e)):this.dataSection.unshift(-Math.abs(i))}0==this.dataSection.length&&(this.dataSection=[0]),this.dataSectionGroup=[r.clone(this.dataSection)],this._middleweight(),this._sort()}else this.dataSection=r.flatten(this.dataOrg),this.dataSectionGroup=[this.dataSection];else this.dataSection=this._opt.dataSection,this.dataSectionGroup=[this.dataSection]}},{key:"_getDataSection",value:function(){var t=1;return r.each(this.dataOrg,function(e){t=Math.max(e.length,t)}),1==t?this._oneDimensional():t>1?this._twoDimensional():void 0}},{key:"_oneDimensional",value:function(){for(var t=r.flatten(this.dataOrg),e=0,i=t.length;e<i;e++)t[e]=t[e]||0;return t}},{key:"_twoDimensional",value:function(){var t,e=this.dataOrg,i=[];return r.each(e,function(e,n){if(e.length)if(r.isArray(e[0])){var s=[],o=e[0].length,a=e.length;for(n=0;n<o;n++){for(var l=0,h=0,u=0,c=0,d=0;d<a;d++){var f=e[d][n];(f||0===f)&&(null==t&&(t=f),t=Math.min(t,f),f>=0?(l+=f,h++):(u+=f,c++))}h&&s.push(l),c&&s.push(u)}i.push(s)}else i.push(e)}),i.push(t),r.flatten(i)}},{key:"setWaterLine",value:function(t){t<=this.waterLine||(this.waterLine=t,(t<r.min(this.dataSection)||t>r.max(this.dataSection))&&(this.setDataSection(),this.calculateProps()))}},{key:"_sort",value:function(){this.sort&&("desc"==this._getSortType()&&(this.dataSection.reverse(),r.each(this.dataSectionGroup,function(t,e){t.reverse()}),this.dataSectionGroup.reverse()))}},{key:"_getSortType",value:function(){var t;return r.isString(this.sort)&&(t=this.sort),t||(t="asc"),t}},{key:"_middleweight",value:function(){if(this.middleweight){r.isArray(this.middleweight)||(this.middleweight=[this.middleweight]);for(var t=r.min(this.dataSection),e=r.max(this.dataSection),i=[t],n=[],s=0,o=this.middleweight.length;s<o;s++){var a=t;s>0&&(a=this.middleweight[s-1]);var l=a+parseInt((this.middleweight[s]-a)/2);i.push(l),i.push(this.middleweight[s]),n.push([a,l,this.middleweight[s]])}var h=this.middleweight.slice(-1)[0];e>h&&(i.push(h+(e-h)/2),i.push(e),n.push([h,h+(e-h)/2,e])),this.dataSection=i,this.dataSectionGroup=n}}},{key:"_getOriginTrans",value:function(t){for(var e=0,i=this.dataSectionGroup.length,n=this.axisLength/i,s=0,o=i;s<o;s++){var a=this.dataSectionGroup[s];if("proportion"==this.layoutType){var l=r.min(a),h=r.max(a),u=Math.abs(h-l);if(t>=l&&t<=h){e=(t-l)/u*n+s*n;break}}}return"desc"==this.sort&&(e=-(n-e)),parseInt(e)}},{key:"_getLayoutDataOf",value:function(t){var e,i;return r.each(["val","ind","pos"],function(i){i in t&&(e=i)}),r.each(this.dataSectionLayout,function(n){n[e]===t[e]&&(i=n)}),i||{}}},{key:"getPosOfVal",value:function(t){return this.getPosOf({val:t})}},{key:"getPosOfInd",value:function(t){var e=this._getLayoutDataOf({ind:t}).pos;return null!=e?e:this.getPosOf({ind:t})}},{key:"getPosOf",value:function(t){var e,i=this._getCellCount();if("proportion"==this.layoutType)for(var n=this.dataSectionGroup.length,s=this.axisLength/n,o=0,a=n;o<a;o++){var l=this.dataSectionGroup[o],h=r.min(l),u=r.max(l),c="val"in t?t.val:this.getValOfInd(t.ind);if(c>=h&&c<=u){var d=this.origin;(d<h||d>u)&&(d=h);var f=Math.max(Math.abs(u-d),Math.abs(d-h));e=(c-d)/f*(f/Math.abs(u-h)*s)+o*s,isNaN(e)&&(e=parseInt(o*s));break}}else if(1==i)e=this.axisLength/2;else{var p="ind"in t?t.ind:this.getIndexOfVal(t.val);if(-1!=p&&("rule"==this.layoutType&&(e=p/(i-1)*this.axisLength),"peak"==this.layoutType)){var v=this.getCellLength();e=v*(p+1)-v/2}}return!e&&(e=0),e=Number(e.toFixed(1))+this._originTrans,Math.abs(e)}},{key:"getValOfPos",value:function(t){var e=this._getLayoutDataOf({pos:t}).val;return null!=e?e:this._getValOfInd(this.getIndexOfPos(t))}},{key:"getValOfInd",value:function(t,e){var i=this._getLayoutDataOf({ind:t}).val;return null!=i?i:(e||r.flatten(this.dataOrg))[t]}},{key:"_getValOfInd",value:function(t,e){var i,n=this,s=e||r.flatten(this.dataOrg);if("proportion"==this.layoutType){var o=this.axisLength/this.dataSectionGroup.length;r.each(this.dataSectionGroup,function(e,s){if(parseInt(t/o)==s||s==n.dataSectionGroup.length-1){var a=r.min(e),l=r.max(e);return i=a+(l-a)/o*(t-o*s),!1}})}else i=s[t];return i}},{key:"getIndexOfPos",value:function(t){var e=this._getLayoutDataOf({pos:t}).ind;if(null!=e)return e;var i=0,n=this.getCellLengthOfPos(t),r=this._getCellCount();return"proportion"==this.layoutType?t:("peak"==this.layoutType&&(i=parseInt(t/n))==r&&(i=r-1),"rule"==this.layoutType&&(i=parseInt((t+n/2)/n),1==r&&(i=0)),i)}},{key:"getIndexOfVal",value:function(t){var e=-1;if("proportion"==this.layoutType){var i=this._getLayoutDataOf({val:t}).ind;if(null!=i)return i;e=this.getPosOfVal(t)}else r.each(this.dataOrg,function(i){r.each(i,function(i){var n=r.indexOf(i,t);-1!=n&&(e=n)})});return e}},{key:"getCellLength",value:function(){if(null!==this._cellLength)return this._cellLength;var t=this.axisLength,e=t,i=this._getCellCount();return i&&("proportion"==this.layoutType?e=1:(e=t/i,"rule"==this.layoutType&&(e=1==i?t/2:t/(i-1)),this.posParseToInt&&(e=parseInt(e)))),this._cellLength=e,e}},{key:"getCellLengthOfPos",value:function(t){return this.getCellLength()}},{key:"getCellLengthOfInd",value:function(t){return this.getCellLength()}},{key:"_getCellCount",value:function(){if(null!==this._cellCount)return this._cellCount;var t=0;return"proportion"==this.layoutType?t=this.axisLength:this.dataOrg.length&&this.dataOrg[0].length&&this.dataOrg[0][0].length&&(t=this.dataOrg[0][0].length),this._cellCount=t,t}}])}(),window.devicePixelRatio,function(t,e){if(document[t]){return function e(i,n,r){if(i.length)for(var s=0;s<i.length;s++)e(i[s],n,r);else i[t](n,r,!1)}}return function t(i,n,r){if(i.length)for(var s=0;s<i.length;s++)t(i[s],n,r);else i[e]("on"+n,function(){return r.call(i,window.event)})}}),E=function(t){return r.isString(t)?document.getElementById(t):1==t.nodeType?t:t.length?t[0]:null},T=(P("addEventListener","attachEvent"),P("removeEventListener","detachEvent"),{colors:["#ff8533","#73ace6","#82d982","#e673ac","#cd6bed","#8282d9","#c0e650","#e6ac73","#6bcded","#73e6ac","#ed6bcd","#9966cc"],set:function(t){return this.colors=t,this.colors},get:function(){return this.colors}}),O={setGlobalTheme:function(t){T.set(t)},getGlobalTheme:function(){return T.get()},instances:{},getChart:function(t){return this.instances[t]},resize:function(){for(var t in this.instances)this.instances[t].resize()},getOptions:function(t,e){if(e||(e=this.options),e[t]){var i,n="[[JSON_FUN_PREFIX_",r="_JSON_FUN_SUFFIX]]";return i=decodeURIComponent(e[t]||{}),JSON.parse(i,function(t,e){return"string"==typeof e&&e.indexOf(r)>0&&0==e.indexOf(n)?new Function("return "+e.replace(n,"").replace(r,""))():e})||{}}}};var D,z,I,R,N=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"on",value:function(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}},{key:"has",value:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}},{key:"off",value:function(t,e){if(void 0!==this._listeners){var i=this._listeners[t];if(void 0!==i){var n=i.indexOf(e);-1!==n&&i.splice(n,1)}}}},{key:"fire",value:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=e.slice(0),n=0,r=i.length;n<r;n++)i[n].call(this,t)}}}}]),t}(),U=1,F=4,B=3,V=0,G=1,W=2,j=1,H=100,q=101,X=102,Y=200,Z=201,Q=202,K=203,J=204,tt=205,et=206,it=207,nt=208,rt=209,st=210,ot=1e3,at=1001,lt=1002,ht=1003,ut=1004,ct=1005,dt=1006,ft=1007,pt=1008,vt=1009,yt=1010,mt=1011,gt=1012,_t=1013,xt=1014,bt=1015,wt=1016,kt=1017,St=1018,Ct=1019,At=1021,Lt=1022,Mt=1023,Pt=1024,Et=1025,Tt=1026,Ot=1027,Dt=0,zt=function(){function t(e,i,n,r){_classCallCheck(this,t),this.x=e||0,this.y=i||0,this.z=n||0,this.w=void 0!==r?r:1,this.isVector4=!0}return _createClass(t,[{key:"set",value:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}},{key:"applyMatrix4",value:function(t){var e=this.x,i=this.y,n=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*e+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*e+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*e+s[7]*i+s[11]*n+s[15]*r,this}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}}]),t}(),It={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},euclideanModulo:function(t,e){return(t%e+e)%e},arrayMin:function(t){if(0===t.length)return 1/0;for(var e=t[0],i=1,n=t.length;i<n;++i)t[i]<e&&(e=t[i]);return e},arrayMax:function(t){if(0===t.length)return-1/0;for(var e=t[0],i=1,n=t.length;i<n;++i)t[i]>e&&(e=t[i]);return e},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},degToRad:function(t){return t*It.DEG2RAD},radToDeg:function(t){return t*It.RAD2DEG}},Rt=function(){function t(e,i,n){_classCallCheck(this,t),this.x=e||0,this.y=i||0,this.z=n||0,this.isVector3=!0}return _createClass(t,[{key:"set",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"setScalar",value:function(t){return this.x=t,this.y=t,this.z=t,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setZ",value:function(t){return this.z=t,this}},{key:"setComponent",value:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"add",value:function(t,e){return void 0!==e?(console.warn("Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}},{key:"sub",value:function(t,e){return void 0!==e?(console.warn("Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"multiply",value:function(t,e){return void 0!==e?(console.warn("Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}},{key:"applyMatrix3",value:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}},{key:"applyMatrix4",value:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements,s=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*s,this}},{key:"applyQuaternion",value:function(t){var e=this.x,i=this.y,n=this.z,r=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*n-o*i,h=a*i+o*e-r*n,u=a*n+r*i-s*e,c=-r*e-s*i-o*n;return this.x=l*a+c*-r+h*-o-u*-s,this.y=h*a+c*-s+u*-r-l*-o,this.z=u*a+c*-o+l*-s-h*-r,this}},{key:"project",value:function(t,e){return e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyMatrix4(e)}},{key:"unproject",value:function(t,e){return e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyMatrix4(e)}},{key:"transformDirection",value:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clampLength",value:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}},{key:"lerpVectors",value:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)}},{key:"cross",value:function(t,e){if(void 0!==e)return console.warn("Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e);var i=this.x,n=this.y,r=this.z;return this.x=n*t.z-r*t.y,this.y=r*t.x-i*t.z,this.z=i*t.y-n*t.x,this}},{key:"crossVectors",value:function(t,e){var i=t.x,n=t.y,r=t.z,s=e.x,o=e.y,a=e.z;return this.x=n*a-r*o,this.y=r*s-i*a,this.z=i*o-n*s,this}},{key:"projectOnVector",value:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)}},{key:"angleTo",value:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(It.clamp(e,-1,1))}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}},{key:"distanceToManhattan",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}},{key:"setFromSpherical",value:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this}},{key:"setFromCylindrical",value:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this}},{key:"setFromMatrixPosition",value:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}},{key:"setFromMatrixScale",value:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}},{key:"setFromMatrixColumn",value:function(t,e){return this.fromArray(t.elements,4*e)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}},{key:"fromArray",value:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}},{key:"toArray",value:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}},{key:"fromBufferAttribute",value:function(t,e,i){return void 0!==i&&console.warn("Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}},{key:"clampScalar",value:function(e,i){var n=new t,r=new t;return n.set(e,e,e),r.set(i,i,i),this.clamp(n,r)}}]),t}(),Nt=function(){function t(e,i,n,r){return _classCallCheck(this,t),this.r=1,this.g=1,this.b=1,this.a=1,this.isColor=!0,void 0===i&&void 0===n&&void 0===r?this.set(e):this.setRGBA(e,i,n,r)}return _createClass(t,[{key:"set",value:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}},{key:"setHex",value:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}},{key:"setRGB",value:function(t,e,i){return this.r=t,this.g=e,this.b=i,this}},{key:"setRGBA",value:function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this}},{key:"setStyle",value:function(t){var e;if(e=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var i,n=e[1],r=e[2];switch(n){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,i[5]&&(i[5]>1?this.a=Math.min(255,parseInt(i[5],10))/255:this.a=Math.min(1,i[5])),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,i[5]&&(i[5]>1?this.a=Math.min(255,parseInt(i[5],10))/255:this.a=Math.min(1,i[5])),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r)){var s=parseFloat(i[1])/360,o=parseInt(i[2],10)/100,a=parseInt(i[3],10)/100;return i[5]&&(i[5]>1?this.a=Math.min(255,parseInt(i[5],10))/255:this.a=Math.min(1,parseInt(i[5],10))),this.setHSL(s,o,a)}}}else if(e=/^\#([A-Fa-f0-9]+)$/.exec(t)){var l,h=(l=e[1]).length;if(3===h)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===h)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}t&&t.length>0&&(void 0!==(l=Ft[t])?this.setHex(l):console.warn("Color: Unknown color "+t));return this}},{key:"copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}},{key:"setHSL",value:function(t,e,i){return Ut.call(this,t,e,i)}},{key:"setHSLA",value:function(t,e,i,n){var r=Ut.call(this,t,e,i);return r.a=n,r}},{key:"getHSL",value:function(t){void 0===t&&(console.warn("Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,i,n=this.r,r=this.g,s=this.b,o=Math.max(n,r,s),a=Math.min(n,r,s),l=(a+o)/2;if(a===o)e=0,i=0;else{var h=o-a;switch(i=l<=.5?h/(o+a):h/(2-o-a),o){case n:e=(r-s)/h+(r<s?6:0);break;case r:e=(s-n)/h+2;break;case s:e=(n-r)/h+4}e/=6}return t.h=e,t.s=i,t.l=l,t}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b,this.a)}},{key:"copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}},{key:"multiplyScalar",value:function(t){return this.r*=t,this.g*=t,this.b*=t,this}},{key:"getHex",value:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}},{key:"getHexString",value:function(){return("000000"+this.getHex().toString(16)).slice(-6)}}]),t}(),Ut=function(){function t(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}return function(e,i,n){if(e=It.euclideanModulo(e,1),i=It.clamp(i,0,1),n=It.clamp(n,0,1),0===i)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+i):n+i-n*i,s=2*n-r;this.r=t(s,r,e+1/3),this.g=t(s,r,e),this.b=t(s,r,e-1/3)}return this}}(),Ft={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Bt=new Rt,Vt=new Rt,Gt=new Rt,Wt=new Rt,jt=new Rt,Ht=function(){function t(){_classCallCheck(this,t),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("Matrix4: the constructor no longer reads arguments. use .set() instead."),this.isMatrix4=!0}return _createClass(t,[{key:"set",value:function(t,e,i,n,r,s,o,a,l,h,u,c,d,f,p,v){var y=this.elements;return y[0]=t,y[4]=e,y[8]=i,y[12]=n,y[1]=r,y[5]=s,y[9]=o,y[13]=a,y[2]=l,y[6]=h,y[10]=u,y[14]=c,y[3]=d,y[7]=f,y[11]=p,y[15]=v,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new t).fromArray(this.elements)}},{key:"copy",value:function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}},{key:"copyPosition",value:function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}},{key:"extractBasis",value:function(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(t){var e=this.elements,i=t.elements,n=1/Bt.setFromMatrixColumn(t,0).length(),r=1/Bt.setFromMatrixColumn(t,1).length(),s=1/Bt.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,this}},{key:"makeRotationFromEuler",value:function(t){t&&t.isEuler||console.error("Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,i=t.x,n=t.y,r=t.z,s=Math.cos(i),o=Math.sin(i),a=Math.cos(n),l=Math.sin(n),h=Math.cos(r),u=Math.sin(r);if("XYZ"===t.order){var c=s*h,d=s*u,f=o*h,p=o*u;e[0]=a*h,e[4]=-a*u,e[8]=l,e[1]=d+f*l,e[5]=c-p*l,e[9]=-o*a,e[2]=p-c*l,e[6]=f+d*l,e[10]=s*a}else if("YXZ"===t.order){var v=a*h,y=a*u,m=l*h,g=l*u;e[0]=v+g*o,e[4]=m*o-y,e[8]=s*l,e[1]=s*u,e[5]=s*h,e[9]=-o,e[2]=y*o-m,e[6]=g+v*o,e[10]=s*a}else if("ZXY"===t.order){v=a*h,y=a*u,m=l*h,g=l*u;e[0]=v-g*o,e[4]=-s*u,e[8]=m+y*o,e[1]=y+m*o,e[5]=s*h,e[9]=g-v*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){c=s*h,d=s*u,f=o*h,p=o*u;e[0]=a*h,e[4]=f*l-d,e[8]=c*l+p,e[1]=a*u,e[5]=p*l+c,e[9]=d*l-f,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){var _=s*a,x=s*l,b=o*a,w=o*l;e[0]=a*h,e[4]=w-_*u,e[8]=b*u+x,e[1]=u,e[5]=s*h,e[9]=-o*h,e[2]=-l*h,e[6]=x*u+b,e[10]=_-w*u}else if("XZY"===t.order){_=s*a,x=s*l,b=o*a,w=o*l;e[0]=a*h,e[4]=-u,e[8]=l*h,e[1]=_*u+w,e[5]=s*h,e[9]=x*u-b,e[2]=b*u-x,e[6]=o*h,e[10]=w*u+_}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(t){var e=this.elements,i=t._x,n=t._y,r=t._z,s=t._w,o=i+i,a=n+n,l=r+r,h=i*o,u=i*a,c=i*l,d=n*a,f=n*l,p=r*l,v=s*o,y=s*a,m=s*l;return e[0]=1-(d+p),e[4]=u-m,e[8]=c+y,e[1]=u+m,e[5]=1-(h+p),e[9]=f-v,e[2]=c-y,e[6]=f+v,e[10]=1-(h+d),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"lookAt",value:function(t,e,i){var n=this.elements;return jt.subVectors(t,e),0===jt.lengthSq()&&(jt.z=1),jt.normalize(),Gt.crossVectors(i,jt),0===Gt.lengthSq()&&(1===Math.abs(i.z)?jt.x+=1e-4:jt.z+=1e-4,jt.normalize(),Gt.crossVectors(i,jt)),Gt.normalize(),Wt.crossVectors(jt,Gt),n[0]=Gt.x,n[4]=Wt.x,n[8]=jt.x,n[1]=Gt.y,n[5]=Wt.y,n[9]=jt.y,n[2]=Gt.z,n[6]=Wt.z,n[10]=jt.z,this}},{key:"multiply",value:function(t,e){return void 0!==e?(console.warn("Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyMatrices",value:function(t,e){var i=t.elements,n=e.elements,r=this.elements,s=i[0],o=i[4],a=i[8],l=i[12],h=i[1],u=i[5],c=i[9],d=i[13],f=i[2],p=i[6],v=i[10],y=i[14],m=i[3],g=i[7],_=i[11],x=i[15],b=n[0],w=n[4],k=n[8],S=n[12],C=n[1],A=n[5],L=n[9],M=n[13],P=n[2],E=n[6],T=n[10],O=n[14],D=n[3],z=n[7],I=n[11],R=n[15];return r[0]=s*b+o*C+a*P+l*D,r[4]=s*w+o*A+a*E+l*z,r[8]=s*k+o*L+a*T+l*I,r[12]=s*S+o*M+a*O+l*R,r[1]=h*b+u*C+c*P+d*D,r[5]=h*w+u*A+c*E+d*z,r[9]=h*k+u*L+c*T+d*I,r[13]=h*S+u*M+c*O+d*R,r[2]=f*b+p*C+v*P+y*D,r[6]=f*w+p*A+v*E+y*z,r[10]=f*k+p*L+v*T+y*I,r[14]=f*S+p*M+v*O+y*R,r[3]=m*b+g*C+_*P+x*D,r[7]=m*w+g*A+_*E+x*z,r[11]=m*k+g*L+_*T+x*I,r[15]=m*S+g*M+_*O+x*R,this}},{key:"multiplyScalar",value:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}},{key:"applyToBufferAttribute",value:function(t){for(var e=0,i=t.count;e<i;e++)Vt.x=t.getX(e),Vt.y=t.getY(e),Vt.z=t.getZ(e),Vt.applyMatrix4(this),t.setXYZ(e,Vt.x,Vt.y,Vt.z);return t}},{key:"determinant",value:function(){var t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],s=t[1],o=t[5],a=t[9],l=t[13],h=t[2],u=t[6],c=t[10],d=t[14];return t[3]*(+r*a*u-n*l*u-r*o*c+i*l*c+n*o*d-i*a*d)+t[7]*(+e*a*d-e*l*c+r*s*c-n*s*d+n*l*h-r*a*h)+t[11]*(+e*l*u-e*o*d-r*s*u+i*s*d+r*o*h-i*l*h)+t[15]*(-n*o*h-e*a*u+e*o*c+n*s*u-i*s*c+i*a*h)}},{key:"transpose",value:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}},{key:"setPosition",value:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this}},{key:"getInverse",value:function(t,e){var i=this.elements,n=t.elements,r=n[0],s=n[1],o=n[2],a=n[3],l=n[4],h=n[5],u=n[6],c=n[7],d=n[8],f=n[9],p=n[10],v=n[11],y=n[12],m=n[13],g=n[14],_=n[15],x=f*g*c-m*p*c+m*u*v-h*g*v-f*u*_+h*p*_,b=y*p*c-d*g*c-y*u*v+l*g*v+d*u*_-l*p*_,w=d*m*c-y*f*c+y*h*v-l*m*v-d*h*_+l*f*_,k=y*f*u-d*m*u-y*h*p+l*m*p+d*h*g-l*f*g,S=r*x+s*b+o*w+a*k;if(0===S){var C="Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(C);return console.warn(C),this.identity()}var A=1/S;return i[0]=x*A,i[1]=(m*p*a-f*g*a-m*o*v+s*g*v+f*o*_-s*p*_)*A,i[2]=(h*g*a-m*u*a+m*o*c-s*g*c-h*o*_+s*u*_)*A,i[3]=(f*u*a-h*p*a-f*o*c+s*p*c+h*o*v-s*u*v)*A,i[4]=b*A,i[5]=(d*g*a-y*p*a+y*o*v-r*g*v-d*o*_+r*p*_)*A,i[6]=(y*u*a-l*g*a-y*o*c+r*g*c+l*o*_-r*u*_)*A,i[7]=(l*p*a-d*u*a+d*o*c-r*p*c-l*o*v+r*u*v)*A,i[8]=w*A,i[9]=(y*f*a-d*m*a-y*s*v+r*m*v+d*s*_-r*f*_)*A,i[10]=(l*m*a-y*h*a+y*s*c-r*m*c-l*s*_+r*h*_)*A,i[11]=(d*h*a-l*f*a-d*s*c+r*f*c+l*s*v-r*h*v)*A,i[12]=k*A,i[13]=(d*m*o-y*f*o+y*s*p-r*m*p-d*s*g+r*f*g)*A,i[14]=(y*h*o-l*m*o-y*s*u+r*m*u+l*s*g-r*h*g)*A,i[15]=(l*f*o-d*h*o+d*s*u-r*f*u-l*s*p+r*h*p)*A,this}},{key:"scale",value:function(t){var e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}},{key:"getMaxScaleOnAxis",value:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}},{key:"makeTranslation",value:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}},{key:"makeRotationX",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}},{key:"makeRotationY",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=1-i,s=t.x,o=t.y,a=t.z,l=r*s,h=r*o;return this.set(l*s+i,l*o-n*a,l*a+n*o,0,l*o+n*a,h*o+i,h*a-n*s,0,l*a-n*o,h*a+n*s,r*a*a+i,0,0,0,0,1),this}},{key:"makeScale",value:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}},{key:"makeShear",value:function(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this}},{key:"compose",value:function(t,e,i){return this.makeRotationFromQuaternion(e),this.scale(i),this.setPosition(t),this}},{key:"decompose",value:function(t,e,i){return qt.bind(this)(t,e,i)}},{key:"makePerspective",value:function(t,e,i,n,r,s){void 0===s&&console.warn("Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,a=2*r/(e-t),l=2*r/(i-n),h=(e+t)/(e-t),u=(i+n)/(i-n),c=-(s+r)/(s-r),d=-2*s*r/(s-r);return o[0]=a,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(t,e,i,n,r,s){var o=this.elements,a=1/(e-t),l=1/(i-n),h=1/(s-r),u=(e+t)*a,c=(i+n)*l,d=(s+r)*h;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-c,o[2]=0,o[6]=0,o[10]=-2*h,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(t){for(var e=this.elements,i=t.elements,n=0;n<16;n++)if(e[n]!==i[n])return!1;return!0}},{key:"fromArray",value:function(t,e){void 0===e&&(e=0);for(var i=0;i<16;i++)this.elements[i]=t[i+e];return this}},{key:"toArray",value:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}]),t}(),qt=function(){var t=new Rt,e=new Ht;return function(i,n,r){var s=this.elements,o=t.set(s[0],s[1],s[2]).length(),a=t.set(s[4],s[5],s[6]).length(),l=t.set(s[8],s[9],s[10]).length();this.determinant()<0&&(o=-o),i.x=s[12],i.y=s[13],i.z=s[14],e.copy(this);var h=1/o,u=1/a,c=1/l;return e.elements[0]*=h,e.elements[1]*=h,e.elements[2]*=h,e.elements[4]*=u,e.elements[5]*=u,e.elements[6]*=u,e.elements[8]*=c,e.elements[9]*=c,e.elements[10]*=c,n.setFromRotationMatrix(e),r.x=o,r.y=a,r.z=l,this}}(),Xt=function(){function t(e,i){_classCallCheck(this,t),this.min=void 0!==e?e:new Rt(1/0,1/0,1/0),this.max=void 0!==i?i:new Rt(-1/0,-1/0,-1/0),this.isBox3=!0}return _createClass(t,[{key:"set",value:function(t,e){return this.min.copy(t),this.max.copy(e),this}},{key:"setFromArray",value:function(t){for(var e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0,a=0,l=t.length;a<l;a+=3){var h=t[a],u=t[a+1],c=t[a+2];h<e&&(e=h),u<i&&(i=u),c<n&&(n=c),h>r&&(r=h),u>s&&(s=u),c>o&&(o=c)}return this.min.set(e,i,n),this.max.set(r,s,o),this}},{key:"setFromBufferAttribute",value:function(t){for(var e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0,a=0,l=t.count;a<l;a++){var h=t.getX(a),u=t.getY(a),c=t.getZ(a);h<e&&(e=h),u<i&&(i=u),c<n&&(n=c),h>r&&(r=h),u>s&&(s=u),c>o&&(o=c)}return this.min.set(e,i,n),this.max.set(r,s,o),this}},{key:"setFromPoints",value:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}},{key:"setFromCenterAndSize",value:function(t,e){return Yt(t,e)}},{key:"setFromObject",value:function(t){return this.makeEmpty(),this.expandByObject(t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(t){var e=t||new Rt;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(t){var e=t||new Rt;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"expandByObject",value:function(t){return Zt.call(this,t)}},{key:"containsPoint",value:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}},{key:"containsBox",value:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}},{key:"getParameter",value:function(t,e){return(e||new Rt).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}},{key:"intersectsSphere",value:function(t){return Qt(t)}},{key:"intersectsPlane",value:function(t){var e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=t.constant&&i>=t.constant}},{key:"clampPoint",value:function(t,e){return(e||new Rt).copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return Kt.call(this,t)}},{key:"getBoundingSphere",value:function(t){return Jt.call(this,t)}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"applyMatrix4",value:function(t){return $t(t)}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}]),t}(),Yt=function(){var t=new Rt;return function(e,i){var n=t.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),Zt=function(){var t=new Rt;return function(e){var i=this;return e.updateMatrixWorld(!0),e.traverse(function(e){var n,r,s=e.geometry;if(void 0!==s)if(s.isGeometry){var o=s.vertices;for(n=0,r=o.length;n<r;n++)t.copy(o[n]),t.applyMatrix4(e.matrixWorld),i.expandByPoint(t)}else if(s.isBufferGeometry){var a=s.attributes.position;if(void 0!==a)for(n=0,r=a.count;n<r;n++)t.fromBufferAttribute(a,n).applyMatrix4(e.matrixWorld),i.expandByPoint(t)}}),this}}(),Qt=function(){var t=new Rt;return function(e){return this.clampPoint(e.center,t),t.distanceToSquared(e.center)<=e.radius*e.radius}}(),Kt=function(){var t=new Rt;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),Jt=function(){var t=new Rt;return function(e){var i=e||new te;return this.getCenter(i.center),i.radius=.5*this.getSize(t).length(),i}}(),$t=(D=[new Rt,new Rt,new Rt,new Rt,new Rt,new Rt,new Rt,new Rt],function(t){return this.isEmpty()?this:(D[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),D[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),D[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),D[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),D[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),D[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),D[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),D[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(D),this)}),te=function(){function t(e,i){_classCallCheck(this,t),this.center=void 0!==e?e:new Rt,this.radius=void 0!==i?i:0}return _createClass(t,[{key:"set",value:function(t,e){return this.center.copy(t),this.radius=e,this}},{key:"setFromPoints",value:function(t,e){var i=this.center,n=new Xt;void 0!==e?i.copy(e):n.setFromPoints(t).getCenter(i);for(var r=0,s=0,o=t.length;s<o;s++)r=Math.max(r,i.distanceToSquared(t[s]));return this.radius=Math.sqrt(r),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.center.copy(t.center),this.radius=t.radius,this}},{key:"empty",value:function(){return this.radius<=0}},{key:"containsPoint",value:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(t){return t.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}},{key:"intersectsBox",value:function(t){return t.intersectsSphere(this)}},{key:"intersectsPlane",value:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(t,e){var i=this.center.distanceToSquared(t),n=e||new Rt;return n.copy(t),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}},{key:"getBoundingBox",value:function(t){var e=t||new Xt;return e.set(this.center,this.center),e.expandByScalar(this.radius),e}},{key:"applyMatrix4",value:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}},{key:"translate",value:function(t){return this.center.add(t),this}},{key:"equals",value:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}]),t}(),ee=new Rt,ie=function(){function t(){_classCallCheck(this,t),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("Matrix3: the constructor no longer reads arguments. use .set() instead."),this.isMatrix3=!0}return _createClass(t,[{key:"set",value:function(t,e,i,n,r,s,o,a,l){var h=this.elements;return h[0]=t,h[1]=n,h[2]=o,h[3]=e,h[4]=r,h[5]=a,h[6]=i,h[7]=s,h[8]=l,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"copy",value:function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}},{key:"setFromMatrix4",value:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}},{key:"applyToBufferAttribute",value:function(t){for(var e=0,i=t.count;e<i;e++)ee.x=t.getX(e),ee.y=t.getY(e),ee.z=t.getZ(e),ee.applyMatrix3(this),t.setXYZ(e,ee.x,ee.y,ee.z);return t}},{key:"setUvTransform",value:function(t,e,i,n,r,s,o){var a=Math.cos(r),l=Math.sin(r);this.set(i*a,i*l,-i*(a*s+l*o)+s+t,-n*l,n*a,-n*(-l*s+a*o)+o+e,0,0,1)}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyMatrices",value:function(t,e){var i=t.elements,n=e.elements,r=this.elements,s=i[0],o=i[3],a=i[6],l=i[1],h=i[4],u=i[7],c=i[2],d=i[5],f=i[8],p=n[0],v=n[3],y=n[6],m=n[1],g=n[4],_=n[7],x=n[2],b=n[5],w=n[8];return r[0]=s*p+o*m+a*x,r[3]=s*v+o*g+a*b,r[6]=s*y+o*_+a*w,r[1]=l*p+h*m+u*x,r[4]=l*v+h*g+u*b,r[7]=l*y+h*_+u*w,r[2]=c*p+d*m+f*x,r[5]=c*v+d*g+f*b,r[8]=c*y+d*_+f*w,this}},{key:"multiplyScalar",value:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],h=t[8];return e*s*h-e*o*l-i*r*h+i*o*a+n*r*l-n*s*a}},{key:"getInverse",value:function(t,e){t&&t.isMatrix4&&console.error("Matrix3: .getInverse() no longer takes a Matrix4 argument.");var i=t.elements,n=this.elements,r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],h=i[5],u=i[6],c=i[7],d=i[8],f=d*l-h*c,p=h*u-d*a,v=c*a-l*u,y=r*f+s*p+o*v;if(0===y){var m="Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(m);return console.warn(m),this.identity()}var g=1/y;return n[0]=f*g,n[1]=(o*c-d*s)*g,n[2]=(h*s-o*l)*g,n[3]=p*g,n[4]=(d*r-o*u)*g,n[5]=(o*a-h*r)*g,n[6]=v*g,n[7]=(s*u-c*r)*g,n[8]=(l*r-s*a)*g,this}},{key:"transpose",value:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}},{key:"getNormalMatrix",value:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()}},{key:"transposeIntoArray",value:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}},{key:"equals",value:function(t){for(var e=this.elements,i=t.elements,n=0;n<9;n++)if(e[n]!==i[n])return!1;return!0}},{key:"fromArray",value:function(t,e){void 0===e&&(e=0);for(var i=0;i<9;i++)this.elements[i]=t[i+e];return this}},{key:"toArray",value:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}}]),t}(),ne=new Rt,re=new Rt,se=new Rt,oe=new Rt,ae=new ie,le=function(){function t(e,i){_classCallCheck(this,t),this.normal=void 0!==e?e:new Rt(1,0,0),this.constant=void 0!==i?i:0}return _createClass(t,[{key:"set",value:function(t,e){return this.normal.copy(t),this.constant=e,this}},{key:"setComponents",value:function(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}},{key:"setFromNormalAndCoplanarPoint",value:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(t,e,i){var n=ne.subVectors(i,e).cross(re.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this}},{key:"normalize",value:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(t){return this.normal.dot(t)+this.constant}},{key:"distanceToSphere",value:function(t){return this.distanceToPoint(t.center)-t.radius}},{key:"projectPoint",value:function(t,e){return(e||new Rt).copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}},{key:"intersectLine",value:function(t,e){var i=e||new Rt,n=t.delta(se),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?i.copy(t.start):void 0;var s=-(t.start.dot(this.normal)+this.constant)/r;return s<0||s>1?void 0:i.copy(n).multiplyScalar(s).add(t.start)}},{key:"intersectsLine",value:function(t){var e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}},{key:"intersectsBox",value:function(t){return t.intersectsPlane(this)}},{key:"intersectsSphere",value:function(t){return t.intersectsPlane(this)}},{key:"coplanarPoint",value:function(t){return(t||new Rt).copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(t,e){var i=e||ae.getNormalMatrix(t),n=this.coplanarPoint(oe).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}},{key:"translate",value:function(t){return this.constant-=t.dot(this.normal),this}},{key:"equals",value:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}]),t}(),he=function(){function t(e,i,n,r,s,o){_classCallCheck(this,t),this.planes=[void 0!==e?e:new le,void 0!==i?i:new le,void 0!==n?n:new le,void 0!==r?r:new le,void 0!==s?s:new le,void 0!==o?o:new le]}return _createClass(t,[{key:"set",value:function(t,e,i,n,r,s){var o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(n),o[4].copy(r),o[5].copy(s),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){for(var e=this.planes,i=0;i<6;i++)e[i].copy(t.planes[i]);return this}},{key:"setFromMatrix",value:function(t){var e=this.planes,i=t.elements,n=i[0],r=i[1],s=i[2],o=i[3],a=i[4],l=i[5],h=i[6],u=i[7],c=i[8],d=i[9],f=i[10],p=i[11],v=i[12],y=i[13],m=i[14],g=i[15];return e[0].setComponents(o-n,u-a,p-c,g-v).normalize(),e[1].setComponents(o+n,u+a,p+c,g+v).normalize(),e[2].setComponents(o+r,u+l,p+d,g+y).normalize(),e[3].setComponents(o-r,u-l,p-d,g-y).normalize(),e[4].setComponents(o-s,u-h,p-f,g-m).normalize(),e[5].setComponents(o+s,u+h,p+f,g+m).normalize(),this}},{key:"intersectsObject",value:function(t){return ue.bind(this)(t)}},{key:"intersectsSprite",value:function(t){return ce.bind(this)(t)}},{key:"intersectsSphere",value:function(t){for(var e=this.planes,i=t.center,n=-t.radius,r=0;r<6;r++){if(e[r].distanceToPoint(i)<n)return!1}return!0}},{key:"intersectsBox",value:function(t){return de.bind(this)(t)}},{key:"containsPoint",value:function(t){for(var e=this.planes,i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}}]),t}(),ue=(z=new te,function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),z.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(z)}),ce=function(){var t=new te;return function(e){return t.center.set(0,0,0),t.radius=.7071067811865476,t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),de=(I=new Rt,R=new Rt,function(t){for(var e=this.planes,i=0;i<6;i++){var n=e[i];I.x=n.normal.x>0?t.min.x:t.max.x,R.x=n.normal.x>0?t.max.x:t.min.x,I.y=n.normal.y>0?t.min.y:t.max.y,R.y=n.normal.y>0?t.max.y:t.min.y,I.z=n.normal.z>0?t.min.z:t.max.z,R.z=n.normal.z>0?t.max.z:t.min.z;var r=n.distanceToPoint(I),s=n.distanceToPoint(R);if(r<0&&s<0)return!1}return!0}),fe=function(){function t(e){_classCallCheck(this,t),this._gl=e,this.extensions={}}return _createClass(t,[{key:"get",value:function(t){var e=this.extensions[t];return void 0!==e?e:(null===(e=this._gl.getExtension(t))&&console.warn("WebGLRenderer: "+t+" extension not supported."),this.extensions[t]=e,e)}}]),t}(),pe=function(){function t(){_classCallCheck(this,t),this._properties=new WeakMap}return _createClass(t,[{key:"get",value:function(t){var e=this._properties.get(t);return void 0===e&&(e={},this._properties.set(t,e)),e}},{key:"remove",value:function(t){this._properties.delete(t)}},{key:"update",value:function(t,e,i){this._properties.get(t)[e]=i}},{key:"dispose",value:function(){this._properties=new WeakMap}}]),t}(),ve=function(){function t(e,i){_classCallCheck(this,t),i=i||{},this._gl=e,this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxCombinedTextures=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxVertexUniforms=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this.maxFragmentUniforms=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),this.maxVaryings=e.getParameter(e.MAX_VARYING_VECTORS),this.precision=void 0!==i.precision?i.precision:"highp",this.precision=this.getMaxPrecision(this.precision)}return _createClass(t,[{key:"getMaxPrecision",value:function(t){var e=this._gl;if("highp"===(t=t||"highp")){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}}]),t}(),ye=function(){function t(e){var i;_classCallCheck(this,t),this.gl=e,this._map=(_defineProperty(i={},ot,e.REPEAT),_defineProperty(i,at,e.CLAMP_TO_EDGE),_defineProperty(i,lt,e.MIRRORED_REPEAT),_defineProperty(i,ht,e.NEAREST),_defineProperty(i,ut,e.NEAREST_MIPMAP_NEAREST),_defineProperty(i,ct,e.NEAREST_MIPMAP_LINEAR),_defineProperty(i,dt,e.LINEAR),_defineProperty(i,ft,e.LINEAR_MIPMAP_NEAREST),_defineProperty(i,pt,e.LINEAR_MIPMAP_LINEAR),_defineProperty(i,vt,e.UNSIGNED_BYTE),_defineProperty(i,kt,e.UNSIGNED_SHORT_4_4_4_4),_defineProperty(i,St,e.UNSIGNED_SHORT_5_5_5_1),_defineProperty(i,Ct,e.UNSIGNED_SHORT_5_6_5),_defineProperty(i,yt,e.BYTE),_defineProperty(i,mt,e.SHORT),_defineProperty(i,gt,e.UNSIGNED_SHORT),_defineProperty(i,_t,e.INT),_defineProperty(i,xt,e.UNSIGNED_INT),_defineProperty(i,bt,e.FLOAT),_defineProperty(i,At,e.ALPHA),_defineProperty(i,Lt,e.RGB),_defineProperty(i,Mt,e.RGBA),_defineProperty(i,Pt,e.LUMINANCE),_defineProperty(i,Et,e.LUMINANCE_ALPHA),_defineProperty(i,Tt,e.DEPTH_COMPONENT),_defineProperty(i,Ot,e.DEPTH_STENCIL),_defineProperty(i,H,e.FUNC_ADD),_defineProperty(i,q,e.FUNC_SUBTRACT),_defineProperty(i,X,e.FUNC_REVERSE_SUBTRACT),_defineProperty(i,Y,e.ZERO),_defineProperty(i,Z,e.ONE),_defineProperty(i,Q,e.SRC_COLOR),_defineProperty(i,K,e.ONE_MINUS_SRC_COLOR),_defineProperty(i,J,e.SRC_ALPHA),_defineProperty(i,tt,e.ONE_MINUS_SRC_ALPHA),_defineProperty(i,et,e.DST_ALPHA),_defineProperty(i,it,e.ONE_MINUS_DST_ALPHA),_defineProperty(i,nt,e.DST_COLOR),_defineProperty(i,rt,e.ONE_MINUS_DST_COLOR),_defineProperty(i,st,e.SRC_ALPHA_SATURATE),i)}return _createClass(t,[{key:"convert",value:function(t){return void 0!==this._map[t]?this._map[t]:0}}]),t}(),me=function(){function t(e){_classCallCheck(this,t),this.gl=e,this._currentColorMask=null,this._currentColorClear=new zt(0,0,0,0)}return _createClass(t,[{key:"setMask",value:function(t){this._currentColorMask!==t&&(this.gl.colorMask(t,t,t,t),this._currentColorMask=t)}},{key:"setClear",value:function(t,e,i,n,r){!0===r&&(t*=n,e*=n,i*=n);var s=new zt(t,e,i,n);!1===this._currentColorClear.equals(s)&&(this.gl.clearColor(t,e,i,n),this._currentColorClear.copy(s)),s=null}},{key:"reset",value:function(){this._currentColorMask=null,this._currentColorClear.set(-1,0,0,0)}}]),t}(),ge=function(){function t(e){_classCallCheck(this,t),this.gl=e,this._currentDepthFunc=null,this._currentDepthClear=null,this._currentDepthMask=null,this._switch=new be(e)}return _createClass(t,[{key:"setTest",value:function(t){var e=this.gl;t?this._switch.enable(e.DEPTH_TEST):this._switch.disable(e.DEPTH_TEST)}},{key:"setMask",value:function(t){var e=this.gl;this._currentDepthMask!==t&&(e.depthMask(t),this._currentDepthMask=t)}},{key:"setClear",value:function(t){var e=this.gl;this._currentDepthClear!==t&&(e.clearDepth(t),this._currentDepthClear=t)}},{key:"setFunc",value:function(t){var e=this.gl;if(this._currentDepthFunc!==t){if(t)switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case B:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);this._currentDepthFunc=t}}},{key:"reset",value:function(){this._currentDepthMask=null,this._currentDepthFunc=null,this._currentDepthClear=null}}]),t}(),_e=function(){function t(e){_classCallCheck(this,t),this.gl=e,this.switch=new be(e),this._currentStencilClear=null}return _createClass(t,[{key:"setTest",value:function(t){var e=this.gl;t?this.switch.enable(e.STENCIL_TEST):this.switch.disable(e.STENCIL_TEST)}},{key:"setClear",value:function(t){this._currentStencilClear!==t&&(this.gl.clearStencil(t),this._currentStencilClear=t)}},{key:"reset",value:function(){this._currentStencilClear=null}}]),t}(),xe={},be=function(){function t(e){_classCallCheck(this,t),this.gl=e}return _createClass(t,[{key:"enable",value:function(t){!0!==xe[t]&&(this.gl.enable(t),xe[t]=!0)}},{key:"disable",value:function(t){!1!==xe[t]&&(this.gl.disable(t),xe[t]=!1)}},{key:"reset",value:function(){xe={}}}]),t}(),we=function(){function t(e,i,n){_classCallCheck(this,t),this.gl=e,this._extensions=i;var r=n.maxAttributes;this._newAttributes=new Uint8Array(r),this._enabledAttributes=new Uint8Array(r),this._attributeDivisors=new Uint8Array(r)}return _createClass(t,[{key:"initAttributes",value:function(){for(var t=0,e=this._newAttributes.length;t<e;t++)this._newAttributes[t]=0}},{key:"enableAttributeAndDivisor",value:function(t,e){(this._newAttributes[t]=1,0===this._enabledAttributes[t]&&(this.gl.enableVertexAttribArray(t),this._enabledAttributes[t]=1),this._attributeDivisors[t]!==e)&&(this._extensions.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(t,e),this._attributeDivisors[t]=e)}},{key:"disableUnusedAttributes",value:function(){for(var t=0,e=this._enabledAttributes.length;t!==e;++t)this._enabledAttributes[t]!==this._newAttributes[t]&&(this.gl.disableVertexAttribArray(t),this._enabledAttributes[t]=0)}},{key:"reset",value:function(){for(var t=0;t<this._enabledAttributes.length;t++)1===this._enabledAttributes[t]&&(this.gl.disableVertexAttribArray(t),this._enabledAttributes[t]=0)}}]),t}(),ke=function(){function t(e){_classCallCheck(this,t),this.gl=e,this._currentBlendEquation=null,this._currentBlendSrc=null,this._currentBlendDst=null,this._currentBlendEquationAlpha=null,this._currentBlendSrcAlpha=null,this._currentBlendDstAlpha=null,this._switch=new be(e)}return _createClass(t,[{key:"setBlending",value:function(t,e,i,n,r,s,o,a){var l=this.gl,h=new ye(l);if(0!==t?this._switch.enable(l.BLEND):this._switch.disable(l.BLEND),5!==t){if(t!==this._currentBlending||a!==this._currentPremultipledAlpha)switch(t){case 2:a?(l.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),l.blendFuncSeparate(l.ONE,l.ONE,l.ONE,l.ONE)):(l.blendEquation(l.FUNC_ADD),l.blendFunc(l.SRC_ALPHA,l.ONE));break;case 3:a?(l.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),l.blendFuncSeparate(l.ZERO,l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ONE_MINUS_SRC_ALPHA)):(l.blendEquation(l.FUNC_ADD),l.blendFunc(l.ZERO,l.ONE_MINUS_SRC_COLOR));break;case 4:a?(l.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),l.blendFuncSeparate(l.ZERO,l.SRC_COLOR,l.ZERO,l.SRC_ALPHA)):(l.blendEquation(l.FUNC_ADD),l.blendFunc(l.ZERO,l.SRC_COLOR));break;default:a?(l.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),l.blendFuncSeparate(l.ONE,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA)):(l.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),l.blendFuncSeparate(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA))}this._currentBlendEquation=null,this._currentBlendSrc=null,this._currentBlendDst=null,this._currentBlendEquationAlpha=null,this._currentBlendSrcAlpha=null,this._currentBlendDstAlpha=null}else r=r||e,s=s||i,o=o||n,e===this._currentBlendEquation&&r===this._currentBlendEquationAlpha||(l.blendEquationSeparate(h.convert(e),h.convert(r)),this._currentBlendEquation=e,this._currentBlendEquationAlpha=r),i===this._currentBlendSrc&&n===this._currentBlendDst&&s===this._currentBlendSrcAlpha&&o===this._currentBlendDstAlpha||(l.blendFuncSeparate(h.convert(i),h.convert(n),h.convert(s),h.convert(o)),this._currentBlendSrc=i,this._currentBlendDst=n,this._currentBlendSrcAlpha=s,this._currentBlendDstAlpha=o);this._currentBlending=t,this._currentPremultipledAlpha=a,h=null}},{key:"reset",value:function(){this._currentBlendEquation=null,this._currentBlendSrc=null,this._currentBlendDst=null,this._currentBlendEquationAlpha=null,this._currentBlendSrcAlpha=null,this._currentBlendDstAlpha=null}}]),t}(),Se=function(){function t(e,i){_classCallCheck(this,t),this.gl=e,this._capabilities=i,this._currentTextureSlot=null,this._currentBoundTextures={},this._currentTextureSlot=null,this._emptyTextures={},this._emptyTextures[e.TEXTURE_2D]=this.createTexture(e.TEXTURE_2D,e.TEXTURE_2D,1),this._emptyTextures[e.TEXTURE_CUBE_MAP]=this.createTexture(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6)}return _createClass(t,[{key:"createTexture",value:function(t,e,i){var n=this.gl,r=new Uint8Array(4),s=n.createTexture();n.bindTexture(t,s),n.texParameteri(t,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(t,n.TEXTURE_MAG_FILTER,n.NEAREST);for(var o=0;o<i;o++)n.texImage2D(e+o,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,r);return s}},{key:"activeTexture",value:function(t){var e=this.gl,i=this._capabilities.maxCombinedTextures;void 0===t&&(t=e.TEXTURE0+i-1),this._currentTextureSlot!==t&&(e.activeTexture(t),this._currentTextureSlot=t)}},{key:"bindTexture",value:function(t,e){var i=this.gl;null===this._currentTextureSlot&&this.activeTexture();var n=this._currentBoundTextures[this._currentTextureSlot];void 0===n&&(n={type:void 0,texture:void 0},this._currentBoundTextures[this._currentTextureSlot]=n),n.type===t&&n.texture===e||(i.bindTexture(t,e||this._emptyTextures[t]),n.type=t,n.texture=e)}},{key:"texImage2D",value:function(){var t=this.gl;try{t.texImage2D.apply(t,arguments)}catch(t){console.error("WebGLState:",t)}}},{key:"reset",value:function(){this._currentTextureSlot=null,this._currentBoundTextures={},this._currentTextureSlot=null}}]),t}();var Ce=function(){function t(e,i,n){_classCallCheck(this,t),this.gl=e,this.buffers={color:new me(e),depth:new ge(e),stencil:new _e(e)},this._attributeSwitch=new we(e,i,n),this._switch=new be(e),this._currentProgram=null,this._blendingState=new ke(e),this._currentFlipSided=null,this._currentPolygonOffsetFactor=null,this._currentPolygonOffsetUnits=null,this._currentLineWidth=null,this._textureState=new Se(e,n),this._currentViewport=new zt,this._initState(e)}return _createClass(t,[{key:"_initState",value:function(t){this.buffers.color.setClear(1,1,1,1),this.buffers.depth.setClear(1),this.buffers.stencil.setClear(0),this._switch.enable(t.DEPTH_TEST),this.buffers.depth.setFunc(B),this.setFlipSided(!1),this.setCullFace(1),this._switch.enable(t.CULL_FACE),this._switch.enable(t.BLEND),this.setBlending(j)}},{key:"initAttributes",value:function(){this._attributeSwitch.initAttributes()}},{key:"enableAttribute",value:function(t){this._attributeSwitch.enableAttributeAndDivisor(t,0)}},{key:"disableUnusedAttributes",value:function(){this._attributeSwitch.disableUnusedAttributes()}},{key:"enableAttributeAndDivisor",value:function(t,e){this._attributeSwitch.enableAttributeAndDivisor(t,e)}},{key:"enable",value:function(t){this._switch.enable(t)}},{key:"disable",value:function(t){this._switch.disable(t)}},{key:"useProgram",value:function(t){return this._currentProgram!==t&&(this.gl.useProgram(t),this._currentProgram=t,!0)}},{key:"setBlending",value:function(t,e,i,n,r,s,o,a){this._blendingState.setBlending(t,e,i,n,r,s,o,a)}},{key:"setMaterial",value:function(t,e){var i=this.gl,n=this.buffers.depth,r=this.buffers.color;t.side===W?this._switch.disable(i.CULL_FACE):this._switch.enable(i.CULL_FACE);var s=t.side===G;e&&(s=!s),this.setFlipSided(s),!0===t.transparent?this.setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):this.setBlending(0),n.setFunc(t.depthFunc),n.setTest(t.depthTest),n.setMask(t.depthWrite),r.setMask(t.colorWrite),this.setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)}},{key:"setFlipSided",value:function(t){var e=this.gl;this._currentFlipSided!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),this._currentFlipSided=t)}},{key:"setPolygonOffset",value:function(t,e,i){var n=this.gl;t?(this._switch.enable(n.POLYGON_OFFSET_FILL),this._currentPolygonOffsetFactor===e&&this._currentPolygonOffsetUnits===i||(n.polygonOffset(e,i),this._currentPolygonOffsetFactor=e,this._currentPolygonOffsetUnits=i)):this._switch.disable(n.POLYGON_OFFSET_FILL)}},{key:"setCullFace",value:function(t){var e=this.gl;0!==t?(this._switch.enable(e.CULL_FACE),t!==this._currentCullFace&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):this._switch.disable(e.CULL_FACE),this._currentCullFace=t}},{key:"setLineWidth",value:function(t){var e,i,n;t!==this._currentLineWidth&&(e=this.gl,i=!1,-1!==(n=e.getParameter(e.VERSION)).indexOf("WebGL")?i=parseFloat(/^WebGL\ ([0-9])/.exec(n)[1])>=1:-1!==n.indexOf("OpenGL ES")&&(i=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(n)[1])>=2),i&&this.gl.lineWidth(t),this._currentLineWidth=t)}},{key:"activeTexture",value:function(t){this._textureState.activeTexture(t)}},{key:"bindTexture",value:function(t,e){this._textureState.bindTexture(t,e)}},{key:"texImage2D",value:function(){this._textureState.texImage2D.apply(this,arguments)}},{key:"viewport",value:function(t){var e=this.gl;!1===this._currentViewport.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),this._currentViewport.copy(t))}},{key:"reset",value:function(){this._attributeSwitch.reset(),this._switch.reset(),this._textureState.reset(),this._currentProgram=null,this._blendingState.reset(),this._currentFlipSided=null,this._currentCullFace=null,this.buffers.color.reset(),this.buffers.depth.reset(),this.buffers.stencil.reset()}}]),t}(),Ae=function(){function t(e){_classCallCheck(this,t),this._buffers=new WeakMap,this.gl=e}return _createClass(t,[{key:"createBuffer",value:function(t,e){var i=this.gl,n=t.array,r=t.dynamic?i.DYNAMIC_DRAW:i.STATIC_DRAW,s=i.createBuffer();return i.bindBuffer(e,s),i.bufferData(e,n,r),t.onUploadCallback(),{buffer:s,type:function(t,e){var i=t.FLOAT;e instanceof Float32Array?i=t.FLOAT:e instanceof Float64Array?console.warn("WebGLAttributes: Unsupported data buffer format: Float64Array."):e instanceof Uint16Array?i=t.UNSIGNED_SHORT:e instanceof Int16Array?i=t.SHORT:e instanceof Uint32Array?i=t.UNSIGNED_INT:e instanceof Int32Array?i=t.INT:e instanceof Int8Array?i=t.BYTE:e instanceof Uint8Array&&(i=t.UNSIGNED_BYTE);return i}(i,n),bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}},{key:"updateBuffer",value:function(t,e,i){var n=this.gl,r=e.array,s=e.updateRange;n.bindBuffer(i,t),!1===e.dynamic?n.bufferData(i,r,n.STATIC_DRAW):-1===s.count?n.bufferSubData(i,0,r):0===s.count?console.error("WebGLObjects.updateBuffer: dynamic BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(n.bufferSubData(i,s.offset*r.BYTES_PER_ELEMENT,r.subarray(s.offset,s.offset+s.count)),s.count=-1)}},{key:"get",value:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),this._buffers.get(t)}},{key:"remove",value:function(t){var e=this.gl;t.isInterleavedBufferAttribute&&(t=t.data);var i=this._buffers.get(t);i&&(e.deleteBuffer(i.buffer),this._buffers.delete(t))}},{key:"update",value:function(t,e){t.isInterleavedBufferAttribute&&(t=t.data);var i=this._buffers.get(t);void 0===i?this._buffers.set(t,this.createBuffer(t,e)):i.version<t.version&&(this.updateBuffer(i.buffer,t,e),i.version=t.version)}}]),t}();var Le,Me,Pe=function(){function t(e,i){_classCallCheck(this,t),this.x=e||0,this.y=i||0,this.isVector2=!0}return _createClass(t,[{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"add",value:function(t,e){return void 0!==e?(console.warn("Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}},{key:"sub",value:function(t,e){return void 0!==e?(console.warn("Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"fromBufferAttribute",value:function(t,e,i){return void 0!==i&&console.warn("Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}},{key:"width",get:function(){return this.x},set:function(t){this.x=t}},{key:"height",get:function(){return this.y},set:function(t){this.y=t}}]),t}(),Ee=function(){function t(e,i,n){if(_classCallCheck(this,t),Array.isArray(e))throw new TypeError("BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=i,this.count=void 0!==e?e.length/i:0,this.normalized=!0===n,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0,this.isBufferAttribute=!0}return _createClass(t,[{key:"onUploadCallback",value:function(){}},{key:"setDynamic",value:function(t){return this.dynamic=t,this}},{key:"copyVector3sArray",value:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var s=t[n];void 0===s&&(console.warn("BufferAttribute.copyVector3sArray(): vector is undefined",n),s=new Rt),e[i++]=s.x,e[i++]=s.y,e[i++]=s.z}return this}},{key:"copyColorsArray",value:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var s=t[n];void 0===s&&(console.warn("BufferAttribute.copyColorsArray(): color is undefined",n),s=new Nt),e[i++]=s.r,e[i++]=s.g,e[i++]=s.b}return this}},{key:"copyArray",value:function(t){return this.array.set(t),this}},{key:"getX",value:function(t){return this.array[t*this.itemSize]}},{key:"setX",value:function(t,e){return this.array[t*this.itemSize]=e,this}},{key:"getY",value:function(t){return this.array[t*this.itemSize+1]}},{key:"setY",value:function(t,e){return this.array[t*this.itemSize+1]=e,this}},{key:"getZ",value:function(t){return this.array[t*this.itemSize+2]}},{key:"setZ",value:function(t,e){return this.array[t*this.itemSize+2]=e,this}},{key:"getW",value:function(t){return this.array[t*this.itemSize+3]}},{key:"setW",value:function(t,e){return this.array[t*this.itemSize+3]=e,this}},{key:"setXY",value:function(t,e,i){return this.setX(t,e),this.setY(t,i),this}},{key:"setXYZ",value:function(t,e,i,n){return this.setXY(t,e,i),this.setZ(t,n),this}},{key:"setXYZW",value:function(t,e,i,n,r){return this.setXYZ(t,e,i,n),this.setW(t,r),this}},{key:"copyVector2sArray",value:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var s=t[n];void 0===s&&(console.warn("BufferAttribute.copyVector2sArray(): vector is undefined",n),s=new Pe),e[i++]=s.x,e[i++]=s.y}return this}},{key:"needsUpdate",set:function(t){!0===t&&this.version++}}]),t}(),Te=function(t){function e(t,i,n){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,new Uint16Array(t),i,n))}return _inherits(e,Ee),e}(),Oe=function(t){function e(t,i,n){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,new Uint32Array(t),i,n))}return _inherits(e,Ee),e}(),De=function(t){function e(t,i,n){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,new Float32Array(t),i,n))}return _inherits(e,Ee),e}(),ze=function(){function t(){_classCallCheck(this,t),this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}return _createClass(t,[{key:"computeGroups",value:function(t){var e=void 0,i=[],n=void 0,r=t.faces,s=0;for(s=0;s<r.length;s++){var o=r[s];o.materialIndex!==n&&(n=o.materialIndex,void 0!==e&&(e.count=3*s-e.start,i.push(e)),e={start:3*s,materialIndex:n})}void 0!==e&&(e.count=3*s-e.start,i.push(e)),this.groups=i}},{key:"fromGeometry",value:function(t){for(var e=t.faces,i=t.vertices,n=t.faceVertexUvs,r=n[0]&&n[0].length>0,s=n[1]&&n[1].length>0,o=0;o<e.length;o++){var a=e[o];this.vertices.push(i[a.a],i[a.b],i[a.c]);var l=a.vertexNormals;if(3===l.length)this.normals.push(l[0],l[1],l[2]);else{var h=a.normal;this.normals.push(h,h,h)}var u,c=a.vertexColors;if(3===c.length)this.colors.push(c[0],c[1],c[2]);else{var d=a.color;this.colors.push(d,d,d)}if(!0===r)void 0!==(u=n[0][o])?this.uvs.push(u[0],u[1],u[2]):(console.warn("DirectGeometry.fromGeometry(): Undefined vertexUv ",o),this.uvs.push(new Pe,new Pe,new Pe));if(!0===s)void 0!==(u=n[1][o])?this.uvs2.push(u[0],u[1],u[2]):(console.warn("DirectGeometry.fromGeometry(): Undefined vertexUv2 ",o),this.uvs2.push(new Pe,new Pe,new Pe))}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}}]),t}(),Ie=1,Re=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return Object.defineProperty(t,"id",{value:Ie+=2}),t.type="BufferGeometry",t.index=null,t.attributes={},t.isBufferGeometry=!0,t.drawRange={start:0,count:1/0},t.groups=[],t.boundingBox=null,t.boundingSphere=null,t.isBufferGeometry=!0,t}return _inherits(e,N),_createClass(e,[{key:"setIndex",value:function(t){Array.isArray(t)?this.index=new(It.arrayMax(t)>65535?Oe:Te)(t,1):this.index=t}},{key:"getIndex",value:function(){return this.index}},{key:"addAttribute",value:function(t,e){return e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(e)):(this.attributes[t]=e,this):(console.warn("BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(t,new Ee(arguments[1],arguments[2])))}},{key:"getAttribute",value:function(t){return this.attributes[t]}},{key:"removeAttribute",value:function(t){return delete this.attributes[t],this}},{key:"setFromObject",value:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var i=new De(3*e.vertices.length,3),n=new De(3*e.colors.length,3);if(this.addAttribute("position",i.copyVector3sArray(e.vertices)),this.addAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var r=new De(e.lineDistances.length,1);this.addAttribute("lineDistance",r.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this}},{key:"fromGeometry",value:function(t){return t.__directGeometry=(new ze).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)}},{key:"fromDirectGeometry",value:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new Ee(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var i=new Float32Array(3*t.normals.length);this.addAttribute("normal",new Ee(i,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var n=new Float32Array(3*t.colors.length);this.addAttribute("color",new Ee(n,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var r=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new Ee(r,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var s=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new Ee(s,2).copyVector2sArray(t.uvs2))}return this.groups=t.groups,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}},{key:"updateFromObject",value:function(t){var e=t.geometry;if(t.isMesh){var i=e.__directGeometry;if(!0===e.elementsNeedUpdate&&(i=void 0,e.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(e);i.verticesNeedUpdate=e.verticesNeedUpdate,i.normalsNeedUpdate=e.normalsNeedUpdate,i.colorsNeedUpdate=e.colorsNeedUpdate,i.uvsNeedUpdate=e.uvsNeedUpdate,i.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=i}}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new Xt);var t=this.attributes.position;void 0!==t?this.boundingBox.setFromBufferAttribute(t):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},{key:"computeBoundingSphere",value:function(){Ne.call(this)}},{key:"addGroup",value:function(t,e,i){this.groups.push({start:t,count:e,materialIndex:void 0!==i?i:0})}},{key:"clearGroups",value:function(){this.groups=[]}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(t){var e,i,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var r=t.index;null!==r&&this.setIndex(r.clone());var s=t.attributes;for(e in s){var o=s[e];this.addAttribute(e,o.clone())}var a=t.groups;for(i=0,n=a.length;i<n;i++){var l=a[i];this.addGroup(l.start,l.count,l.materialIndex)}var h=t.boundingBox;null!==h&&(this.boundingBox=h.clone());var u=t.boundingSphere;return null!==u&&(this.boundingSphere=u.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this}},{key:"dispose",value:function(){this.fire({type:"dispose"})}}]),e}(),Ne=(Le=new Xt,Me=new Rt,function(){null===this.boundingSphere&&(this.boundingSphere=new te);var t=this.attributes.position;if(t){var e=this.boundingSphere.center;Le.setFromBufferAttribute(t),Le.getCenter(e);for(var i=0,n=0,r=t.count;n<r;n++)Me.x=t.getX(n),Me.y=t.getY(n),Me.z=t.getZ(n),i=Math.max(i,e.distanceToSquared(Me));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}),Ue=function(){function t(e,i,n){_classCallCheck(this,t),this._gl=e,this._geometries={},this._attributes=i,this._info=n,this._wireframeAttributes={}}return _createClass(t,[{key:"get",value:function(t,e){var i=this._geometries[e.id];return i||(this._onGeometryDisposeBind=function(t){var e=t.target,i=this._geometries[e.id];if(!i)return;null!==i.index&&this._attributes.remove(i.index);for(var n in i.attributes)this._attributes.remove(i.attributes[n]);e.off("dispose",this._onGeometryDisposeBind),this._onGeometryDisposeBind=null,delete this._geometries[e.id];var r=this._wireframeAttributes[e.id];r&&(this._attributes.remove(r),delete this._wireframeAttributes[e.id]);this._info.memory.geometries--}.bind(this),e.on("dispose",this._onGeometryDisposeBind),e.isBufferGeometry?i=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new Re).setFromObject(t)),i=e._bufferGeometry),this._geometries[e.id]=i,this._info.memory.geometries++,i)}},{key:"update",value:function(t){var e=this._gl,i=t.index,n=t.attributes;for(var r in null!==i&&this._attributes.update(i,e.ELEMENT_ARRAY_BUFFER),n)this._attributes.update(n[r],e.ARRAY_BUFFER)}},{key:"getWireframeAttribute",value:function(t){var e=this._gl,i=It.arrayMax,n=this._wireframeAttributes[t.id];if(n)return n;var r=[],s=t.index,o=t.attributes;if(null!==s)for(var a=s.array,l=0,h=a.length;l<h;l+=3){var u=a[l+0],c=a[l+1],d=a[l+2];r.push(u,c,c,d,d,u)}else for(var f=0,p=o.position.array.length/3-1;f<p;f+=3){var v=f+0,y=f+1,m=f+2;r.push(v,y,y,m,m,v)}return n=new(i(r)>65535?Oe:Te)(r,1),this._attributes.update(n,e.ELEMENT_ARRAY_BUFFER),this._wireframeAttributes[t.id]=n,n}}]),t}();var Fe={common:{diffuse:{value:new Nt(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new ie}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}}},points:{diffuse:{value:new Nt(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new ie}},line:{scale:{value:1},dashSize:{value:1},totalSize:{value:2}},sprite:{diffuse:{value:new Nt(15658734)},opacity:{value:1},center:{value:new Pe(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new ie}}},Be={merge:function(t){for(var e={},i=0;i<t.length;i++){var n=this.clone(t[i]);for(var r in n)e[r]=n[r]}return e},clone:function(t){var e={};for(var i in t)for(var n in e[i]={},t[i]){var r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}return e}},Ve="uniform vec3 diffuse;\nuniform float opacity;\n#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vUv;\n\tuniform sampler2D map;\n#endif\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\tdiffuseColor *= texelColor;\n#endif\n#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif\n\t\n\tgl_FragColor = diffuseColor;\n#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n}\n",Ge="#if defined( USE_MAP ) \n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\nvoid main() {\n#if defined( USE_MAP ) \n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif\n\t\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n}",We="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\nvoid main() {\n#ifdef USE_COLOR\n\t    vColor.xyz = color.xyz;\n#endif\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n}\n",je="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\nvoid main() {\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n#ifdef USE_COLOR\n\t    diffuseColor.rgb *= vColor;\n#endif\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\t\n}\n",He="uniform float size;\nuniform float scale;\n#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\nvoid main() {\n\t#ifdef USE_COLOR\n\t    vColor.xyz = color.xyz;\n    #endif\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n}\n",qe="uniform vec3 diffuse;\nuniform float opacity;\n#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\nvoid main() {\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *=  mapTexel ;\n#endif\n#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\t\n}\n",Xe="#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\n#ifdef USE_MAP\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n}\nuniform vec3 ambientLightColor;\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\nvoid main() {\n#ifdef USE_MAP  \n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif\n\tvec3 objectNormal = vec3( normal );\n\tvec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\tvec3 diffuse = vec3( 1.0 );\n\tGeometricContext geometry;\n\tgeometry.position = mvPosition.xyz;\n\tgeometry.normal = normalize( transformedNormal );\n\tgeometry.viewDir = normalize( -mvPosition.xyz );\n\tGeometricContext backGeometry;\n\tbackGeometry.position = geometry.position;\n\tbackGeometry.normal = -geometry.normal;\n\tbackGeometry.viewDir = geometry.viewDir;\n\tvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\n\tIncidentLight directLight;\n\tfloat dotNL;\n\tvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n}\n",Ye="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\n    uniform vec3 ambientLightColor;\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\tdiffuseColor *= texelColor;\n#endif\n#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif\n\treflectedLight.indirectDiffuse =  ambientLightColor;\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n}\n",Ze="#define PHONG\n    varying vec3 vViewPosition;\n\tvarying vec3 vNormal;\n#ifdef USE_MAP \n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\nvoid main() {\n#ifdef USE_MAP\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif\nvec3 objectNormal = vec3( normal );\nvec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n\tvNormal = normalize( transformedNormal );\n\tvec3 transformed = vec3( position );\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n\tvViewPosition = - mvPosition.xyz;\n}\n",Qe="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n}\n#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n#ifdef  USE_MAP\n\tvarying vec2 vUv;\n    uniform sampler2D map;\n#endif\nuniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n    varying vec3 vViewPosition;\n\tvarying vec3 vNormal;\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t\tirradiance *= PI;\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\tdiffuseColor *= texelColor;\n#endif\n#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif\nfloat specularStrength = 1.0;\n\tvec3 normal = normalize( vNormal );\n#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#endif\n\tBlinnPhongMaterial material;\n    material.diffuseColor = diffuseColor.rgb;\n    material.specularColor = specular;\n    material.specularShininess = shininess;\n    material.specularStrength = specularStrength;\n    GeometricContext geometry;\n    geometry.position = - vViewPosition;\n    geometry.normal = normal;\n    geometry.viewDir = normalize( vViewPosition );\n    IncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n}\n",Ke="uniform float linewidth;\nuniform vec2 resolution;\nattribute vec3 instanceStart;\nattribute vec3 instanceEnd;\nattribute vec3 instanceColorStart;\nattribute vec3 instanceColorEnd;\nvarying vec2 vUv;\n#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n#ifdef USE_DASH\n    uniform float scale;\n    attribute float instanceDistanceStart;\n    attribute float instanceDistanceEnd;\n    varying float vLineDistance;\n    \n#endif\nvoid trimSegment( const in vec4 start, inout vec4 end ) {\n    float a = projectionMatrix[ 2 ][ 2 ];    float b = projectionMatrix[ 3 ][ 2 ];    float nearEstimate = - 0.5 * b / a;\n    float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n    end.xyz = mix( start.xyz, end.xyz, alpha );\n}\nvoid main() {\n#ifdef USE_COLOR\n        vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n#endif\n#ifdef USE_DASH\n    vLineDistance = ( position.y < 0.5 ) ? scale * instanceDistanceStart : scale * instanceDistanceEnd;\n#endif\n    float aspect = resolution.x / resolution.y;\n    vUv = uv;\n    vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n    vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n    bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );    if ( perspective ) {\n        if ( start.z < 0.0 && end.z >= 0.0 ) {\n            trimSegment( start, end );\n        } else if ( end.z < 0.0 && start.z >= 0.0 ) {\n            trimSegment( end, start );\n        }\n    }\n    vec4 clipStart = projectionMatrix * start;\n    vec4 clipEnd = projectionMatrix * end;\n    vec2 ndcStart = clipStart.xy / clipStart.w;\n    vec2 ndcEnd = clipEnd.xy / clipEnd.w;\n    vec2 dir = ndcEnd - ndcStart;\n    dir.x *= aspect;\n    dir = normalize( dir );\n    vec2 offset = vec2( dir.y, - dir.x );\n    dir.x /= aspect;\n    offset.x /= aspect;\n    if ( position.x < 0.0 ) offset *= - 1.0;\n    if ( position.y < 0.0 ) {\n        offset += - dir;\n    } else if ( position.y > 1.0 ) {\n        offset += dir;\n    }\n    offset *= linewidth;\n    offset /= resolution.y;\n    vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n    offset *= clip.w;\n    clip.xy += offset;\n    gl_Position =clip;\n    vec4 mvPosition = ( position.y < 0.5 ) ? start : end;}",Je="uniform vec3 diffuse;\nuniform float opacity;\n#ifdef USE_DASH\n    uniform float dashSize;\n    uniform float totalSize;\n    varying float vLineDistance;\n#endif\n#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\nvarying vec2 vUv;\nvoid main() {\n    #ifdef USE_DASH\n        if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard;\n    if ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n    #endif\n    if ( abs( vUv.y ) > 1.0 ) {\n        float a = vUv.x;\n        float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n        float len2 = a * a + b * b;\n        if ( len2 > 1.0 ) discard;\n    }\n    vec4 diffuseColor = vec4( diffuse, opacity );\n#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif\n    gl_FragColor =vec4( diffuseColor.rgb, diffuseColor.a );\n#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n}",$e="uniform float rotation;\nuniform vec2 center;\n#ifdef USE_MAP\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n#ifdef USE_MAP\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n}",ti="uniform vec3 diffuse;\nuniform float opacity;\n#ifdef USE_MAP\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\nvoid main() {\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\tdiffuseColor *= texelColor;\n#endif\n#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n}",ei={basic:{uniforms:Be.merge([Fe.common]),vertexShader:Ge,fragmentShader:Ve},lambert:{uniforms:Be.merge([Fe.common,Fe.lights,{emissive:{value:new Nt(0)}}]),vertexShader:Xe,fragmentShader:Ye},phong:{uniforms:Be.merge([Fe.common,Fe.lights,{emissive:{value:new Nt(0)},specular:{value:new Nt(1118481)},shininess:{value:30}}]),vertexShader:Ze,fragmentShader:Qe},dashed:{uniforms:Be.merge([Fe.common,Fe.line]),vertexShader:We,fragmentShader:je},linemesh:{uniforms:Be.merge([Fe.common,Fe.line,{linewidth:{value:1},resolution:{value:new Pe(1,1)}}]),vertexShader:Ke,fragmentShader:Je},points:{uniforms:Be.merge([Fe.points]),vertexShader:He,fragmentShader:qe},sprite:{uniforms:Be.merge([Fe.sprite]),vertexShader:$e,fragmentShader:ti}},ii=function(){function t(e){_classCallCheck(this,t),this.gl=e,this.memory={geometries:0,textures:0},this.render={frame:0,calls:0,triangles:0,points:0,lines:0},this.programs=null,this.autoReset=!0}return _createClass(t,[{key:"update",value:function(t,e,i){var n=this.gl;switch(i=i||1,this.render.calls++,e){case n.TRIANGLES:this.render.triangles+=i*(t/3);break;case n.TRIANGLE_STRIP:case n.TRIANGLE_FAN:this.render.triangles+=i*(t-2);break;case n.LINES:this.render.lines+=i*(t/2);break;case n.LINE_STRIP:this.render.lines+=i*(t-1);break;case n.LINE_LOOP:this.render.lines+=i*t;break;case n.POINTS:this.render.points+=i*t;break;default:console.error("WebGLInfo: Unknown draw mode:",e)}}},{key:"reset",value:function(){this.render.frame++,this.render.calls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}}]),t}(),ni=0,ri=function(t){function e(t,i,n,r,s,o,a,l,h,u){_classCallCheck(this,e);var c=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return Object.defineProperty(c,"id",{value:ni++}),c.image=void 0!==t?t:e.DEFAULT_IMAGE,c.mipmaps=[],c.mapping=void 0!==i?i:e.DEFAULT_MAPPING,c.wrapS=void 0!==n?n:at,c.wrapT=void 0!==r?r:at,c.magFilter=void 0!==s?s:dt,c.minFilter=void 0!==o?o:pt,c.anisotropy=void 0!==h?h:1,c.format=void 0!==a?a:Mt,c.type=void 0!==l?l:vt,c.offset=new Pe(0,0),c.repeat=new Pe(1,1),c.center=new Pe(0,0),c.rotation=0,c.matrixAutoUpdate=!0,c.matrix=new ie,c.generateMipmaps=!0,c.premultiplyAlpha=!1,c.flipY=!0,c.unpackAlignment=4,c.version=0,c.onUpdate=null,c.isTexture=!0,c}return _inherits(e,N),_createClass(e,[{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"dispose",value:function(){this.fire({type:"dispose"})}},{key:"needsUpdate",set:function(t){!0===t&&this.version++}}]),e}();ri.DEFAULT_IMAGE=void 0,ri.DEFAULT_MAPPING=300;var si=function(){function t(e,i,n){_classCallCheck(this,t),this._gl=e,this._program=i,this._renderer=n,this.seq=[],this.map={};for(var r=e.getProgramParameter(i,e.ACTIVE_UNIFORMS),s=0;s<r;++s){var o=e.getActiveUniform(i,s);hi(o,e.getUniformLocation(i,o.name),this)}}return _createClass(t,[{key:"setValue",value:function(t,e){var i=this.map[t];void 0!==i&&i.setValue(e,this._renderer)}},{key:"setOptional",value:function(t,e){var i=t[e];void 0!==i&&this.setValue(e,i)}}],[{key:"upload",value:function(t,e,i,n){for(var r=0,s=e.length;r!==s;++r){var o=e[r],a=i[o.id];!1!==a.needsUpdate&&o.setValue(a.value,n)}}},{key:"seqWithValue",value:function(t,e){for(var i=[],n=0,r=t.length;n!==r;++n){var s=t[n];s.id in e&&i.push(s)}return i}}]),t}(),oi=function(){function t(e,i){_classCallCheck(this,t),this._gl=e,this.id=i,this.seq=[],this.map={}}return _createClass(t,[{key:"setValue",value:function(t){for(var e=this.seq,i=0,n=e.length;i!==n;++i){var r=e[i];r.setValue(t[r.id])}}}]),t}(),ai=function t(e,i,n,r){_classCallCheck(this,t),this._gl=e,this.id=i,this.addr=r,this.cache=[],this.setValue=function(t){switch(t){case 5126:return pi;case 35664:return yi;case 35665:return mi;case 35666:return gi;case 35674:return _i;case 35675:return xi;case 35676:return bi;case 35678:case 36198:return wi;case 5124:case 35670:return vi;case 35667:case 35671:return ki;case 35668:case 35672:return Si;case 35669:case 35673:return Ci}}(n.type)},li=function t(e,i,n,r){_classCallCheck(this,t),this._gl=e,this.id=i,this.addr=r,this.cache=[],this.size=n.size,this.setValue=function(t){switch(t){case 5126:return Ai;case 35664:return Mi;case 35665:return Pi;case 35666:return Ei;case 35674:return Ti;case 35675:return Oi;case 35676:return Di;case 35678:return zi;case 5124:case 35670:return Li;case 35667:case 35671:return ki;case 35668:case 35672:return Si;case 35669:case 35673:return Ci}}(n.type)};function hi(t,e,i){var n=/([\w\d_]+)(\])?(\[|\.)?/g,r=t.name,s=r.length;for(n.lastIndex=0;;){var o=n.exec(r),a=n.lastIndex,l=o[1],h="]"===o[2],u=o[3];if(h&&(l|=0),void 0===u||"["===u&&a+2===s){ui(i,void 0===u?new ai(i._gl,l,t,e):new li(i._gl,l,t,e));break}var c=i.map[l];void 0===c&&ui(i,c=new oi(i._gl,l)),i=c}}function ui(t,e){t.seq.push(e),t.map[e.id]=e}var ci=[],di=[],fi={mat2array:new Float32Array(4),mat3array:new Float32Array(9),mat4array:new Float32Array(16),emptyTexture:new ri,arraysEqual:function(t,e){if(t.length!==e.length)return!1;for(var i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0},copyArray:function(t,e){for(var i=0,n=e.length;i<n;i++)t[i]=e[i]},flatten:function(t,e,i){var n=t[0];if(n<=0||n>0)return t;var r=e*i,s=ci[r];if(void 0===s&&(s=new Float32Array(r),ci[r]=s),0!==e){n.toArray(s,0);for(var o=1,a=0;o!==e;++o)a+=i,t[o].toArray(s,a)}return s},allocTexUnits:function(t,e){var i=di[e];void 0===i&&(i=new Int32Array(e),di[e]=i);for(var n=0;n!==e;++n)i[n]=t.allocTextureUnit();return i}};function pi(t){var e=this.cache;e[0]!==t&&(this._gl.uniform1f(this.addr,t),e[0]=t)}function vi(t){var e=this.cache;e[0]!==t&&(this._gl.uniform1i(this.addr,t),e[0]=t)}function yi(t){var e=this.cache;if(void 0!==t.x)e[0]===t.x&&e[1]===t.y||(this._gl.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(fi.arraysEqual(e,t))return;this._gl.uniform2fv(this.addr,t),fi.copyArray(e,t)}}function mi(t){var e=this.cache;if(void 0!==t.x)e[0]===t.x&&e[1]===t.y&&e[2]===t.z||(this._gl.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(void 0!==t.r)e[0]===t.r&&e[1]===t.g&&e[2]===t.b||(this._gl.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if(fi.arraysEqual(e,t))return;this._gl.uniform3fv(this.addr,t),fi.copyArray(e,t)}}function gi(t){var e=this.cache;if(void 0!==t.x)e[0]===t.x&&e[1]===t.y&&e[2]===t.z&&e[3]===t.w||(this._gl.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else if(void 0!==t.r)e[0]===t.r&&e[1]===t.g&&e[2]===t.b&&e[3]===t.a||(this._gl.uniform4f(this.addr,t.r,t.g,t.b,t.a),e[0]=t.r,e[1]=t.g,e[2]=t.b,e[2]=t.a);else{if(fi.arraysEqual(e,t))return;this._gl.uniform4fv(this.addr,t),fi.copyArray(e,t)}}function _i(t){var e=this.cache,i=t.elements;if(void 0===i){if(fi.arraysEqual(e,t))return;this._gl.uniformMatrix2fv(this.addr,!1,t),fi.copyArray(e,t)}else{if(fi.arraysEqual(e,i))return;fi.mat2array.set(i),this._gl.uniformMatrix2fv(this.addr,!1,fi.mat2array),fi.copyArray(e,i)}}function xi(t){var e=this.cache,i=t.elements;if(void 0===i){if(fi.arraysEqual(e,t))return;this._gl.uniformMatrix3fv(this.addr,!1,t),fi.copyArray(e,t)}else{if(fi.arraysEqual(e,i))return;fi.mat3array.set(i),this._gl.uniformMatrix3fv(this.addr,!1,fi.mat3array),fi.copyArray(e,i)}}function bi(t){var e=this.cache,i=t.elements;if(void 0===i){if(fi.arraysEqual(e,t))return;this._gl.uniformMatrix4fv(this.addr,!1,t),fi.copyArray(e,t)}else{if(fi.arraysEqual(e,i))return;fi.mat4array.set(i),this._gl.uniformMatrix4fv(this.addr,!1,fi.mat4array),fi.copyArray(e,i)}}function wi(t,e){var i=this.cache,n=e.allocTextureUnit();i[0]!==n&&(this._gl.uniform1i(this.addr,n),i[0]=n),e.setTexture2D(t||fi.emptyTexture,n)}function ki(t){var e=this.cache;fi.arraysEqual(e,t)||(this._gl.uniform2iv(this.addr,t),fi.copyArray(e,t))}function Si(t){var e=this.cache;fi.arraysEqual(e,t)||(this._gl.uniform3iv(this.addr,t),fi.copyArray(e,t))}function Ci(t){var e=this.cache;fi.arraysEqual(e,t)||(this._gl.uniform4iv(this.addr,t),fi.copyArray(e,t))}function Ai(t){var e=this.cache;fi.arraysEqual(e,t)||(this._gl.uniform1fv(this.addr,t),fi.copyArray(e,t))}function Li(t){var e=this.cache;fi.arraysEqual(e,t)||(this._gl.uniform1iv(this.addr,t),fi.copyArray(e,t))}function Mi(t){this._gl.uniform2fv(this.addr,fi.flatten(t,this.size,2))}function Pi(t){this._gl.uniform3fv(this.addr,fi.flatten(t,this.size,3))}function Ei(t){this._gl.uniform4fv(this.addr,fi.flatten(t,this.size,4))}function Ti(t){this._gl.uniformMatrix2fv(this.addr,!1,fi.flatten(t,this.size,4))}function Oi(t){this._gl.uniformMatrix3fv(this.addr,!1,fi.flatten(t,this.size,9))}function Di(t){this._gl.uniformMatrix4fv(this.addr,!1,fi.flatten(t,this.size,16))}function zi(t,e){var i=this.cache,n=t.length,r=fi.allocTexUnits(e,n);!1===fi.arraysEqual(i,r)&&(this._gl.uniform1iv(this.addr,r),fi.copyArray(i,r));for(var s=0;s!==n;++s)e.setTexture2D(t[s]||fi.emptyTexture,r[s])}function Ii(t,e,i){var n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),!1===t.getShaderParameter(n,t.COMPILE_STATUS)&&console.error("WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(n)&&console.warn("WebGLShader: gl.getShaderInfoLog()",e===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(n),function(t){for(var e=t.split("\n"),i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join("\n")}(i)),n}var Ri=0,Ni=function(){function t(e,i,n,r,s,o){_classCallCheck(this,t),this._gl=e,this._defines=n.defines,this._cachedUniforms=void 0,this._cachedAttributes=void 0,this.name=s.name,this.id=Ri++,this.code=r,this.usedTimes=1,this.program=null,this.vertexShader="",this.fragmentShader="",this._init(e,i,n,s,o)}return _createClass(t,[{key:"_init",value:function(t,e,i,n,r){var s=n.vertexShader,o=n.fragmentShader,a=function(t,e,i){return[(t=t||{}).derivatives||e.envMapCubeUV||e.bumpMap||e.normalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Bi).join("\n")}(i.extensions,r,e),l=function(t){var e=[];for(var i in t){var n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(this._defines),h=this.program=t.createProgram(),u=void 0,c=void 0;i.isRawShaderMaterial?((u=[l].filter(Bi).join("\n")).length>0&&(u+="\n"),(c=[a,l].filter(Bi).join("\n")).length>0&&(c+="\n")):(u=["precision "+r.precision+" float;","precision "+r.precision+" int;","#define SHADER_NAME "+n.name,r.map?"#define USE_MAP":"",r.vertexColors?"#define USE_COLOR":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.dashed?"#define USE_DASH":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","\n"].filter(Bi).join("\n"),c=["precision "+r.precision+" float;","precision "+r.precision+" int;","#define SHADER_NAME "+n.name,r.map?"#define USE_MAP":"",r.vertexColors?"#define USE_COLOR":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.dashed?"#define USE_DASH":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","\n"].filter(Bi).join("\n")),s=Ui(s,r),o=Ui(o,r);var d=u+(s=Fi(s)),f=c+(o=Fi(o));console.log("*VERTEX*",d),console.log("*FRAGMENT*",f);var p=this.vertexShader=Ii(t,t.VERTEX_SHADER,d),v=this.fragmentShader=Ii(t,t.FRAGMENT_SHADER,f);t.attachShader(h,p),t.attachShader(h,v),t.linkProgram(h);var y=t.getProgramInfoLog(h).trim(),m=t.getShaderInfoLog(p).trim(),g=t.getShaderInfoLog(v).trim();!1===t.getProgramParameter(h,t.LINK_STATUS)?console.error("WebGLProgram: shader error: ",t.getError(),"gl.VALIDATE_STATUS",t.getProgramParameter(h,t.VALIDATE_STATUS),"gl.getProgramInfoLog",y,m,g):""!==y&&console.warn("WebGLProgram: gl.getProgramInfoLog()",y),t.deleteShader(p),t.deleteShader(v)}},{key:"getUniforms",value:function(){var t=this._gl,e=this.program;return void 0===this._cachedUniforms&&(this._cachedUniforms=new si(t,e)),this._cachedUniforms}},{key:"getAttributes",value:function(){var t=this._gl,e=this.program;if(void 0===this._cachedAttributes){this._cachedAttributes={};for(var i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),n=0;n<i;n++){var r=t.getActiveAttrib(e,n).name;console.log("WebGLProgram: ACTIVE VERTEX ATTRIBUTE:",r,n),this._cachedAttributes[r]=t.getAttribLocation(e,r)}}return this._cachedAttributes}},{key:"destroy",value:function(){this._gl.deleteProgram(this.program),this.program=void 0}}]),t}();function Ui(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights)}function Fi(t){return t.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(t,e,i,n){for(var r="",s=parseInt(e);s<parseInt(i);s++)r+=n.replace(/\[ i \]/g,"[ "+s+" ]");return r})}function Bi(t){return""!==t}var Vi=function(){function t(e,i,n){_classCallCheck(this,t),this.programs=[],this._gl=e,this._extensions=i,this._capabilities=n,this._shaderIDs={MeshBasicMaterial:"basic",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineMeshMaterial:"linemesh",SpriteMaterial:"sprite"}}return _createClass(t,[{key:"getParameters",value:function(t,e){var i=this._shaderIDs[t.type],n=this._capabilities.precision;return null!==t.precision&&(n=this._capabilities.getMaxPrecision(t.precision))!==t.precision&&console.warn("WebGLProgram.getParameters:",t.precision,"not supported, using",n,"instead."),{shaderID:i,precision:n,map:!!t.map,vertexColors:t.vertexColors,alphaTest:t.alphaTest,doubleSided:t.side===W,flipSided:t.side===G,dashed:!!t.dashed,sizeAttenuation:!!t.sizeAttenuation,premultipliedAlpha:!!t.premultipliedAlpha,numDirLights:e.directional.length,numPointLights:e.point.length,numSpotLights:e.spot.length}}},{key:"getProgramCode",value:function(t,e){var i=[],n=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","dashed"];if(e.shaderID?i.push(e.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)i.push(r),i.push(t.defines[r]);for(var s=0;s<n.length;s++)i.push(e[n[s]]);return i.join()}},{key:"acquireProgram",value:function(t,e,i,n){for(var r=void 0,s=0,o=this.programs.length;s<o;s++){var a=this.programs[s];if(a.code===n){++(r=a).usedTimes;break}}return void 0===r&&(r=new Ni(this._gl,this._extensions,t,n,e,i),this.programs.push(r)),r}},{key:"releaseProgram",value:function(t){if(0==--t.usedTimes){var e=this.programs.indexOf(t);this.programs[e]=this.programs[this.programs.length-1],this.programs.pop(),t.destroy()}}}]),t}(),Gi=function(){function t(){_classCallCheck(this,t),this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparent=[]}return _createClass(t,[{key:"init",value:function(){this.renderItemsIndex=0,this.opaque.length=0,this.transparent.length=0}},{key:"push",value:function(t,e,i,n,r){var s=this.renderItems[this.renderItemsIndex];void 0===s?(s={id:t.id,object:t,geometry:e,material:i,program:i.program,renderOrder:t.renderOrder,z:n,group:r},this.renderItems[this.renderItemsIndex]=s):(s.id=t.id,s.object=t,s.geometry=e,s.material=i,s.program=i.program,s.renderOrder=t.renderOrder,s.z=n,s.group=r),(!0===i.transparent?this.transparent:this.opaque).push(s),this.renderItemsIndex++}},{key:"sort",value:function(){this.opaque.length>1&&this.opaque.sort(Wi),this.transparent.length>1&&this.transparent.sort(ji)}}]),t}();function Wi(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program&&e.program&&t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function ji(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}var Hi=function(){function t(){_classCallCheck(this,t),this._lists={}}return _createClass(t,[{key:"get",value:function(t,e){var i=t.id+","+e.id,n=this._lists[i];return void 0===n&&(n=new Gi,this._lists[i]=n),n}},{key:"dispose",value:function(){this._lists={}}}]),t}(),qi=function(){function t(e,i,n){_classCallCheck(this,t),this._mode=e.TRIANGLES,this._gl=e,this._info=n,this._extensions=i}return _createClass(t,[{key:"setMode",value:function(t){this._mode=t}},{key:"render",value:function(t,e){this._gl.drawArrays(this._mode,t,e),this._info.update(e,this._mode)}},{key:"renderInstances",value:function(t,e,i){null!==this._extensions.get("ANGLE_instanced_arrays")?(this._extension.drawArraysInstancedANGLE(mode,e,i,t.maxInstancedCount),this._info.update(i,this._mode,t.maxInstancedCount)):console.error("WebGLBufferRenderer: using InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}]),t}(),Xi=function(){function t(e,i){_classCallCheck(this,t),this._infoRender=i.render,this._updateList={},this._geometries=e}return _createClass(t,[{key:"update",value:function(t){var e=this._infoRender.frame,i=this._geometries,n=t.geometry,r=i.get(t,n);return this._updateList[r.id]!==e&&(n.isGeometry&&r.updateFromObject(t),i.update(r),this._updateList[r.id]=e),r}},{key:"dispose",value:function(){this._updateList={}}}]),t}(),Yi=function(){function t(e,i,n){_classCallCheck(this,t),this._mode=e.TRIANGLES,this._gl=e,this._info=n,this._extensions=i,this._type=void 0,this._bytesPerElement=void 0}return _createClass(t,[{key:"setMode",value:function(t){this._mode=t}},{key:"setIndex",value:function(t){this._type=t.type,this._bytesPerElement=t.bytesPerElement}},{key:"render",value:function(t,e){this._gl.drawElements(this._mode,e,this._type,t*this._bytesPerElement),this._info.update(e,this._mode)}},{key:"renderInstances",value:function(t,e,i){var n=this._extensions.get("ANGLE_instanced_arrays");null!==n?(n.drawElementsInstancedANGLE(this._mode,i,this._type,e*this._bytesPerElement,t.maxInstancedCount),this._info.update(i,this._mode,t.maxInstancedCount)):console.error("WebGLIndexedBufferRenderer: using InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}]),t}(),Zi=function(){function t(e,i,n,r,s,o,a){_classCallCheck(this,t),this.gl=e,this._properties=r,this._info=a,this._state=n,this.extensions=i,this._capabilities=s,this._utils=o}return _createClass(t,[{key:"setTexture2D",value:function(t,e){var i=this.gl,n=this._properties.get(t);if(t.version>0&&n.__version!==t.version){var r=t.image;if(void 0===r)console.warn("WebGLRenderer: Texture marked for update but image is undefined",t);else{if(!1!==r.complete)return void this._uploadTexture(n,t,e);console.warn("WebGLRenderer: Texture marked for update but image is incomplete",t)}}this._state.activeTexture(i.TEXTURE0+e),this._state.bindTexture(i.TEXTURE_2D,n.__webglTexture)}},{key:"_uploadTexture",value:function(t,e,i){var n=this.gl,r=this._state,s=this._utils;void 0===t.__webglInit&&(t.__webglInit=!0,this._onTextureDisposeBind=function(t){var e=t.target;e.off("dispose",this._onTextureDisposeBind),this._onTextureDisposeBind=null,function(t){var e=this.gl,i=this._properties.get(t);if(t.image&&i.__image__webglTextureCube)e.deleteTexture(i.__image__webglTextureCube);else{if(void 0===i.__webglInit)return;e.deleteTexture(i.__webglTexture)}this._properties.remove(t)}.call(this,e),this._info.memory.textures--}.bind(this),e.on("dispose",this._onTextureDisposeBind),t.__webglTexture=n.createTexture(),this._info.memory.textures++),r.activeTexture(n.TEXTURE0+i),r.bindTexture(n.TEXTURE_2D,t.__webglTexture),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,e.unpackAlignment);var o=function(t,e){if(t.width>e||t.height>e){if("data"in t)return void console.warn("WebGLRenderer: image in DataTexture is too big ("+t.width+"x"+t.height+").");var i=e/Math.max(t.width,t.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=Math.floor(t.width*i),n.height=Math.floor(t.height*i);var r=n.getContext("2d");return r.drawImage(t,0,0,t.width,t.height,0,0,n.width,n.height),console.warn("WebGLRenderer: image is too big ("+t.width+"x"+t.height+"). Resized to "+n.width+"x"+n.height,t),n}return t}(e.image,this._capabilities.maxTextureSize);(function(t){return t.wrapS!==at||t.wrapT!==at||t.minFilter!==ht&&t.minFilter!==dt})(e)&&!1===Qi(o)&&(o=function(t){if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageBitmap){void 0===Ki&&(Ki=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Ki.width=It.floorPowerOfTwo(t.width),Ki.height=It.floorPowerOfTwo(t.height);var e=Ki.getContext("2d");return e.drawImage(t,0,0,Ki.width,Ki.height),console.warn("WebGLRenderer: image is not power of two ("+t.width+"x"+t.height+"). Resized to "+Ki.width+"x"+Ki.height,t),Ki}return t}(o));var a=Qi(o),l=s.convert(e.format),h=s.convert(e.type);(function(t,e,i){var n=this.gl,r=this.extensions,s=this._utils,o=this._properties,a=void 0;i?(n.texParameteri(t,n.TEXTURE_WRAP_S,s.convert(e.wrapS)),n.texParameteri(t,n.TEXTURE_WRAP_T,s.convert(e.wrapT)),n.texParameteri(t,n.TEXTURE_MAG_FILTER,s.convert(e.magFilter)),n.texParameteri(t,n.TEXTURE_MIN_FILTER,s.convert(e.minFilter))):(n.texParameteri(t,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(t,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),e.wrapS===at&&e.wrapT===at||console.warn("WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to ClampToEdgeWrapping.",e),n.texParameteri(t,n.TEXTURE_MAG_FILTER,Ji.call(this,e.magFilter)),n.texParameteri(t,n.TEXTURE_MIN_FILTER,Ji.call(this,e.minFilter)),e.minFilter!==ht&&e.minFilter!==dt&&console.warn("WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to NearestFilter or LinearFilter.",e));if(a=r.get("EXT_texture_filter_anisotropic")){if(e.type===bt&&null===r.get("OES_texture_float_linear"))return;if(e.type===wt&&null===r.get("OES_texture_half_float_linear"))return;(e.anisotropy>1||o.get(e).__currentAnisotropy)&&(n.texParameterf(t,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,capabilities.getMaxAnisotropy())),o.get(e).__currentAnisotropy=e.anisotropy)}}).call(this,n.TEXTURE_2D,e,a);var u=void 0,c=e.mipmaps;if(c.length>0&&a){for(var d=0,f=c.length;d<f;d++)u=c[d],r.texImage2D(n.TEXTURE_2D,d,l,l,h,u);e.generateMipmaps=!1,t.__maxMipLevel=c.length-1}else r.texImage2D(n.TEXTURE_2D,0,l,l,h,o),t.__maxMipLevel=0;(function(t,e){return t.generateMipmaps&&e&&t.minFilter!==ht&&t.minFilter!==dt})(e,a)&&function(t,e,i,n){this.gl.generateMipmap(t),this._properties.get(e).__maxMipLevel=Math.log(Math.max(i,n))*Math.LOG2E}.call(this,n.TEXTURE_2D,e,o.width,o.height),t.__version=e.version,e.onUpdate&&e.onUpdate(e)}}]),t}();function Qi(t){return It.isPowerOfTwo(t.width)&&It.isPowerOfTwo(t.height)}var Ki=void 0;function Ji(t){var e=this.gl;return t===ht||t===ut||t===ct?e.NEAREST:e.LINEAR}var $i=0,tn=new Rt,en=function(){function t(){_classCallCheck(this,t),this.cache=new nn,this.state={id:$i++,hash:"",ambient:[0,0,0],directional:[],spot:[],point:[]}}return _createClass(t,[{key:"setup",value:function(t,e,i){for(var n=0,r=0,s=0,o=0,a=0,l=0,h=this.state,u=this.cache,c=i.matrixWorldInverse,d=0,f=t.length;d<f;d++){var p=t[d],v=p.color,y=p.intensity,m=p.distance;if(p.isAmbientLight)n+=v.r*y,r+=v.g*y,s+=v.b*y;else if(p.isDirectionalLight){var g=u.get(p);g.color.copy(p.color).multiplyScalar(p.intensity),g.direction.setFromMatrixPosition(p.matrixWorld),tn.setFromMatrixPosition(p.target.matrixWorld),g.direction.sub(tn),g.direction.transformDirection(c),h.directional[o]=g,o++}else if(p.isSpotLight){(_=u.get(p)).position.setFromMatrixPosition(p.matrixWorld),_.position.applyMatrix4(c),_.color.copy(v).multiplyScalar(y),_.distance=m,_.direction.setFromMatrixPosition(p.matrixWorld),tn.setFromMatrixPosition(p.target.matrixWorld),_.direction.sub(tn),_.direction.transformDirection(c),_.coneCos=Math.cos(p.angle),_.penumbraCos=Math.cos(p.angle*(1-p.penumbra)),_.decay=0===p.distance?0:p.decay,h.spot[l]=_,l++}else if(p.isPointLight){var _;(_=u.get(p)).position.setFromMatrixPosition(p.matrixWorld),_.position.applyMatrix4(c),_.color.copy(p.color).multiplyScalar(p.intensity),_.distance=p.distance,_.decay=0===p.distance?0:p.decay,h.point[a]=_,a++}}h.ambient[0]=n,h.ambient[1]=r,h.ambient[2]=s,h.directional.length=o,h.spot.length=l,h.point.length=a,h.hash=h.id+","+o+","+a+","+l}},{key:"dispose",value:function(){this.cache.dispose(),this.cache=null,this.state=null}}]),t}(),nn=function(){function t(){_classCallCheck(this,t),this._lights={}}return _createClass(t,[{key:"get",value:function(t){var e=this._lights;if(void 0!==e[t.id])return e[t.id];var i=void 0;switch(t.type){case"DirectionalLight":i={direction:new Rt,color:new Nt};break;case"SpotLight":i={position:new Rt,direction:new Rt,color:new Nt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Rt,color:new Nt,distance:0,decay:0};break;case"HemisphereLight":case"RectAreaLight":console.error(" HemisphereLight  RectAreaLight ")}return e[t.id]=i,i}},{key:"dispose",value:function(){this._lights=null}}]),t}(),rn=function(){function t(){_classCallCheck(this,t),this.state={lights:new en,lightsArray:[],spritesArray:[]}}return _createClass(t,[{key:"init",value:function(){this.state.spritesArray.length=0,this.state.lightsArray.length=0}},{key:"pushLight",value:function(t){this.state.lightsArray.push(t)}},{key:"pushSprite",value:function(t){this.state.spritesArray.push(t)}},{key:"setupLights",value:function(t){this.state.lights.setup(this.state.lightsArray,[],t)}},{key:"dispose",value:function(){this.state.lights.dispose(),this.state=null}}]),t}(),sn=function(){function t(){_classCallCheck(this,t),this._renderStates={}}return _createClass(t,[{key:"get",value:function(t,e){var i=t.id+","+e.id,n=this._renderStates[i];return void 0===n&&(n=new rn,this._renderStates[i]=n),n}},{key:"dispose",value:function(){for(var t in this._renderStates)this._renderStates[t]&&this._renderStates[t].dispose();this._renderStates={}}}]),t}(),on=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t=t||{},i.gl=null,i.domElement=null,i._width=0,i._height=0,i._isContextLost=!1,i._pixelRatio=1,i._currentViewport=new zt,i._currentRenderList=null,i._currentRenderState=null,i._currentMaterialId=-1,i._currentCamera=null,i._currClearColor=new Nt(0),i._capabilities=null,i._state=null,i._sortObjects=!0,i._projScreenMatrix=new Ht,i._vector3=new Rt,i._frustum=new he,i.autoClear=!0,i.autoClearColor=!0,i.autoClearDepth=!0,i.autoClearStencil=!0,i._init(t),i._initGLContext(t),i}return _inherits(e,N),_createClass(e,[{key:"_init",value:function(t){var e=this;t=t||{},console.log("WebGLRenderer","0.0.38");var i=void 0!==t.canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==t.context?t.context:null,r=void 0!==t.alpha&&t.alpha,s=void 0===t.depth||t.depth,o=void 0===t.stencil||t.stencil,a=void 0!==t.antialias&&t.antialias,l=void 0===t.premultipliedAlpha||t.premultipliedAlpha,h=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,u=void 0!==t.powerPreference?t.powerPreference:"default";e.domElement=i,e.gl=n,e._width=i.width,e._height=i.height,e._premultipliedAlpha=l;try{var c={alpha:r,depth:s,stencil:o,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:h,powerPreference:u},d=n||i.getContext("webgl",c)||i.getContext("experimental-webgl",c);if(null===d)throw null!==i.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";e.gl=d,e._onContextLostBind=function(t){t.preventDefault(),console.log("WebGLRenderer: Context Lost."),this._isContextLost=!0,this.fire({type:"contextlost"})}.bind(e),e._onContextRestoreBind=function(){console.log("WebGLRenderer: Context Restored."),this._isContextLost=!0,this._initGLContext(parameters),this.fire({type:"contextrestore"})}.bind(e),i.addEventListener("webglcontextlost",e._onContextLostBind,!1),i.addEventListener("webglcontextrestored",e._onContextRestoreBind,!1),void 0===d.getShaderPrecisionFormat&&(d.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){console.error("WebGLRenderer: "+t)}}},{key:"_initGLContext",value:function(t){var e=this.gl,i=this._width,n=this._height,r=new zt(0,0,i,n);this._extensions=new fe(e),this._extensions.get("ANGLE_instanced_arrays"),this._utils=new ye(e),this._info=new ii(e),this._properties=new pe,this._capabilities=new ve(e,t),this._state=new Ce(e,this._extensions,this._capabilities),this._renderStates=new sn,this._textures=new Zi(e,this._extensions,this._state,this._properties,this._capabilities,this._utils,this._info),this._attributes=new Ae(e),this._geometries=new Ue(e,this._attributes,this._info),this._objects=new Xi(this._geometries,this._info),this._programCache=new Vi(e,this._extensions,this._capabilities),this._renderLists=new Hi,this._bufferRenderer=new qi(e,this._extensions,this._info),this._indexedBufferRenderer=new Yi(e,this._extensions,this._info),this._state.viewport(this._currentViewport.copy(r).multiplyScalar(this._pixelRatio)),this._info.programs=this._programCache.programs}},{key:"getContext",value:function(){return this.gl}},{key:"getPixelRatio",value:function(){return this._pixelRatio}},{key:"getCurrentViewport",value:function(){return this._currentViewport}},{key:"getClearColor",value:function(){return this._currClearColor}},{key:"setPixelRatio",value:function(t){var e=this._width,i=this._height;this._pixelRatio=t,this.setSize(e,i,!1)}},{key:"setSize",value:function(t,e,i){var n=this._pixelRatio,r=this.domElement;this._width=t,this._height=e,r.width=t*n,r.height=e*n,!1!==i&&(r.style.width=t+"px",r.style.height=e+"px"),this.setViewport(0,0,t,e)}},{key:"setViewport",value:function(t,e,i,n){this.gl;var r=new zt(t,e,i,n);this._currentViewport.copy(r).multiplyScalar(this._pixelRatio),this._state.viewport(this._currentViewport)}},{key:"setClearColor",value:function(){this.gl;var t=Array.prototype.slice.call(arguments),e=t[0],i=t[1],n=t[2],r=t[3],s=this._currClearColor.set(e,i,n,r);this._state.buffers.color.setClear(s.r,s.g,s.b,s.a,this._premultipliedAlpha)}},{key:"getClearAlpha",value:function(){return this._currClearColor.a}},{key:"setClearAlpha",value:function(t){this.gl;this._currClearColor.a=t;var e=this._currClearColor;this._state.buffers.color.setClear(e.r,e.g,e.b,e.a,this._premultipliedAlpha)}},{key:"clear",value:function(t,e,i){var n=this.gl,r=0;(void 0===t||t)&&(r|=n.COLOR_BUFFER_BIT),(void 0===e||e)&&(r|=n.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=n.STENCIL_BUFFER_BIT),n.clear(r)}},{key:"clearColor",value:function(){this.clear(!0,!1,!1)}},{key:"clearDepth",value:function(){this.clear(!1,!0,!1)}},{key:"clearStencil",value:function(){this.clear(!1,!1,!0)}},{key:"render",value:function(t,e,i){if(e&&e.isCamera){if(an="",this._currentMaterialId=-1,this._currentCamera=null,!this._isContextLost){!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),this._projScreenMatrix.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromMatrix(this._projScreenMatrix),this._currentRenderState=this._renderStates.get(t,e),this._currentRenderState.init(),this._currentRenderList=this._renderLists.get(t,e),this._currentRenderList.init(),function t(e,i,n){if(!1===e.visible)return;if(e.isLight)this._currentRenderState.pushLight(e);else if(e.isSprite){if(!e.frustumCulled||this._frustum.intersectsSprite(e)){n&&this._vector3.setFromMatrixPosition(e.matrixWorld).applyMatrix4(this._projScreenMatrix);var r=this._objects.update(e),s=e.material;this._currentRenderList.push(e,r,s,this._vector3.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||this._frustum.intersectsObject(e))){n&&this._vector3.setFromMatrixPosition(e.matrixWorld).applyMatrix4(this._projScreenMatrix);var o=this._objects.update(e),a=e.material;if(Array.isArray(a))for(var l=o.groups,h=0,u=l.length;h<u;h++){var c=l[h],d=a[c.materialIndex];d&&d.visible&&this._currentRenderList.push(e,o,d,this._vector3.z,c)}else a.visible&&this._currentRenderList.push(e,o,a,this._vector3.z,null)}var f=e.children;for(var p=0,v=f.length;p<v;p++)t.call(this,f[p],i,n)}.call(this,t,e,this._sortObjects),!0===this._sortObjects&&this._currentRenderList.sort(),this._currentRenderState.setupLights(e),this._info.autoReset&&this._info.reset(),(this.autoClear||i)&&(null===t.background?this.setClearColor(this._currClearColor):this.setClearColor(t.background),this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil));var n=this._currentRenderList.opaque,r=this._currentRenderList.transparent;n.length&&ln.call(this,n,t,e),r.length&&ln.call(this,r,t,e),this._state.buffers.depth.setTest(!0),this._state.buffers.depth.setMask(!0),this._state.buffers.color.setMask(!0),this._state.setPolygonOffset(!1),this._currentRenderList=null,this._currentRenderState=null}}else console.error("WebGLRenderer.render: camera is not an instance of Camera.")}},{key:"renderBufferDirect",value:function(t,e,i,n,r,s){var o=this.gl,a=r.isMesh&&r.matrixWorld.determinant()<0;this._state.setMaterial(n,a);var l=function(t,e,i,n){un=0;var r=this._properties.get(i),s=this._currentRenderState.state.lights;!1===i.needsUpdate&&(void 0===r.program?i.needsUpdate=!0:i.lights&&r.lightsHash!==s.state.hash&&(i.needsUpdate=!0));i.needsUpdate&&(function(t,e,i){var n=this._properties.get(t),r=this._currentRenderState.state.lights,s=this._programCache.getParameters(t,r.state),o=this._programCache.getProgramCode(t,s),a=n.program,l=!0;if(void 0===a)this._onMaterialDispose=function(t){var e=t.target;e.off("dispose",this._onMaterialDispose),this._onMaterialDispose=null,function(t){cn.call(this,t),this._properties.remove(t)}.call(this,e)}.bind(this),t.on("dispose",this._onMaterialDispose);else if(a.code!==o)cn.call(this,t);else if(n.lightsHash!==r.state.hash)properties.update(t,"lightsHash",r.state.hash),l=!1;else{if(void 0!==s.shaderID)return;l=!1}if(l){if(s.shaderID){var h=ei[s.shaderID];n.shader={name:t.type,uniforms:Be.clone(h.uniforms),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader}}else n.shader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.onBeforeCompile(n.shader,this),a=this._programCache.acquireProgram(t,n.shader,s,o),n.program=a,t.program=a}a.getAttributes();var u=n.shader.uniforms;n.lightsHash=r.state.hash,t.lights&&(u.ambientLightColor.value=r.state.ambient,u.directionalLights.value=r.state.directional,u.spotLights.value=r.state.spot,u.pointLights.value=r.state.point);var c=n.program.getUniforms(),d=si.seqWithValue(c.seq,u);n.uniformsList=d}.call(this,i,e,n),i.needsUpdate=!1);var o=!1,a=!1,l=!1,h=r.program,u=h.getUniforms(),c=r.shader.uniforms;this._state.useProgram(h.program)&&(o=!0,a=!0,l=!0);i.id!==this._currentMaterialId&&(this._currentMaterialId=i.id,a=!0);(o||t!==this._currentCamera)&&(u.setValue("projectionMatrix",t.projectionMatrix),t!==this._currentCamera&&(this._currentCamera=t,a=!0,l=!0));if(a){var d=function(){c.dashSize.value=i.dashSize,c.totalSize.value=i.dashSize+i.gapSize,c.scale.value=i.scale};i.lights&&(p=l,(f=c).ambientLightColor.needsUpdate=p,f.directionalLights.needsUpdate=p,f.pointLights.needsUpdate=p,f.spotLights.needsUpdate=p),(i.isMeshBasicMaterial||i.isLineBasicMaterial||i.isMeshLambertMaterial||i.isMeshPhongMaterial||i.isPointsMaterial||i.isLineMeshMaterial||i.isSpriteMaterial)&&(i.color&&(c.diffuse.value=i.color),i.map&&(c.map.value=i.map),c.opacity.value=i.opacity,i.emissive&&c.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(!0===i.map.matrixAutoUpdate&&i.map.updateMatrix(),c.uvTransform.value.copy(i.map.matrix))),i.isLineBasicMaterial?i.isLineDashedMaterial&&d():i.isMeshPhongMaterial?(c.specular.value=i.specular,c.shininess.value=Math.max(i.shininess,1e-4)):i.isPointsMaterial?(c.size.value=i.size*this._pixelRatio,c.scale.value=.5*this._height):i.isSpriteMaterial?c.rotation.value=i.rotation:i.isLineMeshMaterial&&(d(),c.linewidth.value=i.linewidth,c.resolution.value.copy(i.resolution)),si.upload(this.gl,r.uniformsList,c,this)}var f,p;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(si.upload(this.gl,r.uniformsList,c,this),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&u.setValue("center",n.center);return u.setValue("modelViewMatrix",n.modelViewMatrix),u.setValue("normalMatrix",n.normalMatrix),u.setValue("modelMatrix",n.matrixWorld),h}.call(this,t,e,n,r),h=function(t,e,i){var n=t.id+"_"+e.id+"_"+(!0===i.wireframe),r=!1;n!==an&&(r=!0,an=n);return r}(i,l,n),u=i.index,c=i.attributes.position,d=1;!0===n.wireframe&&(u=this._geometries.getWireframeAttribute(i),d=2);var f=void 0,p=this._bufferRenderer;null!==u&&(f=this._attributes.get(u),(p=this._indexedBufferRenderer).setIndex(f)),h&&(function(t,e,i){if(i&&i.isInstancedBufferGeometry&&null===this._extensions.get("ANGLE_instanced_arrays"))return void console.error("WebGLRenderer.setupVertexAttributes: using InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");this._state.initAttributes();var n=this.gl,r=i.attributes,s=e.getAttributes(),o=t.defaultAttributeValues;for(var a in s){var l=s[a];if(l>=0){var h=r[a];if(void 0!==h){var u=h.normalized,c=h.itemSize,d=this._attributes.get(h);if(void 0===d)continue;var f=d.buffer,p=d.type,v=d.bytesPerElement;if(h.isInterleavedBufferAttribute){var y=h.data,m=y.stride,g=h.offset;y&&y.isInstancedInterleavedBuffer?(this._state.enableAttributeAndDivisor(l,y.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=y.meshPerAttribute*y.count)):this._state.enableAttribute(l),n.bindBuffer(n.ARRAY_BUFFER,f),n.vertexAttribPointer(l,c,p,u,m*v,g*v)}else h.isInstancedBufferAttribute?(this._state.enableAttributeAndDivisor(l,h.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=h.meshPerAttribute*h.count)):this._state.enableAttribute(l),n.bindBuffer(n.ARRAY_BUFFER,f),n.vertexAttribPointer(l,c,p,u,0,0)}else if(void 0!==o){var _=o[a];if(void 0!==_)switch(_.length){case 2:n.vertexAttrib2fv(l,_);break;case 3:n.vertexAttrib3fv(l,_);break;case 4:n.vertexAttrib4fv(l,_);break;default:n.vertexAttrib1fv(l,_)}}}}this._state.disableUnusedAttributes()}.call(this,n,l,i),null!==u&&o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,f.buffer));var v=1/0;null!==u?v=u.count:void 0!==c&&(v=c.count);var y=i.drawRange.start*d,m=i.drawRange.count*d,g=null!==s?s.start*d:0,_=null!==s?s.count*d:1/0,x=Math.max(y,g),b=Math.min(v,y+m,g+_)-1,w=Math.max(0,b-x+1);if(0!==w){if(r.isMesh)if(!0===n.wireframe)this._state.setLineWidth(n.wireframeLinewidth*this._pixelRatio),p.setMode(o.LINES);else switch(r.drawMode){case F:p.setMode(o.TRIANGLES);break;case 5:p.setMode(o.TRIANGLE_STRIP);break;case 6:p.setMode(o.TRIANGLE_FAN)}else if(r.isLine){var k=n.linewidth;switch(void 0===k&&(k=1),this._state.setLineWidth(k*this._pixelRatio),r.drawMode){case U:p.setMode(o.LINES);break;case 2:p.setMode(o.LINE_LOOP);break;case 3:p.setMode(o.LINE_STRIP)}}else r.isPoints?p.setMode(o.POINTS):r.isSprite&&p.setMode(o.TRIANGLES);i&&i.isInstancedBufferGeometry?i.maxInstancedCount>0&&p.renderInstances(i,x,w):p.render(x,w)}}},{key:"allocTextureUnit",value:function(){var t=un;return t>=this._capabilities.maxTextures&&console.warn("WebGLRenderer: Trying to use "+t+" texture units while this GPU supports only "+capabilities.maxTextures),un+=1,t}},{key:"setTexture2D",value:function(t,e){this._textures.setTexture2D(t,e)}},{key:"setTextureCube",value:function(){}},{key:"dispose",value:function(){this.domElement.removeEventListener("webglcontextlost",this._onContextLostBind,!1),this.domElement.removeEventListener("webglcontextrestored",this._onContextRestoreBind,!1),this._onContextLostBind=null,this._onContextRestoreBind=null,this._renderLists.dispose(),this._renderStates.dispose(),this._properties.dispose(),this._objects.dispose()}}]),e}(),an="";function ln(t,e,i){for(var n=0,r=t.length;n<r;n++){var s=t[n],o=s.object,a=s.geometry,l=s.material,h=s.group;hn.call(this,o,e,i,a,l,h)}}function hn(t,e,i,n,r,s){t.onBeforeRender(this,e,i,n,r,s),this._currentRenderState=this._renderStates.get(e,i),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),this.renderBufferDirect(i,e.fog,n,r,t,s),t.onAfterRender(this,e,i,n,r,s)}var un=0;function cn(t){var e=this._properties.get(t).program;t.program=void 0,void 0!==e&&this._programCache.releaseProgram(e)}var dn,fn=new Rt,pn=function(){function t(e,i,n,r){_classCallCheck(this,t),this._x=e||0,this._y=i||0,this._z=n||0,this._w=void 0!==r?r:1}return _createClass(t,[{key:"set",value:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this.onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this}},{key:"setFromEuler",value:function(t,e){if(!t||!t.isEuler)throw new Error("Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=t._x,n=t._y,r=t._z,s=t.order,o=Math.cos,a=Math.sin,l=o(i/2),h=o(n/2),u=o(r/2),c=a(i/2),d=a(n/2),f=a(r/2);return"XYZ"===s?(this._x=c*h*u+l*d*f,this._y=l*d*u-c*h*f,this._z=l*h*f+c*d*u,this._w=l*h*u-c*d*f):"YXZ"===s?(this._x=c*h*u+l*d*f,this._y=l*d*u-c*h*f,this._z=l*h*f-c*d*u,this._w=l*h*u+c*d*f):"ZXY"===s?(this._x=c*h*u-l*d*f,this._y=l*d*u+c*h*f,this._z=l*h*f+c*d*u,this._w=l*h*u-c*d*f):"ZYX"===s?(this._x=c*h*u-l*d*f,this._y=l*d*u+c*h*f,this._z=l*h*f-c*d*u,this._w=l*h*u+c*d*f):"YZX"===s?(this._x=c*h*u+l*d*f,this._y=l*d*u+c*h*f,this._z=l*h*f-c*d*u,this._w=l*h*u-c*d*f):"XZY"===s&&(this._x=c*h*u-l*d*f,this._y=l*d*u-c*h*f,this._z=l*h*f+c*d*u,this._w=l*h*u+c*d*f),!1!==e&&this.onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(t,e){var i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this.onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(t){var e,i=t.elements,n=i[0],r=i[4],s=i[8],o=i[1],a=i[5],l=i[9],h=i[2],u=i[6],c=i[10],d=n+a+c;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(u-l)*e,this._y=(s-h)*e,this._z=(o-r)*e):n>a&&n>c?(e=2*Math.sqrt(1+n-a-c),this._w=(u-l)/e,this._x=.25*e,this._y=(r+o)/e,this._z=(s+h)/e):a>c?(e=2*Math.sqrt(1+a-n-c),this._w=(s-h)/e,this._x=(r+o)/e,this._y=.25*e,this._z=(l+u)/e):(e=2*Math.sqrt(1+c-n-a),this._w=(o-r)/e,this._x=(s+h)/e,this._y=(l+u)/e,this._z=.25*e),this.onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(t,e){return void 0===fn&&(fn=new Rt),(dn=t.dot(e)+1)<1e-6?(dn=0,Math.abs(t.x)>Math.abs(t.z)?fn.set(-t.y,t.x,0):fn.set(0,-t.z,t.y)):fn.crossVectors(t,e),this._x=fn.x,this._y=fn.y,this._z=fn.z,this._w=dn,this.normalize()}},{key:"inverse",value:function(){return this.conjugate().normalize()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}},{key:"dot",value:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this}},{key:"multiply",value:function(t,e){return void 0!==e?(console.warn("Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}},{key:"premultiply",value:function(t){return this.multiplyQuaternions(t,this)}},{key:"multiplyQuaternions",value:function(t,e){var i=t._x,n=t._y,r=t._z,s=t._w,o=e._x,a=e._y,l=e._z,h=e._w;return this._x=i*h+s*o+n*l-r*a,this._y=n*h+s*a+r*o-i*l,this._z=r*h+s*l+i*a-n*o,this._w=s*h-i*o-n*a-r*l,this.onChangeCallback(),this}},{key:"slerp",value:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,n=this._y,r=this._z,s=this._w,o=s*t._w+i*t._x+n*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;var a=Math.sqrt(1-o*o);if(Math.abs(a)<.001)return this._w=.5*(s+this._w),this._x=.5*(i+this._x),this._y=.5*(n+this._y),this._z=.5*(r+this._z),this;var l=Math.atan2(a,o),h=Math.sin((1-e)*l)/a,u=Math.sin(e*l)/a;return this._w=s*h+this._w*u,this._x=i*h+this._x*u,this._y=n*h+this._y*u,this._z=r*h+this._z*u,this.onChangeCallback(),this}},{key:"equals",value:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}},{key:"fromArray",value:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this}},{key:"toArray",value:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}},{key:"onChange",value:function(t){return this.onChangeCallback=t,this}},{key:"onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}],[{key:"slerp",value:function(t,e,i,n){return i.copy(t).slerp(e,n)}},{key:"slerpFlat",value:function(t,e,i,n,r,s,o){var a=i[n+0],l=i[n+1],h=i[n+2],u=i[n+3],c=r[s+0],d=r[s+1],f=r[s+2],p=r[s+3];if(u!==p||a!==c||l!==d||h!==f){var v=1-o,y=a*c+l*d+h*f+u*p,m=y>=0?1:-1,g=1-y*y;if(g>Number.EPSILON){var _=Math.sqrt(g),x=Math.atan2(_,y*m);v=Math.sin(v*x)/_,o=Math.sin(o*x)/_}var b=o*m;if(a=a*v+c*b,l=l*v+d*b,h=h*v+f*b,u=u*v+p*b,v===1-o){var w=1/Math.sqrt(a*a+l*l+h*h+u*u);a*=w,l*=w,h*=w,u*=w}}t[e]=a,t[e+1]=l,t[e+2]=h,t[e+3]=u}}]),t}(),vn=new Ht,yn=new pn,mn=function(){function t(e,i,n,r){_classCallCheck(this,t),this._x=e||0,this._y=i||0,this._z=n||0,this._order=r||t.DefaultOrder,this.isEuler=!0}return _createClass(t,[{key:"set",value:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._order=n||this._order,this.onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(t,e,i){var n=It.clamp,r=t.elements,s=r[0],o=r[4],a=r[8],l=r[1],h=r[5],u=r[9],c=r[2],d=r[6],f=r[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,h),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-c,s),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-c,f),this._z=Math.atan2(-o,h)):(this._y=0,this._z=Math.atan2(l,s))):"ZYX"===e?(this._y=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,h))):"YZX"===e?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-c,s)):(this._x=0,this._y=Math.atan2(a,f))):"XZY"===e?(this._z=Math.asin(-n(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(d,h),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,f),this._y=0)):console.warn("Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==i&&this.onChangeCallback(),this}},{key:"setFromQuaternion",value:function(t,e,i){return vn.makeRotationFromQuaternion(t),this.setFromRotationMatrix(vn,e,i)}},{key:"setFromVector3",value:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)}},{key:"reorder",value:function(t){return yn.setFromEuler(this),this.setFromQuaternion(yn,t)}},{key:"equals",value:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}},{key:"fromArray",value:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this}},{key:"toArray",value:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}},{key:"toVector3",value:function(t){return t?t.set(this._x,this._y,this._z):new Rt(this._x,this._y,this._z)}},{key:"onChange",value:function(t){return this.onChangeCallback=t,this}},{key:"onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}]),t}();mn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],mn.DefaultOrder="XYZ";var gn=0,_n=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));Object.defineProperty(t,"id",{value:gn++}),t.parent=null,t.children=[],t.up=e.DefaultUp.clone();var i=new Rt,n=new mn,r=new pn,s=new Rt(1,1,1);return n.onChange(function(){r.setFromEuler(n,!1)}),r.onChange(function(){n.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(t,{position:{enumerable:!0,value:i},rotation:{enumerable:!0,value:n},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:s},modelViewMatrix:{value:new Ht},normalMatrix:{value:new ie}}),t.matrix=new Ht,t.matrixWorld=new Ht,t.matrixAutoUpdate=e.DefaultMatrixAutoUpdate,t.matrixWorldNeedsUpdate=!1,t.visible=!0,t.castShadow=!1,t.receiveShadow=!1,t.frustumCulled=!0,t.renderOrder=0,t.userData={},t}return _inherits(e,N),_createClass(e,[{key:"onBeforeRender",value:function(t,e,i,n,r,s){}},{key:"onAfterRender",value:function(t,e,i,n,r,s){}},{key:"applyMatrix",value:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"lookAt",value:function(t,e,i){Cn.call(this,t,e,i)}},{key:"add",value:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.fire({type:"added"}),this.children.push(t)):console.error("Object3D.add: object not an instance of Object3D.",t),this)}},{key:"remove",value:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var i=this.children.indexOf(t);return-1!==i&&(t.parent=null,t.fire({type:"removed"}),this.children.splice(i,1)),this}},{key:"traverse",value:function(t){t(this);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].traverse(t)}},{key:"updateMatrixWorld",value:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)}},{key:"applyQuaternion",value:function(t){return this.quaternion.premultiply(t),this}},{key:"setRotationFromAxisAngle",value:function(t,e){this.quaternion.setFromAxisAngle(t,e)}},{key:"setRotationFromEuler",value:function(t){this.quaternion.setFromEuler(t,!0)}},{key:"setRotationFromMatrix",value:function(t){this.quaternion.setFromRotationMatrix(t)}},{key:"setRotationFromQuaternion",value:function(t){this.quaternion.copy(t)}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"rotateX",value:function(t){var e=new Rt(1,0,0);return this.rotateOnAxis(e,t),e=null,this}},{key:"rotateY",value:function(t){var e=new Rt(0,1,0);return this.rotateOnAxis(e,t),e=null,this}},{key:"rotateZ",value:function(t){var e=new Rt(0,0,1);return this.rotateOnAxis(e,t),e=null,this}},{key:"rotateOnAxis",value:function(t,e){var i=new pn;return i.setFromAxisAngle(t,e),this.quaternion.multiply(i),i=null,this}},{key:"rotateOnWorldAxis",value:function(t,e){var i=new pn;return i.setFromAxisAngle(t,e),this.quaternion.premultiply(i),this}},{key:"translateOnAxis",value:function(t,e){var i=new Rt;return i.copy(t).applyQuaternion(this.quaternion),this.position.add(i.multiplyScalar(e)),i=null,this}},{key:"translateX",value:function(t){var e=new Rt(1,0,0);return this.translateOnAxis(e,t),e=null,this}},{key:"translateY",value:function(t){var e=new Rt(0,1,0);return this.translateOnAxis(e,t),e=null,this}},{key:"translateZ",value:function(t){var e=new Rt(0,0,1);return this.translateOnAxis(e,t),e=null,this}},{key:"localToWorld",value:function(t){return t.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(t){var e=new Ht;return t.applyMatrix4(e.getInverse(this.matrixWorld))}},{key:"getWorldPosition",value:function(t){return void 0===t&&(console.warn("Object3D: .getWorldPosition() target is now required"),t=new Rt),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(t){return An.call(this,t)}},{key:"getWorldScale",value:function(t){return Ln.call(this,t)}},{key:"getWorldDirection",value:function(t){return Mn.call(this,t)}},{key:"raycast",value:function(){}},{key:"isObject3D",get:function(){return!0}}]),e}();_n.DefaultUp=new Rt(0,1,0),_n.DefaultMatrixAutoUpdate=!0;var xn,bn,wn,kn,Sn,Cn=function(){var t=new Ht,e=new Rt;return function(i,n,r){i.isVector3?e.copy(i):e.set(i,n,r),this.isCamera?t.lookAt(this.position,e,this.up):t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),An=(xn=new Rt,bn=new Rt,function(t){return void 0===t&&(console.warn("Object3D: .getWorldQuaternion() target is now required"),t=new pn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(xn,t,bn),t}),Ln=function(){var t=new Rt,e=new pn;return function(i){return void 0===i&&(console.warn("Object3D: .getWorldScale() target is now required"),i=new Rt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,i),i}}(),Mn=(wn=new pn,function(t){return void 0===t&&(console.warn("Object3D: .getWorldDirection() target is now required"),t=new Rt),this.getWorldQuaternion(wn),t.set(0,0,1).applyQuaternion(wn)}),Pn=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.background=null,t.isScene=!0,t.autoUpdate=!0,t}return _inherits(e,_n),e}(),En=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.type="Group",t}return _inherits(e,_n),_createClass(e,[{key:"isGroup",get:function(){return!0}}]),e}(),Tn=new Rt,On=new Rt,Dn=new Rt,zn=new Rt,In=new Rt,Rn=new Rt,Nn=new Rt,Un=(Nn=new Rt,new Rt),Fn=new Rt,Bn=new Rt,Vn=function(){function t(e,i){_classCallCheck(this,t),this.origin=void 0!==e?e:new Rt,this.direction=void 0!==i?i:new Rt}return _createClass(t,[{key:"set",value:function(t,e){return this.origin.copy(t),this.direction.copy(e),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}},{key:"at",value:function(t,e){return(e||new Rt).copy(this.direction).multiplyScalar(t).add(this.origin)}},{key:"lookAt",value:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this}},{key:"recast",value:function(t){return this.origin.copy(this.at(t,On)),this}},{key:"closestPointToPoint",value:function(t,e){var i=e||new Rt;i.subVectors(t,this.origin);var n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(n).add(this.origin)}},{key:"distanceToPoint",value:function(t){return Math.sqrt(this.distanceSqToPoint(t))}},{key:"distanceSqToPoint",value:function(t){var e=Dn.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Dn.copy(this.direction).multiplyScalar(e).add(this.origin),Dn.distanceToSquared(t))}},{key:"distanceSqToSegment",value:function(t,e,i,n){In.copy(t).add(e).multiplyScalar(.5),Rn.copy(e).sub(t).normalize(),Nn.copy(this.origin).sub(In);var r,s,o,a,l=.5*t.distanceTo(e),h=-this.direction.dot(Rn),u=Nn.dot(this.direction),c=-Nn.dot(Rn),d=Nn.lengthSq(),f=Math.abs(1-h*h);if(f>0)if(s=h*u-c,a=l*f,(r=h*c-u)>=0)if(s>=-a)if(s<=a){var p=1/f;o=(r*=p)*(r+h*(s*=p)+2*u)+s*(h*r+s+2*c)+d}else s=l,o=-(r=Math.max(0,-(h*s+u)))*r+s*(s+2*c)+d;else s=-l,o=-(r=Math.max(0,-(h*s+u)))*r+s*(s+2*c)+d;else s<=-a?o=-(r=Math.max(0,-(-h*l+u)))*r+(s=r>0?-l:Math.min(Math.max(-l,-c),l))*(s+2*c)+d:s<=a?(r=0,o=(s=Math.min(Math.max(-l,-c),l))*(s+2*c)+d):o=-(r=Math.max(0,-(h*l+u)))*r+(s=r>0?l:Math.min(Math.max(-l,-c),l))*(s+2*c)+d;else s=h>0?-l:l,o=-(r=Math.max(0,-(h*s+u)))*r+s*(s+2*c)+d;return i&&i.copy(this.direction).multiplyScalar(r).add(this.origin),n&&n.copy(Rn).multiplyScalar(s).add(In),o}},{key:"intersectSphere",value:function(t,e){zn.subVectors(t.center,this.origin);var i=zn.dot(this.direction),n=zn.dot(zn)-i*i,r=t.radius*t.radius;if(n>r)return null;var s=Math.sqrt(r-n),o=i-s,a=i+s;return o<0&&a<0?null:o<0?this.at(a,e):this.at(o,e)}},{key:"intersectsSphere",value:function(t){return this.distanceToPoint(t.center)<=t.radius}},{key:"distanceToPlane",value:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}},{key:"intersectPlane",value:function(t,e){var i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}},{key:"intersectsPlane",value:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}},{key:"intersectBox",value:function(t,e){var i,n,r,s,o,a,l=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,c=this.origin;return l>=0?(i=(t.min.x-c.x)*l,n=(t.max.x-c.x)*l):(i=(t.max.x-c.x)*l,n=(t.min.x-c.x)*l),h>=0?(r=(t.min.y-c.y)*h,s=(t.max.y-c.y)*h):(r=(t.max.y-c.y)*h,s=(t.min.y-c.y)*h),i>s||r>n?null:((r>i||i!=i)&&(i=r),(s<n||n!=n)&&(n=s),u>=0?(o=(t.min.z-c.z)*u,a=(t.max.z-c.z)*u):(o=(t.max.z-c.z)*u,a=(t.min.z-c.z)*u),i>a||o>n?null:((o>i||i!=i)&&(i=o),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,e)))}},{key:"intersectsBox",value:function(t){return null!==this.intersectBox(t,Tn)}},{key:"intersectTriangle",value:function(t,e,i,n,r){Un.subVectors(e,t),Fn.subVectors(i,t),Bn.crossVectors(Un,Fn);var s,o=this.direction.dot(Bn);if(o>0){if(n)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}Nn.subVectors(this.origin,t);var a=s*this.direction.dot(Fn.crossVectors(Nn,Fn));if(a<0)return null;var l=s*this.direction.dot(Un.cross(Nn));if(l<0)return null;if(a+l>o)return null;var h=-s*Nn.dot(Bn);return h<0?null:this.at(h/o,r)}},{key:"applyMatrix4",value:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}},{key:"equals",value:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}]),t}(),Gn=new Rt,Wn=new Rt,jn=function(){function t(e,i){_classCallCheck(this,t),this.start=void 0!==e?e:new Rt,this.end=void 0!==i?i:new Rt}return _createClass(t,[{key:"set",value:function(t,e){return this.start.copy(t),this.end.copy(e),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.start.copy(t.start),this.end.copy(t.end),this}},{key:"getCenter",value:function(t){return(t||new Rt).addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(t){return(t||new Rt).subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(t,e){var i=e||new Rt;return this.delta(i).multiplyScalar(t).add(this.start)}},{key:"closestPointToPointParameter",value:function(t,e){Gn.subVectors(t,this.start),Wn.subVectors(this.end,this.start);var i=Wn.dot(Wn),n=Wn.dot(Gn)/i;return e&&(n=It.clamp(n,0,1)),n}},{key:"closestPointToPoint",value:function(t,e,i){var n=this.closestPointToPointParameter(t,e),r=i||new Rt;return this.delta(r).multiplyScalar(n).add(this.start)}},{key:"applyMatrix4",value:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}},{key:"equals",value:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}]),t}(),Hn=new Rt,qn=new Rt,Xn=new Rt,Yn=new Rt,Zn=new Rt,Qn=new Rt,Kn=new Rt,Jn=new le,$n=[new jn,new jn,new jn],tr=new Rt,er=new Rt,ir=function(){function t(e,i,n){_classCallCheck(this,t),this.a=void 0!==e?e:new Rt,this.b=void 0!==i?i:new Rt,this.c=void 0!==n?n:new Rt}return _createClass(t,[{key:"set",value:function(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}},{key:"setFromPointsAndIndices",value:function(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}},{key:"area",value:function(){return Qn.subVectors(this.c,this.b),Kn.subVectors(this.a,this.b),.5*Qn.cross(Kn).length()}},{key:"midpoint",value:function(t){return(t||new Rt).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"normal",value:function(e){return t.normal(this.a,this.b,this.c,e)}},{key:"plane",value:function(t){return(t||new le).setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"barycoordFromPoint",value:function(e,i){return t.barycoordFromPoint(e,this.a,this.b,this.c,i)}},{key:"containsPoint",value:function(e){return t.containsPoint(e,this.a,this.b,this.c)}},{key:"closestPointToPoint",value:function(t,e){var i=e||new Rt,n=1/0;if(Jn.setFromCoplanarPoints(this.a,this.b,this.c),Jn.projectPoint(t,tr),!0===this.containsPoint(tr))i.copy(tr);else{$n[0].set(this.a,this.b),$n[1].set(this.b,this.c),$n[2].set(this.c,this.a);for(var r=0;r<$n.length;r++){$n[r].closestPointToPoint(tr,!0,er);var s=tr.distanceToSquared(er);s<n&&(n=s,i.copy(er))}}return i}},{key:"equals",value:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}],[{key:"normal",value:function(t,e,i,n){var r=n||new Rt;r.subVectors(i,e),Hn.subVectors(t,e),r.cross(Hn);var s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}},{key:"getNormal",value:function(t,e,i,n){return rr.call(this,t,e,i,n)}},{key:"barycoordFromPoint",value:function(t,e,i,n,r){qn.subVectors(n,e),Xn.subVectors(i,e),Yn.subVectors(t,e);var s=qn.dot(qn),o=qn.dot(Xn),a=qn.dot(Yn),l=Xn.dot(Xn),h=Xn.dot(Yn),u=s*l-o*o,c=r||new Rt;if(0===u)return c.set(-2,-1,-1);var d=1/u,f=(l*a-o*h)*d,p=(s*h-o*a)*d;return c.set(1-f-p,p,f)}},{key:"containsPoint",value:function(e,i,n,r){var s=t.barycoordFromPoint(e,i,n,r,Zn);return s.x>=0&&s.y>=0&&s.x+s.y<=1}},{key:"getBarycoord",value:function(t,e,i,n,r){return nr.call(this,t,e,i,n,r)}}]),t}(),nr=function(){var t=new Rt,e=new Rt,i=new Rt;return function(n,r,s,o,a){t.subVectors(o,r),e.subVectors(s,r),i.subVectors(n,r);var l=t.dot(t),h=t.dot(e),u=t.dot(i),c=e.dot(e),d=e.dot(i),f=l*c-h*h;if(void 0===a&&(console.warn("Triangle: .getBarycoord() target is now required"),a=new Rt),0===f)return a.set(-2,-1,-1);var p=1/f,v=(c*u-h*d)*p,y=(l*d-h*u)*p;return a.set(1-v-y,y,v)}}(),rr=function(){var t=new Rt;return function(e,i,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new Rt),r.subVectors(n,i),t.subVectors(e,i),r.cross(t);var s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}}(),sr=function(){function t(e,i,n,r,s,o){_classCallCheck(this,t),this.a=e,this.b=i,this.c=n,this.normal=r&&r.isVector3?r:new Rt,this.vertexNormals=Array.isArray(r)?r:[],this.color=s&&s.isColor?s:new Nt,this.vertexColors=Array.isArray(s)?s:[],this.materialIndex=void 0!==o?o:0}return _createClass(t,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}}]),t}(),or=0,ar=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.type="Material",Object.defineProperty(t,"id",{value:or++}),t.opacity=1,t.transparent=!1,t.lights=!0,t.depthFunc=B,t.depthTest=!0,t.depthWrite=!0,t.blending=j,t.side=V,t.vertexColors=Dt,t.visible=!0,t.needsUpdate=!0,t.colorWrite=!0,t.precision=null,t.polygonOffset=!1,t.polygonOffsetFactor=0,t.polygonOffsetUnits=0,t.blendSrc=J,t.blendDst=tt,t.blendEquation=H,t.blendSrcAlpha=null,t.blendDstAlpha=null,t.blendEquationAlpha=null,t.premultipliedAlpha=!1,t.userData={},t.onBeforeCompile=function(){},t}return _inherits(e,N),_createClass(e,[{key:"setValues",value:function(t){if(void 0!==t)for(var e in t){var i=t[e];if(void 0!==i){var n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]="overdraw"===e?Number(i):i:console.warn(this.type+": '"+e+"' is not a property of this material.")}else console.warn("Material: '"+e+"' parameter is undefined.")}}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.name=t.name,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this}},{key:"dispose",value:function(){this.fire({type:"dispose"})}},{key:"isMaterial",get:function(){return!0}}]),e}(),lr=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.color=new Nt(16777215),i.map=null,i.type="MeshBasicMaterial",i.wireframe=!1,i.wireframeLinewidth=1,i.lights=!1,i.setValues(t),i}return _inherits(e,ar),_createClass(e,[{key:"copy",value:function(t){return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.map=t.map,this.wireframe=t.wireframe,this}},{key:"isMeshBasicMaterial",get:function(){return!0}}]),e}(),hr=function(t){function e(t,i){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.geometry=t,n.material=i,n.drawMode=F,n}return _inherits(e,_n),_createClass(e,[{key:"setDrawMode",value:function(t){this.drawMode=t}},{key:"raycast",value:function(t,e){ur.call(this,t,e)}},{key:"isMesh",get:function(){return!0}}]),e}(),ur=function(){var t=new Ht,e=new Vn,i=new te,n=new Rt,r=new Rt,s=new Rt,o=new Rt,a=new Rt,l=new Rt,h=new Pe,u=new Pe,c=new Pe,d=new Rt,f=new Rt,p=new Rt;function v(t,e,i,n,r,s,o){return ir.getBarycoord(t,e,i,n,d),r.multiplyScalar(d.x),s.multiplyScalar(d.y),o.multiplyScalar(d.z),r.add(s).add(o),r.clone()}function y(t,e,i,n,r,s,o,a){if(null===(e.side===G?n.intersectTriangle(o,s,r,!0,a):n.intersectTriangle(r,s,o,e.side!==W,a)))return null;p.copy(a),p.applyMatrix4(t.matrixWorld);var l=i.ray.origin.distanceTo(p);return l<i.near||l>i.far?null:{distance:l,point:p.clone(),object:t}}function m(t,e,i,o,a,l,d,p){n.fromBufferAttribute(o,l),r.fromBufferAttribute(o,d),s.fromBufferAttribute(o,p);var m=y(t,t.material,e,i,n,r,s,f);if(m){a&&(h.fromBufferAttribute(a,l),u.fromBufferAttribute(a,d),c.fromBufferAttribute(a,p),m.uv=v(f,n,r,s,h,u,c));var g=new sr(l,d,p);ir.getNormal(n,r,s,g.normal),m.face=g}return m}return function(d,p){var g,_=this.geometry,x=this.material,b=this.matrixWorld;if(void 0!==x&&(null===_.boundingSphere&&_.computeBoundingSphere(),i.copy(_.boundingSphere),i.applyMatrix4(b),!1!==d.ray.intersectsSphere(i)&&(t.getInverse(b),e.copy(d.ray).applyMatrix4(t),null===_.boundingBox||!1!==e.intersectsBox(_.boundingBox))))if(_.isBufferGeometry){var w,k,S,C,A,L=_.index,M=_.attributes.position,P=_.attributes.uv;if(null!==L)for(C=0,A=L.count;C<A;C+=3)w=L.getX(C),k=L.getX(C+1),S=L.getX(C+2),(g=m(this,d,e,M,P,w,k,S))&&(g.faceIndex=Math.floor(C/3),p.push(g));else if(void 0!==M)for(C=0,A=M.count;C<A;C+=3)(g=m(this,d,e,M,P,w=C,k=C+1,S=C+2))&&(g.faceIndex=Math.floor(C/3),p.push(g))}else if(_.isGeometry){var E,T,O,D,z=Array.isArray(x),I=_.vertices,R=_.faces,N=_.faceVertexUvs[0];N.length>0&&(D=N);for(var U=0,F=R.length;U<F;U++){var B=R[U],V=z?x[B.materialIndex]:x;if(void 0!==V){if(E=I[B.a],T=I[B.b],O=I[B.c],!0===V.morphTargets){var G=_.morphTargets,W=this.morphTargetInfluences;n.set(0,0,0),r.set(0,0,0),s.set(0,0,0);for(var j=0,H=G.length;j<H;j++){var q=W[j];if(0!==q){var X=G[j].vertices;n.addScaledVector(o.subVectors(X[B.a],E),q),r.addScaledVector(a.subVectors(X[B.b],T),q),s.addScaledVector(l.subVectors(X[B.c],O),q)}}n.add(E),r.add(T),s.add(O),E=n,T=r,O=s}if(g=y(this,V,d,e,E,T,O,f)){if(D&&D[U]){var Y=D[U];h.copy(Y[0]),u.copy(Y[1]),c.copy(Y[2]),g.uv=v(f,E,T,O,h,u,c)}g.face=B,g.faceIndex=U,p.push(g)}}}}}}(),cr=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.type="LineBasicMaterial",i.color=new Nt(16777215),i.linewidth=1,i.lights=!1,i.setValues(t),i}return _inherits(e,ar),_createClass(e,[{key:"copy",value:function(t){return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this}},{key:"isLineBasicMaterial",get:function(){return!0}}]),e}(),dr=function(t){function e(t,i){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.type="Line",n.geometry=void 0!==t?t:new Re,n.material=void 0!==i?i:new cr({color:16777215*Math.random()}),n.drawMode=U,n.material.isLineDashedMaterial&&n.computeLineDistances(),n}return _inherits(e,_n),_createClass(e,[{key:"setDrawMode",value:function(t){this.drawMode=t}},{key:"computeLineDistances",value:function(){fr.call(this)}},{key:"raycast",value:function(t,e){pr.call(this,t,e)}},{key:"isLine",get:function(){return!0}}]),e}(),fr=(kn=new Rt,Sn=new Rt,function(){var t=this.geometry;if(t.isBufferGeometry){if(null===t.index){for(var e=t.attributes.position,i=[],n=0,r=e.count;n<r;n+=2)kn.fromBufferAttribute(e,n),Sn.fromBufferAttribute(e,n+1),i[n]=0===n?0:i[n-1],i[n+1]=i[n]+kn.distanceTo(Sn);t.addAttribute("lineDistance",new De(i,1))}}else if(t.isGeometry){var s=t.vertices;for(i=t.lineDistances,n=0,r=s.length;n<r;n+=2)kn.copy(s[n]),Sn.copy(s[n+1]),i[n]=0===n?0:i[n-1],i[n+1]=i[n]+kn.distanceTo(Sn)}return this}),pr=function(){var t=new Ht,e=new Vn,i=new te;return function(n,r){var s=n.linePrecision,o=s*s,a=this.geometry,l=this.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),i.copy(a.boundingSphere),i.applyMatrix4(l),!1!==n.ray.intersectsSphere(i)){t.getInverse(l),e.copy(n.ray).applyMatrix4(t);var h=new Rt,u=new Rt,c=new Rt,d=new Rt;if(a.isBufferGeometry){var f=a.index,p=a.attributes.position.array;if(null!==f)for(var v=f.array,y=0,m=v.length-1;y<m;y+=1){var g=v[y],_=v[y+1];if(h.fromArray(p,3*g),u.fromArray(p,3*_),!(e.distanceSqToSegment(h,u,d,c)>o))d.applyMatrix4(this.matrixWorld),(w=n.ray.origin.distanceTo(d))<n.near||w>n.far||r.push({distance:w,point:c.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}else for(y=0,m=p.length/3-1;y<m;y+=1){if(h.fromArray(p,3*y),u.fromArray(p,3*y+3),!(e.distanceSqToSegment(h,u,d,c)>o))d.applyMatrix4(this.matrixWorld),(w=n.ray.origin.distanceTo(d))<n.near||w>n.far||r.push({distance:w,point:c.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else if(a.isGeometry){var x=a.vertices,b=x.length;for(y=0;y<b-1;y+=1){var w;if(!(e.distanceSqToSegment(x[y],x[y+1],d,c)>o))d.applyMatrix4(this.matrixWorld),(w=n.ray.origin.distanceTo(d))<n.near||w>n.far||r.push({distance:w,point:c.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}}}(),vr=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.type="InstancedBufferGeometry",t.maxInstancedCount=void 0,t.isInstancedBufferGeometry=!0,t}return _inherits(e,Re),_createClass(e,[{key:"copy",value:function(t){return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"copy",this).call(this,t),this.maxInstancedCount=t.maxInstancedCount,this}},{key:"clone",value:function(){return(new this.coFnstructor).copy(this)}}]),e}(),yr=function(){function t(e,i){_classCallCheck(this,t),this.array=e,this.stride=i,this.count=void 0!==e?e.length/i:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0,this.isInterleavedBuffer=!0}return _createClass(t,[{key:"onUploadCallback",value:function(){}},{key:"setArray",value:function(t){if(Array.isArray(t))throw new TypeError("BufferAttribute: array should be a Typed Array.");return this.count=void 0!==t?t.length/this.stride:0,this.array=t,this}},{key:"setDynamic",value:function(t){return this.dynamic=t,this}},{key:"copy",value:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.dynamic=t.dynamic,this}},{key:"copyAt",value:function(t,e,i){t*=this.stride,i*=e.stride;for(var n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this}},{key:"set",value:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"onUpload",value:function(t){return this.onUploadCallback=t,this}},{key:"needsUpdate",set:function(t){!0===t&&this.version++}}]),t}(),mr=function(t){function e(t,i,n){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return r.meshPerAttribute=n||1,r.isInstancedInterleavedBuffer=!0,r}return _inherits(e,yr),_createClass(e,[{key:"copy",value:function(t){return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"copy",this).call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}]),e}(),gr=function(){function t(e,i,n,r){_classCallCheck(this,t),this.data=e,this.itemSize=i,this.offset=n,this.normalized=!0===r,this.isInterleavedBufferAttribute=!0}return _createClass(t,[{key:"setX",value:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}},{key:"setY",value:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}},{key:"setZ",value:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}},{key:"setW",value:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}},{key:"getX",value:function(t){return this.data.array[t*this.data.stride+this.offset]}},{key:"getY",value:function(t){return this.data.array[t*this.data.stride+this.offset+1]}},{key:"getZ",value:function(t){return this.data.array[t*this.data.stride+this.offset+2]}},{key:"getW",value:function(t){return this.data.array[t*this.data.stride+this.offset+3]}},{key:"setXY",value:function(t,e,i){return this.setX(t,e),this.setY(t,i),this}},{key:"setXYZ",value:function(t,e,i,n){return this.setX(t,e),this.setY(t,i),this.setZ(t,n),this}},{key:"setXYZW",value:function(t,e,i,n,r){return this.setX(t,e),this.setY(t,i),this.setZ(t,n),this.setW(t,r),this}},{key:"count",get:function(){return this.data.count}},{key:"array",get:function(){return this.data.array}}]),t}(),_r=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t.type="LineSegmentsGeometry";return t.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),t.addAttribute("position",new De([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),t.addAttribute("uv",new De([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2)),t.isLineSegmentsGeometry=!0,t}return _inherits(e,vr),_createClass(e,[{key:"applyMatrix",value:function(t){var e=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==e&&(t.applyToBufferAttribute(e),t.applyToBufferAttribute(i),e.data.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"setPositions",value:function(t){var e=kr(t);if(this.addAttribute("instanceStart",new gr(e,3,0)),this.addAttribute("instanceEnd",new gr(e,3,3)),void 0===this.getAttribute("instanceColorStart")&&void 0===this.getAttribute("instanceColorEnd")){var i=t.map(function(){return 1});xr.call(this,i)}return this.computeBoundingBox(),this.computeBoundingSphere(),this}},{key:"setColors",value:function(t){return xr.call(this,t)}},{key:"computeBoundingBox",value:function(){br.call(this)}},{key:"computeBoundingSphere",value:function(){wr.call(this)}}]),e}(),xr=function(t){var e=kr(t);return this.addAttribute("instanceColorStart",new gr(e,3,0)),this.addAttribute("instanceColorEnd",new gr(e,3,3)),this},br=function(){var t=new Xt;return function(){null===this.boundingBox&&(this.boundingBox=new Xt);var e=this.attributes.instanceStart,i=this.attributes.instanceEnd;void 0!==e&&void 0!==i&&(this.boundingBox.setFromBufferAttribute(e),t.setFromBufferAttribute(i),this.boundingBox.union(t))}}(),wr=function(){var t=new Rt;return function(){null===this.boundingSphere&&(this.boundingSphere=new te),null===this.boundingBox&&this.computeBoundingBox();var e=this.attributes.instanceStart,i=this.attributes.instanceEnd;if(void 0!==e&&void 0!==i){var n=this.boundingSphere.center;this.boundingBox.getCenter(n);for(var r=0,s=0,o=e.count;s<o;s++)t.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(t)),t.fromBufferAttribute(i,s),r=Math.max(r,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}();function kr(t){var e=void 0;return t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t)),new mr(e,6,1)}var Sr=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.type="LineGeometry",t.isLineGeometry=!0,t}return _inherits(e,_r),_createClass(e,[{key:"setPositions",value:function(t){var i=Cr(t);return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setPositions",this).call(this,i),this}},{key:"setColors",value:function(t){var i=Cr(t);return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setColors",this).call(this,i),this}},{key:"fromLine",value:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.position.array),this}}]),e}();function Cr(t){for(var e=t.length-3,i=new Float32Array(2*e),n=0;n<e;n+=3)i[2*n]=t[n],i[2*n+1]=t[n+1],i[2*n+2]=t[n+2],i[2*n+3]=t[n+3],i[2*n+4]=t[n+4],i[2*n+5]=t[n+5];return i}var Ar,Lr=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.type="LineMeshMaterial",i.color=new Nt(16777215),i.linewidth=1,i.dashed=!1,i.scale=1,i.dashSize=3,i.gapSize=1,i.resolution=new Pe,i.lights=!1,i.setValues(t),i}return _inherits(e,ar),_createClass(e,[{key:"copy",value:function(t){return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this.dashed=t.dashed,this.resolution.copy(t.resolution),this}},{key:"isLineMeshMaterial",get:function(){return!0}}]),e}(),Mr=function(t){function e(t,i){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return n.geometry=void 0!==t?t:new Sr,n.material=void 0!==i?i:new Lr({color:16777215*Math.random()}),n}return _inherits(e,hr),_createClass(e,[{key:"computeLineDistances",value:function(){Pr.call(this)}},{key:"isLine2",get:function(){return!0}}]),e}(),Pr=function(){var t=new Rt,e=new Rt;return function(){for(var i=this.geometry,n=i.attributes.instanceStart,r=i.attributes.instanceEnd,s=new Float32Array(2*n.data.count),o=0,a=0,l=n.data.count;o<l;o++,a+=2)t.fromBufferAttribute(n,o),e.fromBufferAttribute(r,o),s[a]=0===a?0:s[a-1],s[a+1]=s[a]+t.distanceTo(e);var h=new mr(s,2,1);return i.addAttribute("instanceDistanceStart",new gr(h,1,0)),i.addAttribute("instanceDistanceEnd",new gr(h,1,1)),this}}(),Er=(function(){var t=new Ht,e=new Vn,i=new te}(),function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.type="SpriteMaterial",i.color=new Nt(16777215),i.map=null,i.rotation=0,i.sizeAttenuation=!0,i.lights=!1,i.transparent=!0,i.setValues(t),i}return _inherits(e,ar),_createClass(e,[{key:"copy",value:function(t){return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}},{key:"isSpriteMaterial",get:function(){return!0}}]),e}()),Tr=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(i.type="Sprite",void 0===Ar){Ar=new Re;var n=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new yr(n,5);Ar.setIndex([0,1,2,0,2,3]),Ar.addAttribute("position",new gr(r,3,0,!1)),Ar.addAttribute("uv",new gr(r,2,3,!1))}return i.geometry=Ar,i.material=void 0!==t?t:new Er,i.center=new Pe(.5,.5),i}return _inherits(e,_n),_createClass(e,[{key:"raycast",value:function(t,e){Or.call(this,t,e)}},{key:"clone",value:function(){return new this.constructor(this.material).copy(this)}},{key:"copy",value:function(t){return _n.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}},{key:"isSprite",get:function(){return!0}}]),e}(),Or=function(){var t=new Rt,e=new Rt,i=new Rt,n=new Pe,r=new Pe,s=new Ht,o=new Rt,a=new Rt,l=new Rt,h=new Pe,u=new Pe,c=new Pe;function d(t,e,i,o,a,l){n.subVectors(t,i).addScalar(.5).multiply(o),void 0!==a?(r.x=l*n.x-a*n.y,r.y=a*n.x+l*n.y):r.copy(n),t.copy(e),t.x+=r.x,t.y+=r.y,t.applyMatrix4(s)}return function(n,r){e.setFromMatrixScale(this.matrixWorld),s.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),i.setFromMatrixPosition(this.modelViewMatrix);var f,p,v=this.material.rotation;0!==v&&(p=Math.cos(v),f=Math.sin(v));var y=this.center;d(o.set(-.5,-.5,0),i,y,e,f,p),d(a.set(.5,-.5,0),i,y,e,f,p),d(l.set(.5,.5,0),i,y,e,f,p),h.set(0,0),u.set(1,0),c.set(1,1);var m=n.ray.intersectTriangle(o,a,l,!1,t);if(null!==m||(d(a.set(-.5,.5,0),i,y,e,f,p),u.set(0,1),null!==(m=n.ray.intersectTriangle(o,l,a,!1,t)))){var g=n.ray.origin.distanceTo(t);g<n.near||g>n.far||r.push({distance:g,point:t.clone(),uv:ir.getUV(t,o,a,l,h,u,c,new Pe),face:null,object:this})}}},Dr=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.autoRedraw,n=void 0===i||i,r=t.text,s=void 0===r?"":r,o=t.textAlign,a=void 0===o?"center":o,l=t.textLineHeight,h=void 0===l?1.15:l,u=t.fontFamily,c=void 0===u?"sans-serif":u,d=t.fontSize,f=void 0===d?16:d,p=t.fontWeight,v=void 0===p?"normal":p,y=t.fontVariant,m=void 0===y?"normal":y,g=t.fontStyle,_=void 0===g?"normal":g,x=t.fillStyle,b=void 0===x?"white":x,w=t.lineWidth,k=void 0===w?0:w,S=t.strokeStyle,C=void 0===S?"black":S,A=t.padding,L=void 0===A?.25:A,M=t.magFilter,P=void 0===M?dt:M,E=t.minFilter,T=void 0===E?dt:E,O=t.mapping,D=t.wrapS,z=t.wrapT,I=t.format,R=t.type,N=t.anisotropy;_classCallCheck(this,e);var U=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Rr(),O,D,z,P,T,I,R,N));return U.autoRedraw=n,U._text=s,U._textAlign=a,U._textLineHeight=h,U._fontFamily=c,U._fontSize=f,U._fontWeight=v,U._fontVariant=m,U._fontStyle=_,U._fillStyle=b,U._lineWidth=k,U._strokeStyle=C,U._padding=L,U.redraw(),U}return _inherits(e,ri),_createClass(e,[{key:"redraw",value:function(){var t=this,e=this.image.getContext("2d");if(e.clearRect(0,0,e.canvas.width,e.canvas.height),this.textWidthInPixels&&this.textHeightInPixels){e.canvas.width=this.imageWidthInPixels,e.canvas.height=this.imageHeightInPixels,e.font=this.font,e.textBaseline="middle";var i=void 0;switch(this.textAlign){case"left":e.textAlign="left",i=this.paddingInPixels+this.lineWidthInPixels/2;break;case"right":e.textAlign="right",i=this.paddingInPixels+this.lineWidthInPixels/2+this.textWidthInPixels;break;case"center":e.textAlign="center",i=this.paddingInPixels+this.lineWidthInPixels/4+this.textWidthInPixels/2}var n=this.paddingInPixels+this.lineWidthInPixels/2+this.fontSize/2;e.fillStyle=this.fillStyle,e.miterLimit=1,e.lineWidth=this.lineWidthInPixels,e.strokeStyle=this.strokeStyle,this.textLines.forEach(function(r){t.lineWidth&&e.strokeText(r,i,n),e.fillText(r,i,n),n+=t.textLineHeightInPixels})}else e.canvas.width=e.canvas.height=1;this.needsUpdate=!0}},{key:"_redrawIfAuto",value:function(){this.autoRedraw&&this.redraw()}},{key:"isTextTexture",get:function(){return!0}},{key:"text",get:function(){return this._text},set:function(t){this._text!==t&&(this._text=t,this._textLines=void 0,this._textWidthInPixels=void 0,this._redrawIfAuto())}},{key:"textAlign",get:function(){return this._textAlign},set:function(t){this._textAlign!==t&&(this._textAlign=t,this._redrawIfAuto())}},{key:"textLines",get:function(){var t;return zr(this._textLines)&&(this._textLines=(t=this.text)?t.split("\n"):[]),this._textLines}},{key:"textLineHeight",get:function(){return this._textLineHeight},set:function(t){this._textLineHeight!==t&&(this._textLineHeight=t,this._redrawIfAuto())}},{key:"textLineHeightInPixels",get:function(){return this.fontSize*this.textLineHeight}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._textWidthInPixels=void 0,this._redrawIfAuto())}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._textWidthInPixels=void 0,this._redrawIfAuto())}},{key:"fontWeight",get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this._textWidthInPixels=void 0,this._redrawIfAuto())}},{key:"fontVariant",get:function(){return this._fontVariant},set:function(t){this._fontVariant!==t&&(this._fontVariant=t,this._textWidthInPixels=void 0,this._redrawIfAuto())}},{key:"fontStyle",get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this._textWidthInPixels=void 0,this._redrawIfAuto())}},{key:"font",get:function(){return t=this.fontStyle,e=this.fontVariant,i=this.fontWeight,n=this.fontSize,r=this.fontFamily,[t,e,i,n+"px",r].join(" ");var t,e,i,n,r}},{key:"fillStyle",get:function(){return this._fillStyle},set:function(t){this._fillStyle!==t&&(this._fillStyle=t,this._redrawIfAuto())}},{key:"lineWidth",get:function(){return this._lineWidth},set:function(t){this._lineWidth!==t&&(this._lineWidth=t,this._redrawIfAuto())}},{key:"lineWidthInPixels",get:function(){return this._lineWidth*this.fontSize}},{key:"strokeStyle",get:function(){return this._strokeStyle},set:function(t){this._strokeStyle!==t&&(this._strokeStyle=t,this._redrawIfAuto())}},{key:"textWidthInPixels",get:function(){return zr(this._textWidthInPixels)&&(this._textWidthInPixels=Ir(this.textLines,this.font)),this._textWidthInPixels}},{key:"textHeight",get:function(){return this.textLineHeight*(this.textLines.length-1)+1}},{key:"textHeightInPixels",get:function(){return this.textHeight*this.fontSize}},{key:"padding",get:function(){return this._padding},set:function(t){this._padding!==t&&(this._padding=t,this._redrawIfAuto())}},{key:"paddingInPixels",get:function(){return this.padding*this.fontSize}},{key:"imageWidthInPixels",get:function(){return this.textWidthInPixels+this.lineWidthInPixels+2*this.paddingInPixels}},{key:"imageHeight",get:function(){return this.textHeight+this.lineWidth+2*this.padding}},{key:"imageHeightInPixels",get:function(){return this.imageHeight*this.fontSize}},{key:"imageAspect",get:function(){return this.image.width&&this.image.height?this.image.width/this.image.height:1}}],[{key:"getTextWidth",value:function(t,e){return Ir(t,e)}}]),e}();function zr(t){return void 0===t}function Ir(t,e){if(t.length){var i=Rr().getContext("2d");return i.font=e,function(t){if(t.length>0)return t.reduce(function(t,e){return Math.max(t,e)})}(t.map(function(t){return i.measureText(t).width}))}return 0}function Rr(){return document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}var Nr=0,Ur=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return Object.defineProperty(t,"id",{value:Nr+=2}),t.type="Geometry",t.vertices=[],t.colors=[],t.faces=[],t.faceVertexUvs=[[]],t.isGeometry=!0,t.lineDistances=[],t.boundingSphere=null,t.boundingBox=null,t.elementsNeedUpdate=!1,t.verticesNeedUpdate=!1,t.uvsNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.lineDistancesNeedUpdate=!1,t.groupsNeedUpdate=!1,t}return _inherits(e,N),_createClass(e,[{key:"fromBufferGeometry",value:function(t){var e=this,i=null!==t.index?t.index.array:void 0,n=t.attributes,r=n.position.array,s=void 0!==n.normal?n.normal.array:void 0,o=void 0!==n.color?n.color.array:void 0,a=void 0!==n.uv?n.uv.array:void 0,l=void 0!==n.uv2?n.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var h=[],u=[],c=[],d=0,f=0;d<r.length;d+=3,f+=2)e.vertices.push(new Rt(r[d],r[d+1],r[d+2])),void 0!==s&&h.push(new Rt(s[d],s[d+1],s[d+2])),void 0!==o&&e.colors.push(new Color(o[d],o[d+1],o[d+2])),void 0!==a&&u.push(new Pe(a[f],a[f+1])),void 0!==l&&c.push(new Pe(l[f],l[f+1]));function p(t,i,n,r){var d=void 0!==s?[h[t].clone(),h[i].clone(),h[n].clone()]:[],f=void 0!==o?[e.colors[t].clone(),e.colors[i].clone(),e.colors[n].clone()]:[],p=new sr(t,i,n,d,f,r);e.faces.push(p),void 0!==a&&e.faceVertexUvs[0].push([u[t].clone(),u[i].clone(),u[n].clone()]),void 0!==l&&e.faceVertexUvs[1].push([c[t].clone(),c[i].clone(),c[n].clone()])}var v=t.groups;if(v.length>0)for(d=0;d<v.length;d++)for(var y=v[d],m=y.start,g=(f=m,m+y.count);f<g;f+=3)void 0!==i?p(i[f],i[f+1],i[f+2],y.materialIndex):p(f,f+1,f+2,y.materialIndex);else if(void 0!==i)for(d=0;d<i.length;d+=3)p(i[d],i[d+1],i[d+2]);else for(d=0;d<r.length/3;d+=3)p(d,d+1,d+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new Xt),this.boundingBox.setFromPoints(this.vertices)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new te),this.boundingSphere.setFromPoints(this.vertices)}},{key:"computeFaceNormals",value:function(){for(var t=new Rt,e=new Rt,i=0,n=this.faces.length;i<n;i++){var r=this.faces[i],s=this.vertices[r.a],o=this.vertices[r.b],a=this.vertices[r.c];t.subVectors(a,o),e.subVectors(s,o),t.cross(e),t.normalize(),r.normal.copy(t)}}},{key:"mergeVertices",value:function(){var t,e,i,n,r,s,o,a,l={},h=[],u=[],c=Math.pow(10,4);for(i=0,n=this.vertices.length;i<n;i++)t=this.vertices[i],void 0===l[e=Math.round(t.x*c)+"_"+Math.round(t.y*c)+"_"+Math.round(t.z*c)]?(l[e]=i,h.push(this.vertices[i]),u[i]=h.length-1):u[i]=u[l[e]];var d=[];for(i=0,n=this.faces.length;i<n;i++){(r=this.faces[i]).a=u[r.a],r.b=u[r.b],r.c=u[r.c],s=[r.a,r.b,r.c];for(var f=0;f<3;f++)if(s[f]===s[(f+1)%3]){d.push(i);break}}for(i=d.length-1;i>=0;i--){var p=d[i];for(this.faces.splice(p,1),o=0,a=this.faceVertexUvs.length;o<a;o++)this.faceVertexUvs[o].splice(p,1)}var v=this.vertices.length-h.length;return this.vertices=h,v}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(t){var e=void 0,i=void 0,n=void 0,r=void 0,s=void 0,o=void 0;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var a=t.vertices;for(e=0,i=a.length;e<i;e++)this.vertices.push(a[e].clone());var l=t.colors;for(e=0,i=l.length;e<i;e++)this.colors.push(l[e].clone());var h=t.faces;for(e=0,i=h.length;e<i;e++)this.faces.push(h[e].clone());for(e=0,i=t.faceVertexUvs.length;e<i;e++){var u=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),n=0,r=u.length;n<r;n++){var c=u[n],d=[];for(s=0,o=c.length;s<o;s++){var f=c[s];d.push(f.clone())}this.faceVertexUvs[e].push(d)}}var p=t.boundingBox;null!==p&&(this.boundingBox=p.clone());var v=t.boundingSphere;return null!==v&&(this.boundingSphere=v.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}},{key:"dispose",value:function(){this.fire({type:"dispose"})}}]),e}(),Fr=function(t){function e(t,i,n,r){_classCallCheck(this,e);var s=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));s.type="CircleBufferGeometry",s.parameters={radius:t,segments:i,thetaStart:n,thetaLength:r},t=t||50,i=void 0!==i?Math.max(3,i):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var o,a,l=[],h=[],u=[],c=[],d=new Rt,f=new Pe;for(h.push(0,0,0),u.push(0,0,1),c.push(.5,.5),a=0,o=3;a<=i;a++,o+=3){var p=n+a/i*r;d.x=t*Math.cos(p),d.y=t*Math.sin(p),h.push(d.x,d.y,d.z),u.push(0,0,1),f.x=(h[o]/t+1)/2,f.y=(h[o+1]/t+1)/2,c.push(f.x,f.y)}for(o=1;o<=i;o++)l.push(o,o+1,0);return s.setIndex(l),s.addAttribute("position",new De(h,3)),s.addAttribute("normal",new De(u,3)),s.addAttribute("uv",new De(c,2)),s}return _inherits(e,Re),e}(),Br=function(t){function e(t,i,n,r,s,o){_classCallCheck(this,e);var a=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a.type="BoxGeometry",a.parameters={width:t,height:i,depth:n,widthSegments:r,heightSegments:s,depthSegments:o},a.fromBufferGeometry(new Vr(t,i,n,r,s,o)),a.mergeVertices(),a}return _inherits(e,Ur),e}(),Vr=function(t){function e(t,i,n,r,s,o){_classCallCheck(this,e);var a=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));a.type="BoxBufferGeometry",a.parameters={width:t,height:i,depth:n,widthSegments:r,heightSegments:s,depthSegments:o};var l=a;r=Math.floor(r)||1,s=Math.floor(s)||1,o=Math.floor(o)||1;var h=[],u=[],c=[],d=[],f=0,p=0;function v(t,e,i,n,r,s,o,a,v,y,m){var g,_,x=s/v,b=o/y,w=s/2,k=o/2,S=a/2,C=v+1,A=y+1,L=0,M=0,P=new Rt;for(_=0;_<A;_++){var E=_*b-k;for(g=0;g<C;g++){var T=g*x-w;P[t]=T*n,P[e]=E*r,P[i]=S,u.push(P.x,P.y,P.z),P[t]=0,P[e]=0,P[i]=a>0?1:-1,c.push(P.x,P.y,P.z),d.push(g/v),d.push(1-_/y),L+=1}}for(_=0;_<y;_++)for(g=0;g<v;g++){var O=f+g+C*_,D=f+g+C*(_+1),z=f+(g+1)+C*(_+1),I=f+(g+1)+C*_;h.push(O,D,I),h.push(D,z,I),M+=6}l.addGroup(p,M,m),p+=M,f+=L}return v("z","y","x",-1,-1,n,i,t,o,s,0),v("z","y","x",1,-1,n,i,-t,o,s,1),v("x","z","y",1,1,t,n,i,r,o,2),v("x","z","y",1,-1,t,n,-i,r,o,3),v("x","y","z",1,-1,t,i,n,r,s,4),v("x","y","z",-1,-1,t,i,-n,r,s,5),a.setIndex(h),a.addAttribute("position",new De(u,3)),a.addAttribute("normal",new De(c,3)),a.addAttribute("uv",new De(d,2)),a}return _inherits(e,Re),e}(),Gr=function(t){function e(t,i,n,r,s,o,a){_classCallCheck(this,e);var l=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));l.type="SphereBufferGeometry",l.parameters={radius:t,widthSegments:i,heightSegments:n,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=t||50,i=Math.max(3,Math.floor(i)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,s=void 0!==s?s:2*Math.PI;var h,u,c=(o=void 0!==o?o:0)+(a=void 0!==a?a:Math.PI),d=0,f=[],p=new Rt,v=new Rt,y=[],m=[],g=[],_=[];for(u=0;u<=n;u++){var x=[],b=u/n;for(h=0;h<=i;h++){var w=h/i;p.x=-t*Math.cos(r+w*s)*Math.sin(o+b*a),p.y=t*Math.cos(o+b*a),p.z=t*Math.sin(r+w*s)*Math.sin(o+b*a),m.push(p.x,p.y,p.z),v.set(p.x,p.y,p.z).normalize(),g.push(v.x,v.y,v.z),_.push(w,1-b),x.push(d++)}f.push(x)}for(u=0;u<n;u++)for(h=0;h<i;h++){var k=f[u][h+1],S=f[u][h],C=f[u+1][h],A=f[u+1][h+1];(0!==u||o>0)&&y.push(k,S,A),(u!==n-1||c<Math.PI)&&y.push(S,C,A)}return l.setIndex(y),l.addAttribute("position",new De(m,3)),l.addAttribute("normal",new De(g,3)),l.addAttribute("uv",new De(_,2)),l}return _inherits(e,Re),e}(),Wr=function(t){function e(t,i,n,r,s,o,a,l){_classCallCheck(this,e);var h=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return h.type="CylinderGeometry",h.parameters={radiusTop:t,radiusBottom:i,height:n,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l},h.fromBufferGeometry(new jr(t,i,n,r,s,o,a,l)),h.mergeVertices(),h}return _inherits(e,Ur),e}(),jr=function(t){function e(t,i,n,r,s,o,a,l){_classCallCheck(this,e);var h=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));h.type="CylinderBufferGeometry",h.parameters={radiusTop:t,radiusBottom:i,height:n,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};var u=h;t=void 0!==t?t:20,i=void 0!==i?i:20,n=void 0!==n?n:100,r=Math.floor(r)||8,s=Math.floor(s)||1,o=void 0!==o&&o,a=void 0!==a?a:0,l=void 0!==l?l:2*Math.PI;var c=[],d=[],f=[],p=[],v=0,y=[],m=n/2,g=0;function _(e){var n,s,o,h=new Pe,y=new Rt,_=0,x=!0===e?t:i,b=!0===e?1:-1;for(s=v,n=1;n<=r;n++)d.push(0,m*b,0),f.push(0,b,0),p.push(.5,.5),v++;for(o=v,n=0;n<=r;n++){var w=n/r*l+a,k=Math.cos(w),S=Math.sin(w);y.x=x*S,y.y=m*b,y.z=x*k,d.push(y.x,y.y,y.z),f.push(0,b,0),h.x=.5*k+.5,h.y=.5*S*b+.5,p.push(h.x,h.y),v++}for(n=0;n<r;n++){var C=s+n,A=o+n;!0===e?c.push(A,A+1,C):c.push(A+1,A,C),_+=3}u.addGroup(g,_,!0===e?1:2),g+=_}return function(){var e,o,h=new Rt,_=new Rt,x=0,b=(i-t)/n;for(o=0;o<=s;o++){var w=[],k=o/s,S=k*(i-t)+t;for(e=0;e<=r;e++){var C=e/r,A=C*l+a,L=Math.sin(A),M=Math.cos(A);_.x=S*L,_.y=-k*n+m,_.z=S*M,d.push(_.x,_.y,_.z),h.set(L,b,M).normalize(),f.push(h.x,h.y,h.z),p.push(C,1-k),w.push(v++)}y.push(w)}for(e=0;e<r;e++)for(o=0;o<s;o++){var P=y[o][e],E=y[o+1][e],T=y[o+1][e+1],O=y[o][e+1];c.push(P,E,O),c.push(E,T,O),x+=6}u.addGroup(g,x,0),g+=x}(),!1===o&&(t>0&&_(!0),i>0&&_(!1)),h.setIndex(c),h.addAttribute("position",new De(d,3)),h.addAttribute("normal",new De(f,3)),h.addAttribute("uv",new De(p,2)),h}return _inherits(e,Re),e}(),Hr=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.type="MeshLambertMaterial",i.color=new Nt(16777215),i.map=null,i.emissive=new Nt(0),i.emissiveIntensity=1,i.wireframe=!1,i.wireframeLinewidth=1,i.setValues(t),i}return _inherits(e,ar),_createClass(e,[{key:"copy",value:function(t){return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.map=t.map,this.emissive.copy(t.emissive),this.emissiveIntensity=t.emissiveIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}},{key:"isMeshLambertMaterial",get:function(){return!0}}]),e}(),qr=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.type="MeshPhongMaterial",i.color=new Nt(16777215),i.specular=new Nt(1118481),i.shininess=30,i.map=null,i.emissive=new Nt(0),i.emissiveIntensity=1,i.wireframe=!1,i.wireframeLinewidth=1,i.setValues(t),i}return _inherits(e,ar),_createClass(e,[{key:"copy",value:function(t){return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.emissive.copy(t.emissive),this.emissiveIntensity=t.emissiveIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}},{key:"isMeshPhongMaterial",get:function(){return!0}}]),e}(),Xr=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.type="LineDashedMaterial",i.scale=1,i.dashSize=3,i.gapSize=1,i.setValues(t),i}return _inherits(e,cr),_createClass(e,[{key:"copy",value:function(t){return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"copy",this).call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}},{key:"isLineDashedMaterial",get:function(){return!0}}]),e}(),Yr=function(t){function e(t,i){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.type="Light",n.color=new Nt(t),n.intensity=void 0!==i?i:1,n}return _inherits(e,_n),_createClass(e,[{key:"isLight",get:function(){return!0}}]),e}(),Zr=function(t){function e(t,i){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return n.type="DirectionalLight",n.position.copy(_n.DefaultUp),n.updateMatrix(),n.target=new _n,n}return _inherits(e,Yr),_createClass(e,[{key:"isDirectionalLight",get:function(){return!0}}]),e}(),Qr=function(t){function e(t,i){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return n.type="AmbientLight",n}return _inherits(e,Yr),_createClass(e,[{key:"isAmbientLight",get:function(){return!0}}]),e}(),Kr=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.matrixWorldInverse=new Ht,t.projectionMatrix=new Ht,t.isCamera=!0,t}return _inherits(e,_n),_createClass(e,[{key:"updateMatrixWorld",value:function(t){_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateMatrixWorld",this).call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)}},{key:"getWorldDirection",value:function(t){return Jr.call(this,t)}}]),e}(),Jr=function(){var t=new pn;return function(e){return void 0===e&&(console.warn("Camera: .getWorldDirection() target is now required"),e=new Rt),this.getWorldQuaternion(t),e.set(0,0,-1).applyQuaternion(t)}}(),$r=function(t){function e(t,i,n,r){_classCallCheck(this,e);var s=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return s.type="PerspectiveCamera",s.fov=void 0!==t?t:50,s.zoom=1,s.near=void 0!==n?n:.1,s.far=void 0!==r?r:2e3,s.focus=10,s.aspect=void 0!==i?i:1,s.view=null,s.updateProjectionMatrix(),s.isPerspectiveCamera=!0,s}return _inherits(e,Kr),_createClass(e,[{key:"updateProjectionMatrix",value:function(){var t=this.near,e=t*Math.tan(.5*It.DEG2RAD*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n;this.view;this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far)}}]),e}(),ts=function(t){function e(t,i,n,r,s,o){_classCallCheck(this,e);var a=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a.type="OrthographicCamera",a.zoom=1,a.view=null,a.left=t,a.right=i,a.top=n,a.bottom=r,a.near=void 0!==s?s:.1,a.far=void 0!==o?o:2e3,a.isOrthographicCamera=!0,a.updateProjectionMatrix(),a}return _inherits(e,Kr),_createClass(e,[{key:"updateProjectionMatrix",value:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-t,s=i+t,o=n+e,a=n-e;this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far)}}]),e}(),es=function(){function t(e,i,n,r){_classCallCheck(this,t),this.ray=new Vn(e,i),this.near=n||0,this.far=r||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},this.linePrecision=1}return _createClass(t,[{key:"set",value:function(t,e){this.ray.set(t,e)}},{key:"setFromCamera",value:function(t,e){var i=new Ht;i.multiplyMatrices(e.matrixWorld,i.getInverse(e.projectionMatrix)),e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).applyMatrix4(i).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).applyMatrix4(i),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):console.error("Raycaster: Unsupported camera type.")}},{key:"intersectObject",value:function(t,e,i){var n=i||[];return ns(t,this,n,e),n.sort(is),n}},{key:"intersectObjects",value:function(t,e,i){var n=i||[];if(!1===Array.isArray(t))return console.warn("Raycaster.intersectObjects: objects is not an Array."),n;for(var r=0,s=t.length;r<s;r++)ns(t[r],this,n,e);return n.sort(is),n}}]),t}();function is(t,e){return t.distance-e.distance}function ns(t,e,i,n){if(!1!==t.visible&&(t.raycast(e,i),!0===n))for(var r=t.children,s=0,o=r.length;s<o;s++)ns(r[s],e,i,!0)}var rs=function(){function t(e,i,n){return _classCallCheck(this,t),this.radius=void 0!==e?e:1,this.phi=void 0!==i?i:0,this.theta=void 0!==n?n:0,this}return _createClass(t,[{key:"set",value:function(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}},{key:"makeSafe",value:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}},{key:"setFromVector3",value:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(It.clamp(t.y/this.radius,-1,1))),this}}]),t}(),ss=function(){function t(){_classCallCheck(this,t),this.type="Curve",this.arcLengthDivisions=200}return _createClass(t,[{key:"getPoint",value:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}},{key:"getPointAt",value:function(t,e){var i=this.getUtoTmapping(t);return this.getPoint(i,e)}},{key:"getPoints",value:function(t){void 0===t&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}},{key:"getSpacedPoints",value:function(t){void 0===t&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}},{key:"getLength",value:function(){var t=this.getLengths();return t[t.length-1]}},{key:"getLengths",value:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,i,n=[],r=this.getPoint(0),s=0;for(n.push(0),i=1;i<=t;i++)s+=(e=this.getPoint(i/t)).distanceTo(r),n.push(s),r=e;return this.cacheArcLengths=n,n}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.getLengths()}},{key:"getUtoTmapping",value:function(t,e){var i,n=this.getLengths(),r=0,s=n.length;i=e||t*n[s-1];for(var o,a=0,l=s-1;a<=l;)if((o=n[r=Math.floor(a+(l-a)/2)]-i)<0)a=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(n[r=l]===i)return r/(s-1);var h=n[r];return(r+(i-h)/(n[r+1]-h))/(s-1)}},{key:"getTangent",value:function(t){var e=t-1e-4,i=t+1e-4;e<0&&(e=0),i>1&&(i=1);var n=this.getPoint(e);return this.getPoint(i).clone().sub(n).normalize()}},{key:"getTangentAt",value:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)}},{key:"computeFrenetFrames",value:function(t,e){var i,n,r,s=new Rt,o=[],a=[],l=[],h=new Rt,u=new Ht;for(i=0;i<=t;i++)n=i/t,o[i]=this.getTangentAt(n),o[i].normalize();a[0]=new Rt,l[0]=new Rt;var c=Number.MAX_VALUE,d=Math.abs(o[0].x),f=Math.abs(o[0].y),p=Math.abs(o[0].z);for(d<=c&&(c=d,s.set(1,0,0)),f<=c&&(c=f,s.set(0,1,0)),p<=c&&s.set(0,0,1),h.crossVectors(o[0],s).normalize(),a[0].crossVectors(o[0],h),l[0].crossVectors(o[0],a[0]),i=1;i<=t;i++)a[i]=a[i-1].clone(),l[i]=l[i-1].clone(),h.crossVectors(o[i-1],o[i]),h.length()>Number.EPSILON&&(h.normalize(),r=Math.acos(It.clamp(o[i-1].dot(o[i]),-1,1)),a[i].applyMatrix4(u.makeRotationAxis(h,r))),l[i].crossVectors(o[i],a[i]);if(!0===e)for(r=Math.acos(It.clamp(a[0].dot(a[t]),-1,1)),r/=t,o[0].dot(h.crossVectors(a[0],a[t]))>0&&(r=-r),i=1;i<=t;i++)a[i].applyMatrix4(u.makeRotationAxis(o[i],r*i)),l[i].crossVectors(o[i],a[i]);return{tangents:o,normals:a,binormals:l}}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}},{key:"toJSON",value:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}},{key:"fromJSON",value:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}]),t}();function os(){var t=0,e=0,i=0,n=0;function r(r,s,o,a){t=r,e=o,i=-3*r+3*s-2*o-a,n=2*r-2*s+o+a}return{initCatmullRom:function(t,e,i,n,s){r(e,i,s*(i-t),s*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,s,o,a){var l=(e-t)/s-(i-t)/(s+o)+(i-e)/o,h=(i-e)/o-(n-e)/(o+a)+(n-i)/a;r(e,i,l*=o,h*=o)},calc:function(r){var s=r*r;return t+e*r+i*s+n*(s*r)}}}var as=new Rt,ls=new os,hs=new os,us=new os,cs=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;_classCallCheck(this,e);var s=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return s.type="CatmullRomCurve3",s.points=t,s.closed=i,s.curveType=n,s.tension=r,s}return _inherits(e,ss),_createClass(e,[{key:"getPoint",value:function(){var t,e,i,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rt,o=this.points,a=o.length,l=(a-(this.closed?0:1))*r,h=Math.floor(l),u=l-h;if(this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/a)+1)*a:0===u&&h===a-1&&(h=a-2,u=1),this.closed||h>0?t=o[(h-1)%a]:(as.subVectors(o[0],o[1]).add(o[0]),t=as),e=o[h%a],i=o[(h+1)%a],this.closed||h+2<a?n=o[(h+2)%a]:(as.subVectors(o[a-1],o[a-2]).add(o[a-1]),n=as),"centripetal"===this.curveType||"chordal"===this.curveType){var c="chordal"===this.curveType?.5:.25,d=Math.pow(t.distanceToSquared(e),c),f=Math.pow(e.distanceToSquared(i),c),p=Math.pow(i.distanceToSquared(n),c);f<1e-4&&(f=1),d<1e-4&&(d=f),p<1e-4&&(p=f),ls.initNonuniformCatmullRom(t.x,e.x,i.x,n.x,d,f,p),hs.initNonuniformCatmullRom(t.y,e.y,i.y,n.y,d,f,p),us.initNonuniformCatmullRom(t.z,e.z,i.z,n.z,d,f,p)}else"catmullrom"===this.curveType&&(ls.initCatmullRom(t.x,e.x,i.x,n.x,this.tension),hs.initCatmullRom(t.y,e.y,i.y,n.y,this.tension),us.initCatmullRom(t.z,e.z,i.z,n.z,this.tension));return s.set(ls.calc(u),hs.calc(u),us.calc(u)),s}},{key:"copy",value:function(t){_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"copy",this).call(this,t),this.points=[];for(var i=0,n=t.points.length;i<n;i++){var r=t.points[i];this.points.push(r.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}},{key:"toJSON",value:function(){var t=_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"toJSON",this).call(this);t.points=[];for(var i=0,n=this.points.length;i<n;i++){var r=this.points[i];t.points.push(r.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}},{key:"fromJSON",value:function(t){_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"fromJSON",this).call(this,t),this.points=[];for(var i=0,n=t.points.length;i<n;i++){var r=t.points[i];this.points.push((new Rt).fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}},{key:"isCatmullRomCurve3",get:function(){return!0}}]),e}(),ds={},fs={},ps=Array.prototype,vs=Object.prototype,ys=Function.prototype,ms=ps.push,gs=ps.slice,_s=ps.concat,xs=vs.toString,bs=vs.hasOwnProperty,ws=ps.forEach,ks=ps.map,Ss=ps.filter,Cs=ps.every,As=ps.some,Ls=ps.indexOf,Ms=Array.isArray,Ps=Object.keys,Es=(ys.bind,Math.pow(2,53)-1),Ts=function(t){return function(e){return null==e?void 0:e[t]}}("length"),Os=function(t){var e=Ts(t);return"number"==typeof e&&e>=0&&e<=Es};ds.values=function(t){for(var e=ds.keys(t),i=e.length,n=new Array(i),r=0;r<i;r++)n[r]=t[e[r]];return n},ds.keys=Ps||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)ds.has(t,i)&&e.push(i);return e},ds.has=function(t,e){return bs.call(t,e)};var Ds=ds.each=ds.forEach=function(t,e,i){if(null!=t)if(ws&&t.forEach===ws)t.forEach(e,i);else if(t.length===+t.length){for(var n=0,r=t.length;n<r;n++)if(e.call(i,t[n],n,t)===fs)return}else{var s=ds.keys(t);for(n=0,r=s.length;n<r;n++)if(e.call(i,t[s[n]],s[n],t)===fs)return}};ds.compact=function(t){return ds.filter(t,ds.identity)},ds.filter=ds.select=function(t,e,i){var n=[];return null==t?n:Ss&&t.filter===Ss?t.filter(e,i):(Ds(t,function(t,r,s){e.call(i,t,r,s)&&n.push(t)}),n)},Ds(["Arguments","Function","String","Number","Date","RegExp"],function(t){ds["is"+t]=function(e){return xs.call(e)=="[object "+t+"]"}}),ds.isArguments=function(t){return!(!t||!ds.has(t,"callee"))},ds.isFunction=function(t){return"function"==typeof t},ds.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},ds.isNaN=function(t){return ds.isNumber(t)&&t!=+t},ds.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==xs.call(t)},ds.isNull=function(t){return null===t},ds.isEmpty=function(t){if(null==t)return!0;if(ds.isArray(t)||ds.isString(t))return 0===t.length;for(var e in t)if(ds.has(t,e))return!1;return!0},ds.isElement=function(t){return!(!t||1!==t.nodeType)},ds.isArray=Ms||function(t){return"[object Array]"==xs.call(t)},ds.isObject=function(t){return t===Object(t)},ds.identity=function(t){return t},ds.indexOf=function(t,e,i){if(null==t)return-1;var n=0,r=t.length;if(i){if("number"!=typeof i)return t[n=ds.sortedIndex(t,e)]===e?n:-1;n=i<0?Math.max(0,r+i):i}if(Ls&&t.indexOf===Ls)return t.indexOf(e,i);for(;n<r;n++)if(t[n]===e)return n;return-1},ds.isWindow=function(t){return null!=t&&t==t.window};ds.flatten=function(t,e){return function t(e,i,n){return i&&ds.every(e,ds.isArray)?_s.apply(n,e):(Ds(e,function(e){ds.isArray(e)||ds.isArguments(e)?i?ms.apply(n,e):t(e,i,n):n.push(e)}),n)}(t,e,[])},ds.every=ds.all=function(t,e,i){e||(e=ds.identity);var n=!0;return null==t?n:Cs&&t.every===Cs?t.every(e,i):(Ds(t,function(t,r,s){if(!(n=n&&e.call(i,t,r,s)))return fs}),!!n)},ds.min=function(t,e,i){if(!e&&ds.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&ds.isEmpty(t))return 1/0;var n={computed:1/0,value:1/0};return Ds(t,function(t,r,s){var o=e?e.call(i,t,r,s):t;o<n.computed&&(n={value:t,computed:o})}),n.value},ds.max=function(t,e,i){if(!e&&ds.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&ds.isEmpty(t))return-1/0;var n={computed:-1/0,value:-1/0};return Ds(t,function(t,r,s){var o=e?e.call(i,t,r,s):t;o>n.computed&&(n={value:t,computed:o})}),n.value},ds.find=ds.detect=function(t,e,i){var n;return zs(t,function(t,r,s){if(e.call(i,t,r,s))return n=t,!0}),n};var zs=ds.some=ds.any=function(t,e,i){e||(e=ds.identity);var n=!1;return null==t?n:As&&t.some===As?t.some(e,i):(Ds(t,function(t,r,s){if(n||(n=e.call(i,t,r,s)))return fs}),!!n)};function Is(t){return parseFloat(t.toPrecision(14))}ds.without=function(t){return ds.difference(t,gs.call(arguments,1))},ds.difference=function(t){var e=_s.apply(ps,gs.call(arguments,1));return ds.filter(t,function(t){return!ds.contains(e,t)})},ds.uniq=ds.unique=function(t,e,i,n){ds.isFunction(e)&&(n=i,i=e,e=!1);var r=i?ds.map(t,i,n):t,s=[],o=[];return Ds(r,function(i,n){(e?n&&o[o.length-1]===i:ds.contains(o,i))||(o.push(i),s.push(t[n]))}),s},ds.map=ds.collect=function(t,e,i){var n=[];return null==t?n:ks&&t.map===ks?t.map(e,i):(Ds(t,function(t,r,s){n.push(e.call(i,t,r,s))}),n)},ds.contains=ds.include=function(t,e){return null!=t&&(Ls&&t.indexOf===Ls?-1!=t.indexOf(e):zs(t,function(t){return t===e}))},ds.pluck=function(t,e){return ds.map(t,function(t){return t[e]})},ds.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},ds.shuffle=function(t){return ds.sample(t,1/0)},ds.sample=function(t,e,i){if(null==e||i)return Os(t)||(t=ds.values(t)),t[ds.random(t.length-1)];var n=Os(t)?ds.clone(t):ds.values(t),r=Ts(n);e=Math.max(Math.min(e,r),0);for(var s=r-1,o=0;o<e;o++){var a=ds.random(o,s),l=n[o];n[o]=n[a],n[a]=l}return n.slice(0,e)},ds.extend=function(){var t,e,i,n,r=arguments[0]||{},s=1,o=arguments.length,a=!1;for("boolean"==typeof r&&(a=r,r=arguments[1]||{},s=2),"object"===(void 0===r?"undefined":_typeof2(r))||ds.isFunction(r)||(r={}),o===s&&(r=this,--s);s<o;s++)if(null!=(t=arguments[s]))for(e in t)i=r[e],r!==(n=t[e])&&(a&&n&&ds.isObject(n)&&n.constructor===Object?r[e]=ds.extend(a,i,n):r[e]=n);return r},ds.clone=function(t){return ds.isObject(t)?ds.isArray(t)?t.slice():ds.extend(!0,{},t):t};var Rs=function(t,e,i){return ds.uniq(function(t,e,i){t=ds.without(t,void 0,null,"");var n=i&&i.scale?parseFloat(i.scale):1,r=i&&i.isInt?1:0;isNaN(n)&&(n=1);var s=ds.max(t),o=s;s*=n;var a=ds.min(t);if(a==s)return s>0?[a=0,s]:s<0?[s,0]:[0,s=1];var l=s-a;if(l){var h=a;(a-=.05*l)<0&&h>=0&&(a=0),s+=.05*l}var u=.3*(s-a);u=function(t,e){var i,n=[1,2,5,10];i=t/e;for(var r=0;r<n.length&&(t=n[r],!(i<=(n[r]+(n[r+1]||n[r]))/2));r++);return t*=e}(u,Math.pow(10,Math.floor(Math.log(u)/Math.LN10))),r&&(u=Math.ceil(u));var c,d,f=Is(Math.floor(a/u)*u),p=Is(Math.ceil(s/u)*u),v=[];for(c=f;c<=p&&(v.push(c),(c=Is(c+u))!==d);)d=c;return v.length>=3&&v[v.length-2]>=o&&v.pop(),v}(t,0,i))};function Ns(t,e){t=JSON.parse(JSON.stringify(t));var i={length:0,org:[],data:[],getRowDataAt:d,getRowDataOf:function(t){!t&&(t={});var e=[],n=0;for(var r in t)n++;if(n)for(var s=i.range.start;s<i.range.end;s++){var o=0;ds.each(i.data,function(e){e.field in t&&e.data[s]==t[e.field]&&o++}),o==n&&e.push(d(s))}return e},getFieldData:function(t){var e;return ds.each(i.data,function(i){i.field==t&&(e=i)}),e?e.data.slice(i.range.start,i.range.end+1):[]},getDataOrg:function t(e,n,r,o){o||(o=0);var a=r||s;if(!a)return;n||(n=function(t){return t});function l(t){for(var e=0,i=t.length;e<i;e++)t[e]=n(t[e]);return t}ds.isArray(e)||(e=[e]);var h=[];for(var u=0,c=e.length;u<c;u++)if(ds.isArray(e[u]))h.push(t(e[u],n,r,o+1));else{var d=h;o||(d=[]);for(var f=0,p=a.length;f<p;f++)if(e[u]==a[f].field){d.push(l(a[f].data.slice(i.range.start,i.range.end+1)));break}o||h.push(d)}return h},fields:[],range:{start:0,end:0}};if(!t||0==t.length)return i;if(t.length>0&&!ds.isArray(t[0])?(t=function(t){if(null==t&&(t=[]),t.length>0&&!ds.isArray(t[0])){for(var e=[],i=[],n=0,r=0,s=t.length;r<s;r++){var o=t[r];if(0==r){for(var a in o)i.push(a);e.push(i),n=i.length}for(var l=[],h=0;h<n;h++)l.push(o[i[h]]);e.push(l)}return e}return t}(t),i.length=t.length):i.length=t.length-1,i.range.end=i.length-1,e&&e.dataZoom&&e.dataZoom.range&&ds.extend(i.range,e.dataZoom.range),t.length&&t[0].length&&!~t[0].indexOf("__index__"))for(var n=0,r=t.length;n<r;n++)n?t[n].push(n-1):t[0].push("__index__");i.org=t,i.fields=t[0]?t[0]:[];for(var s=[],o=0,a=i.fields.length;o<a;o++){var l={};l.field=i.fields[o],l.index=o,l.data=[],s.push(l)}i.data=s;for(o=1,a=t.length;o<a;o++)for(var h=0,u=t[o].length;h<u;h++){var c=t[o][h];isNaN(c)||""===c||null===c||(c=Number(c)),s[h].data.push(c)}function d(t){for(var e={},n=i.data,r=0;r<n.length;r++)e[n[r].field]=n[r].data[i.range.start+t];return e}return i}window.devicePixelRatio;var Us=function(t,e){if(document[t]){return function e(i,n,r){if(i.length)for(var s=0;s<i.length;s++)e(i[s],n,r);else i[t](n,r,!1)}}return function t(i,n,r){if(i.length)for(var s=0;s<i.length;s++)t(i[s],n,r);else i[e]("on"+n,function(){return r.call(i,window.event)})}};Us("addEventListener","attachEvent"),Us("removeEventListener","detachEvent");var Fs={},Bs={},Vs=Array.prototype,Gs=Object.prototype,Ws=Function.prototype,js=Vs.push,Hs=Vs.slice,qs=Vs.concat,Xs=Gs.toString,Ys=Gs.hasOwnProperty,Zs=Vs.forEach,Qs=Vs.map,Ks=Vs.filter,Js=Vs.every,$s=Vs.some,to=Vs.indexOf,eo=Array.isArray,io=Object.keys,no=(Ws.bind,Math.pow(2,53)-1),ro=function(t){return function(e){return null==e?void 0:e[t]}}("length"),so=function(t){var e=ro(t);return"number"==typeof e&&e>=0&&e<=no};Fs.values=function(t){for(var e=Fs.keys(t),i=e.length,n=new Array(i),r=0;r<i;r++)n[r]=t[e[r]];return n},Fs.keys=io||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)Fs.has(t,i)&&e.push(i);return e},Fs.has=function(t,e){return Ys.call(t,e)};var oo=Fs.each=Fs.forEach=function(t,e,i){if(null!=t)if(Zs&&t.forEach===Zs)t.forEach(e,i);else if(t.length===+t.length){for(var n=0,r=t.length;n<r;n++)if(e.call(i,t[n],n,t)===Bs)return}else{var s=Fs.keys(t);for(n=0,r=s.length;n<r;n++)if(e.call(i,t[s[n]],s[n],t)===Bs)return}};Fs.compact=function(t){return Fs.filter(t,Fs.identity)},Fs.filter=Fs.select=function(t,e,i){var n=[];return null==t?n:Ks&&t.filter===Ks?t.filter(e,i):(oo(t,function(t,r,s){e.call(i,t,r,s)&&n.push(t)}),n)},oo(["Arguments","Function","String","Number","Date","RegExp"],function(t){Fs["is"+t]=function(e){return Xs.call(e)=="[object "+t+"]"}}),Fs.isArguments(arguments)||(Fs.isArguments=function(t){return!(!t||!Fs.has(t,"callee"))}),Fs.isFunction=function(t){return"function"==typeof t},Fs.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},Fs.isNaN=function(t){return Fs.isNumber(t)&&t!=+t},Fs.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==Xs.call(t)},Fs.isNull=function(t){return null===t},Fs.isEmpty=function(t){if(null==t)return!0;if(Fs.isArray(t)||Fs.isString(t))return 0===t.length;for(var e in t)if(Fs.has(t,e))return!1;return!0},Fs.isElement=function(t){return!(!t||1!==t.nodeType)},Fs.isArray=eo||function(t){return"[object Array]"==Xs.call(t)},Fs.isObject=function(t){return t===Object(t)},Fs.identity=function(t){return t},Fs.indexOf=function(t,e,i){if(null==t)return-1;var n=0,r=t.length;if(i){if("number"!=typeof i)return t[n=Fs.sortedIndex(t,e)]===e?n:-1;n=i<0?Math.max(0,r+i):i}if(to&&t.indexOf===to)return t.indexOf(e,i);for(;n<r;n++)if(t[n]===e)return n;return-1},Fs.isWindow=function(t){return null!=t&&t==t.window};Fs.flatten=function(t,e){return function t(e,i,n){return i&&Fs.every(e,Fs.isArray)?qs.apply(n,e):(oo(e,function(e){Fs.isArray(e)||Fs.isArguments(e)?i?js.apply(n,e):t(e,i,n):n.push(e)}),n)}(t,e,[])},Fs.every=Fs.all=function(t,e,i){e||(e=Fs.identity);var n=!0;return null==t?n:Js&&t.every===Js?t.every(e,i):(oo(t,function(t,r,s){if(!(n=n&&e.call(i,t,r,s)))return Bs}),!!n)},Fs.min=function(t,e,i){if(!e&&Fs.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&Fs.isEmpty(t))return 1/0;var n={computed:1/0,value:1/0};return oo(t,function(t,r,s){var o=e?e.call(i,t,r,s):t;o<n.computed&&(n={value:t,computed:o})}),n.value},Fs.max=function(t,e,i){if(!e&&Fs.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&Fs.isEmpty(t))return-1/0;var n={computed:-1/0,value:-1/0};return oo(t,function(t,r,s){var o=e?e.call(i,t,r,s):t;o>n.computed&&(n={value:t,computed:o})}),n.value},Fs.find=Fs.detect=function(t,e,i){var n;return ao(t,function(t,r,s){if(e.call(i,t,r,s))return n=t,!0}),n};var ao=Fs.some=Fs.any=function(t,e,i){e||(e=Fs.identity);var n=!1;return null==t?n:$s&&t.some===$s?t.some(e,i):(oo(t,function(t,r,s){if(n||(n=e.call(i,t,r,s)))return Bs}),!!n)};Fs.without=function(t){return Fs.difference(t,Hs.call(arguments,1))},Fs.difference=function(t){var e=qs.apply(Vs,Hs.call(arguments,1));return Fs.filter(t,function(t){return!Fs.contains(e,t)})},Fs.uniq=Fs.unique=function(t,e,i,n){Fs.isFunction(e)&&(n=i,i=e,e=!1);var r=i?Fs.map(t,i,n):t,s=[],o=[];return oo(r,function(i,n){(e?n&&o[o.length-1]===i:Fs.contains(o,i))||(o.push(i),s.push(t[n]))}),s},Fs.map=Fs.collect=function(t,e,i){var n=[];return null==t?n:Qs&&t.map===Qs?t.map(e,i):(oo(t,function(t,r,s){n.push(e.call(i,t,r,s))}),n)},Fs.contains=Fs.include=function(t,e){return null!=t&&(to&&t.indexOf===to?-1!=t.indexOf(e):ao(t,function(t){return t===e}))},Fs.pluck=function(t,e){return Fs.map(t,function(t){return t[e]})},Fs.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},Fs.shuffle=function(t){return Fs.sample(t,1/0)},Fs.sample=function(t,e,i){if(null==e||i)return so(t)||(t=Fs.values(t)),t[Fs.random(t.length-1)];var n=so(t)?Fs.clone(t):Fs.values(t),r=ro(n);e=Math.max(Math.min(e,r),0);for(var s=r-1,o=0;o<e;o++){var a=Fs.random(o,s),l=n[o];n[o]=n[a],n[a]=l}return n.slice(0,e)},Fs.extend=function(){var t,e,i,n,r=arguments[0]||{},s=1,o=arguments.length,a=!1;for("boolean"==typeof r&&(a=r,r=arguments[1]||{},s=2),"object"===(void 0===r?"undefined":_typeof2(r))||Fs.isFunction(r)||(r={}),o===s&&(r=this,--s);s<o;s++)if(null!=(t=arguments[s]))for(e in t)i=r[e],r!==(n=t[e])&&(a&&n&&Fs.isObject(n)&&n.constructor===Object?r[e]=Fs.extend(a,i,n):r[e]=n);return r},Fs.clone=function(t){return Fs.isObject(t)?Fs.isArray(t)?t.slice():Fs.extend(!0,{},t):t},Fs.isSafeObject=function(t,e){e=e||"",t=Fs.clone(t);var i=e.split("."),n=!0;return i.forEach(function(e){void 0!==t[e]?t=t[e]:n=!1}),n};var lo=function(t){return Fs.isString(t)?document.getElementById(t):1==t.nodeType?t:t.length?t[0]:null},ho=function(t,e,i){var n=document.createElement("div");n.className="canvax-view",n.style.cssText+="position:relative;width:100%;height:100%;";var r=document.createElement("div");r.style.cssText+="position:absolute;width:"+t+"px;height:"+e+"px;";var s=document.createElement("div");return s.style.cssText+="position:absolute;width:"+t+"px;height:"+e+"px;",n.appendChild(r),n.appendChild(s),{view:n,stageView:r,domView:s}};function uo(t,e){var i=Number(t),n=e||",";if(!i)return String(t);if(i>=1e3){var r=parseInt(i/1e3);return String(t.toString().replace(r,r+n))}return String(t)}var co=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.layers=[],t.isUpdate=!0,t.currTick=(new Date).getTime(),t.lastTick=null,t.renderer=null,t._groups=[],t}return _inherits(e,N),_createClass(e,[{key:"init",value:function(){this._InitRender()}},{key:"_InitRender",value:function(){try{this.renderer=new on({alpha:!0,depth:!0,antialias:!0,premultipliedAlpha:!0})}catch(t){return this.view.style.cssText="display: flex;justify-content: center;align-items:center;font-size:16px;color:#666;width:100%;height:100%;",this.view.innerHTML=",3D!",void console.error(t)}}},{key:"render",value:function(){var t=this,e=this.isUpdate;this.lastTick-this.currTick>5e3&&(this.isUpdate=!1),this.fire({type:"renderbefore"}),e&&(this.layers.forEach(function(e,i){t.layers.length>1&&i!==t.layers.length-1?t.renderer.autoClear=!0:t.renderer.autoClear=!1,t.renderer.render(e._scene,e._camera)}),this.lastTick=(new Date).getTime()),this.fire({type:"renderafter"})}},{key:"renderFrame",value:function(){var t=this;this.render(),this.frameId=window.requestAnimationFrame(function(){t.renderFrame()})}},{key:"stopRenderFrame",value:function(){window.cancelAnimationFrame(this.frameId),this.frameId=null}},{key:"addView",value:function(t){this.layers.push(t)}},{key:"removeView",value:function(t){var e=this.layers.indexOf(t);e>=0&&this.layers.splice(e,1)}},{key:"addGroup",value:function(t){var e=new En;return e.on("removed",function(){this.geometry&&this.geometry.dispose(),this.material&&this.material.dispose()}),e.name=t&&t.name||"",this._groups.push(e),e}}]),e}(),fo=function(){function t(e,i){_classCallCheck(this,t),this._scene=new Pn,this._camera=null,this.name=i||"",this._frameWork=e,this.renderer=e.renderer,this.width=0,this.height=0,this.aspect=1,this.fov=45,this.near=.1,this.far=1e4,this.mode=null,this.controls=null}return _createClass(t,[{key:"setSize",value:function(t,e){this.width=t,this.height=e,this.aspect=this.height?this.width/this.height:1,this.renderer.setPixelRatio(window.devicePixelRatio||1),this.renderer.setSize(t,e)}},{key:"setBackground",value:function(t){this._scene.background=t}},{key:"setControls",value:function(t){this.controls=t}},{key:"addObject",value:function(t){this._scene.add(t)}},{key:"removeObject",value:function(t){this._scene.remove(t)}},{key:"project",value:function(t){this.mode=t;var e=this.controls,i=this.aspect,n=e.boxHeight,r=e.distance;"perspective"===t?(this._camera=new $r(this.fov,this.aspect,this.near,this.far),this._camera.position.set(0,0,r)):(this._camera=new ts(n*i/-2,n*i/2,n/2,n/-2,this.near,this.far),this._camera.position.set(0,0,r))}},{key:"createScreenProject",value:function(){var t=this.controls.maxDistance;this._camera=new ts(0,this.width,0,-this.height,this.near,this.far),this._camera.position.set(0,0,t)}},{key:"getVisableSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rt,e={width:0,height:0,ratio:0};if("ortho"==this.mode&&(e.width=Math.round(this._camera.right-this._camera.left),e.height=Math.round(this._camera.top-this._camera.bottom)),"perspective"==this.mode){var i=this._camera.position.clone().distanceTo(t),n=It.degToRad(this.fov),r=2*Math.tan(n/2)*i;e.width=r*this.aspect,e.height=r}return 0!=this.width&&(e.ratio=e.width/this.width),e}},{key:"getObjectScale",value:function(t){var e=new Rt;return t.getWorldScale(e)}},{key:"resize",value:function(t,e,i){this.setSize(t,e),"perspective"==this.mode?this._camera.aspect=this.aspect:(this._camera.left=i*aspect/-2,this._camera.right=i*aspect/2,this._camera.top=i/2,this._camera.bottom=i/-2),this._camera.updateProjectionMatrix()}},{key:"dispose",value:function(){this._scene=null,this._camera=null,this._frameWork=null,this.renderer=null}}]),t}(),po=document.createElementNS("http://www.w3.org/1999/xhtml","canvas").getContext("2d"),vo=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.scale,n=void 0===i?0:i,r=e.color,s=void 0===r?"#333333":r,o=e.fontSize,a=void 0===o?14:o,l=e.fontFamily,h=void 0===l?",sans-serif":l,u=e.isBold,c=void 0!==u&&u,d=e.lineHeight,f=void 0===d?1.2:d,p=e.defaultTextureWidth,v=void 0===p?128:p,y=e.canvas,m=void 0===y?null:y;_classCallCheck(this,t),this.scale=n||window.devicePixelRatio||1,this.style={color:s,fontSize:a,fontFamily:h,isBold:c,lineHeight:f},this.style.textAlign="left",this.style.textBaseline="top",this.defaultTextureWidth=v,this._reNewline=/\r?\n/,this.canvas=m||document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.context=this.canvas.getContext("2d")}return _createClass(t,[{key:"getFont",value:function(){return this.style.isBold?"bold ":"normal "+this.style.fontSize+"px "+this.style.fontFamily}},{key:"getTextWidth",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=0;return po&&(po.save(),po.font=e||this.getFont(),i=this._getTextWidth(po,this._getTextLines(t)),po.restore()),i}},{key:"getTextHeight",value:function(t){return this._getTextHeight(this._getTextLines(t))}},{key:"_getTextWidth",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=0;return e.forEach(function(e){var n=t.measureText(e).width;i=Math.max(i,n)}),i}},{key:"_getTextLines",value:function(t){return(t+="").split(this._reNewline)}},{key:"_getTextHeight",value:function(t){return this.style.fontSize*t.length*this.style.lineHeight}},{key:"computeUvsAndCanvasSize",value:function(t){var e=this,i=0,n=0,r=0,s=0,o={},a={},l=0,h=1;t.forEach(function(t){var r=e.getTextWidth(t);i=Math.max(i,r),n=Math.max(n,e.getTextHeight(t)),(l+=r)>e.defaultTextureWidth&&(h++,l=r)}),1==h?(r=It.ceilPowerOfTwo(l),s=It.ceilPowerOfTwo(n)):(r=this.defaultTextureWidth,s=It.ceilPowerOfTwo(n*h));var u=0;return l=0,h=0,t.forEach(function(t,i){var n=e.getTextWidth(t),r=e.getTextHeight(t);a[t]=[n,r],u=l,0==i&&(h=r),(l+=n)<e.defaultTextureWidth||(h+=r,l=n,u=0);var c=s-h,d=l,f=s-h+r;o[t]=[u,c,d,c,d,f,u,f]}),{canvasWidth:r,canvasHeight:s,maxHeight:n,maxWidth:i,uvs:o,sizes:a}}},{key:"setCanvasSize",value:function(t,e){this.canvas.width=t*this.scale,this.canvas.height=e*this.scale,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.context.scale(this.scale,this.scale),this.width=t,this.height=e,this.context.fillStyle="rgba(0,0,0,0)",this.context.clearRect(0,0,t*this.scale,e*this.scale)}},{key:"drawTexts",value:function(t){var e=this,i=this,n={},r=this.computeUvsAndCanvasSize(t),s=r.maxWidth,o=r.maxHeight,a=r.canvasWidth,l=r.canvasHeight,h=r.uvs,u=r.sizes;return this.setCanvasSize(a,l),i.context.fillStyle=i.style.color,i.context.textAlign=i.style.textAlign,i.context.textBaseline=i.style.textBaseline,i.context.webkitImageSmoothingEnabled=!0,i.context.font=i.style.isBold?"bold ":"normal "+i.style.fontSize+"px "+i.style.fontFamily,t.forEach(function(t){var r=h[t];n[t]=new Float32Array([r[0]/a,r[1]/l,r[2]/a,r[3]/l,r[4]/a,r[5]/l,r[6]/a,r[7]/l]),e._getTextLines(t).forEach(function(t,n){i.context.fillText(t,r[0],l-r[5]+e.style.fontSize*e.style.lineHeight*n)})}),window._debug=!1,window._debug&&(document.body.appendChild(i.canvas),i.canvas.style.position="absolute",i.canvas.style.left="700px",i.canvas.style.top="0"),{UVs:n,sizes:u,maxWidth:s,maxHeight:o}}},{key:"measureText",value:function(t){return{width:this.getTextWidth(t),height:this.getTextHeight(t)}}}]),t}(),yo=go,mo=go;function go(t,e,i){i=i||2;var n,r,s,o,a,l,h,u=e&&e.length,c=u?e[0]*i:t.length,d=_o(t,0,c,i,!0),f=[];if(!d)return f;if(u&&(d=function(t,e,i,n){var r,s,o,a,l,h=[];for(r=0,s=e.length;r<s;r++)o=e[r]*n,a=r<s-1?e[r+1]*n:t.length,(l=_o(t,o,a,n,!1))===l.next&&(l.steiner=!0),h.push(Po(l));for(h.sort(Ao),r=0;r<h.length;r++)Lo(h[r],i),i=xo(i,i.next);return i}(t,e,d,i)),t.length>80*i){n=s=t[0],r=o=t[1];for(var p=i;p<c;p+=i)(a=t[p])<n&&(n=a),(l=t[p+1])<r&&(r=l),a>s&&(s=a),l>o&&(o=l);h=0!==(h=Math.max(s-n,o-r))?1/h:0}return bo(d,f,i,n,r,h),f}function _o(t,e,i,n,r){var s,o;if(r===Bo(t,e,i,n)>0)for(s=e;s<i;s+=n)o=No(s,t[s],t[s+1],o);else for(s=i-n;s>=e;s-=n)o=No(s,t[s],t[s+1],o);return o&&Do(o,o.next)&&(Uo(o),o=o.next),o}function xo(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!Do(n,n.next)&&0!==Oo(n.prev,n,n.next))n=n.next;else{if(Uo(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function bo(t,e,i,n,r,s,o){if(t){!o&&s&&function(t,e,i,n){var r=t;do{null===r.z&&(r.z=Mo(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,s,o,a,l,h=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,n=i,a=0,e=0;e<h&&(a++,n=n.nextZ);e++);for(l=h;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,h*=2}while(o>1)}(r)}(t,n,r,s);for(var a,l,h=t;t.prev!==t.next;)if(a=t.prev,l=t.next,s?ko(t,n,r,s):wo(t))e.push(a.i/i),e.push(t.i/i),e.push(l.i/i),Uo(t),t=l.next,h=l.next;else if((t=l)===h){o?1===o?bo(t=So(t,e,i),e,i,n,r,s,2):2===o&&Co(t,e,i,n,r,s):bo(xo(t),e,i,n,r,s,1);break}}}function wo(t){var e=t.prev,i=t,n=t.next;if(Oo(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(Eo(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&Oo(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function ko(t,e,i,n){var r=t.prev,s=t,o=t.next;if(Oo(r,s,o)>=0)return!1;for(var a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,h=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,u=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,c=Mo(a,l,e,i,n),d=Mo(h,u,e,i,n),f=t.prevZ,p=t.nextZ;f&&f.z>=c&&p&&p.z<=d;){if(f!==t.prev&&f!==t.next&&Eo(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Oo(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==t.prev&&p!==t.next&&Eo(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Oo(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=c;){if(f!==t.prev&&f!==t.next&&Eo(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Oo(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&Eo(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Oo(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function So(t,e,i){var n=t;do{var r=n.prev,s=n.next.next;!Do(r,s)&&zo(r,n,n.next,s)&&Io(r,s)&&Io(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),Uo(n),Uo(n.next),n=t=s),n=n.next}while(n!==t);return n}function Co(t,e,i,n,r,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&To(o,a)){var l=Ro(o,a);return o=xo(o,o.next),l=xo(l,l.next),bo(o,e,i,n,r,s),void bo(l,e,i,n,r,s)}a=a.next}o=o.next}while(o!==t)}function Ao(t,e){return t.x-e.x}function Lo(t,e){if(e=function(t,e){var i,n=e,r=t.x,s=t.y,o=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>o){if(o=a,a===r){if(s===n.y)return n;if(s===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===o)return i.prev;var l,h=i,u=i.x,c=i.y,d=1/0;n=i.next;for(;n!==h;)r>=n.x&&n.x>=u&&r!==n.x&&Eo(s<c?r:o,s,u,c,s<c?o:r,s,n.x,n.y)&&((l=Math.abs(s-n.y)/(r-n.x))<d||l===d&&n.x>i.x)&&Io(n,t)&&(i=n,d=l),n=n.next;return i}(t,e)){var i=Ro(e,t);xo(i,i.next)}}function Mo(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Po(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function Eo(t,e,i,n,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(n-a)-(i-o)*(e-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function To(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&zo(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&Io(t,e)&&Io(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)}function Oo(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Do(t,e){return t.x===e.x&&t.y===e.y}function zo(t,e,i,n){return!!(Do(t,e)&&Do(i,n)||Do(t,n)&&Do(i,e))||Oo(t,e,i)>0!=Oo(t,e,n)>0&&Oo(i,n,t)>0!=Oo(i,n,e)>0}function Io(t,e){return Oo(t.prev,t,t.next)<0?Oo(t,e,t.next)>=0&&Oo(t,t.prev,e)>=0:Oo(t,e,t.prev)<0||Oo(t,t.next,e)<0}function Ro(t,e){var i=new Fo(t.i,t.x,t.y),n=new Fo(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function No(t,e,i,n){var r=new Fo(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Uo(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Fo(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Bo(t,e,i,n){for(var r=0,s=e,o=i-n;s<i;s+=n)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}go.deviation=function(t,e,i,n){var r=e&&e.length,s=r?e[0]*i:t.length,o=Math.abs(Bo(t,0,s,i));if(r)for(var a=0,l=e.length;a<l;a++){var h=e[a]*i,u=a<l-1?e[a+1]*i:t.length;o-=Math.abs(Bo(t,h,u,i))}var c=0;for(a=0;a<n.length;a+=3){var d=n[a]*i,f=n[a+1]*i,p=n[a+2]*i;c+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},go.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)i.vertices.push(t[r][s][o]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i},yo.default=mo;var Vo=function(){return new lr({})},Go={createBox:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Vo(),r=new Ht,s=new Br(1,1,1),o=new hr(s,n);return s.vertices.forEach(function(t){t.addScalar(.5),t.z*=-1}),r.makeScale(t,e,i),s.vertices.forEach(function(t){t.applyMatrix4(r)}),o},createCylinder:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:Vo()),n=new Ht,r=new Wr(1,1,1,60),s=new hr(r,i);r.vertices.forEach(function(t){t.addScalar(.5),t.z*=-1});var o=.5*t;return n.makeScale(o,e,o),r.vertices.forEach(function(t){t.applyMatrix4(n)}),s},createCone:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:Vo()),n=new Ht,r=new Wr(0,1,1,60),s=new hr(r,i);r.vertices.forEach(function(t){t.addScalar(.5),t.z*=-1});var o=.5*t;return n.makeScale(o,e,o),r.vertices.forEach(function(t){t.applyMatrix4(n)}),s},createPlane:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};i||(i=new Hr({color:s.fillStyle||16777215*Math.random(),side:FrontSide,transparent:!0,opacity:s.alpha||1,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:.1,depthTest:!0,depthWrite:!1}));var o=new PlaneGeometry(t,e),a=new hr(o,i);return n.dir.equals(new Rt(1,0,0))&&a.rotateY(hr.degToRad(90)),n.dir.equals(new Rt(-1,0,0))&&a.rotateY(hr.degToRad(-90)),n.dir.equals(new Rt(0,1,0))&&a.rotateX(hr.degToRad(-90)),n.dir.equals(new Rt(0,-1,0))&&a.rotateX(hr.degToRad(90)),n.dir.equals(new Rt(0,0,-1))&&a.rotateY(hr.degToRad(180)),n.center&&a.position.copy(n.center),r&&(r.visible=n.visible,r.add(a)),a.renderOrder=-100,a},createCommonLine:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments[1],i=new cr({color:e.strokeStyle,depthTest:!0,depthWrite:!1});"dashed"==e.lineType&&(i=new Xr({color:e.strokeStyle}));var n=new Ur;return t.forEach(function(t){n.vertices.push(t)}),new dr(n,i)},createLine:function(t,e,i,n,r){var s=new En,o=null;e.normalize();var a=new Lr({color:r,transparent:!0,linewidth:n,resolution:new Pe(this.width,this.height),dashed:!1});ds.isArray(t)||(t=[t]);var l=[];return t.forEach(function(t){(l=[]).push([0,0,0]);var n=new Rt,r=new Rt;r.copy(e),r.multiplyScalar(i),n.add(r),l.push(n.toArray());var h=new Sr;h.setPositions(ds.flatten(l)),(o=new Mr(h,a)).drawMode=F,o.computeLineDistances(),o.scale.set(1,1,1),o.position.copy(t),s.add(o)}),s},createBrokenLine:function(t,e,i){var n=new Lr({color:i,linewidth:e,resolution:new Pe(this.width,this.height),dashed:!1,depthTest:!0,depthWrite:!1}),r=new Sr,s=[];t.forEach(function(t){s=s.concat(t.toArray())}),r.setPositions(s);var o=new Mr(r,n);return o.drawMode=F,o.computeLineDistances(),o},createCirclePlane:function(t,e,i){var n=new Fr(t,32);i||(i=new Er({color:e.fillStyle||16777215*Math.random(),transparent:!0,opacity:e.alpha||1,depthTest:!0,depthWrite:!1}));var r=new Tr(i);return r.geometry=n,r},createSphere:function(t,e,i){i||(i=new lr({color:e.fillStyle||16777215*Math.random(),transparent:!0,opacity:e.alpha||1,depthTest:!0,depthWrite:!1}));var n=new Gr(t);return new hr(n,i)},creatSpriteText:function(t,e){var i=[],n=new vo(e);ds.isArray(t)||(t=[t]);var r=n.drawTexts(t),s=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),o=new ri;o.image=n.canvas,o.needsUpdate=!0;var a=new Er({map:o,transparent:!0,depthWrite:!1});return t.forEach(function(t,e){var n=r.sizes[t],o=new Rt(n[0]/n[1],1,1);o.multiplyScalar(n[1]);var l=new Tr(a),h=new Re;h.setIndex([0,1,2,0,2,3]),h.addAttribute("position",new De(s,3,!1)),h.addAttribute("uv",new De(r.UVs[t],2,!1)),l.geometry=h,l.scale.copy(o),l.userData={text:t,size:n,maxWidth:r.maxWidth,maxHeight:r.maxHeight},l.frustumCulled=!1,i.push(l)}),i},createPolygonPlane:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments[2];i||(i=new lr({color:e.fillStyle||16777215*Math.random(),side:W,transparent:!0,opacity:e.alpha||.5,depthTest:!0,depthWrite:!1}));var n=yo(t,null,3),r=new Re,s=new De(t,3);return r.addAttribute("position",s),r.setIndex(n),new hr(r,i)}},Wo=function(){function t(e,i){_classCallCheck(this,t),this._framework=new co,this._framework.init(),this.width=e,this.height=i}return _createClass(t,[{key:"launch",value:function(){this._framework.renderFrame()}},{key:"createView",value:function(t){var e=new fo(this._framework,t);this._framework.addView(e)}},{key:"getView",value:function(t){var e=null;return this._framework.layers.forEach(function(i){i.name===t&&(e=i)}),e}},{key:"addGroup",value:function(t){return this._framework.addGroup(t)}},{key:"dispose",value:function(){var t=this;this._framework.layers.forEach(function(e){t._framework.removeView(e),e.dispose()}),this._framework.stopRenderFrame(),this._framework.renderer.dispose(),this._framework.render=null}}]),t}();Object.assign(Wo.prototype,Go);var jo=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._coordSystem=t,i._root=t._root,i.group=i._root.app.addGroup({name:i.constructor.name.toLowerCase()+"_root"}),i}return _inherits(e,N),_createClass(e,[{key:"setGroupName",value:function(t){this.group.name=t}},{key:"dispose",value:function(){var t=[];for(this.group.traverse(function(e){(e.isMesh||e.isLine||e.isLine2||e.isTextSprite)&&(e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose(),t.push(e))});t.length;){var e=t.pop();e.parent?e.parent.remove(e):e=null}}},{key:"draw",value:function(){}}]),e}(),Ho={colors:["#ff8533","#73ace6","#82d982","#e673ac","#cd6bed","#8282d9","#c0e650","#e6ac73","#6bcded","#73e6ac","#ed6bcd","#9966cc"],set:function(t){return this.colors=t,this.colors},get:function(){return this.colors}},qo=1e-6,Xo={type:"change"},Yo={type:"start"},Zo={type:"end"},Qo={LEFT:0,MIDDLE:1,RIGHT:2},Ko={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},Jo=function(t){function e(t,i){_classCallCheck(this,e);var n,r,s,o,a,l=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),h=l;return l.object=t,l.domElement=void 0!==i?i:document,l.enabled=!0,l.target=new Rt,l.minDistance=0,l.maxDistance=1/0,l.minZoom=0,l.maxZoom=1/0,l.minPolarAngle=0,l.maxPolarAngle=Math.PI,l.minAzimuthAngle=-1/0,l.maxAzimuthAngle=1/0,l.enableDamping=!1,l.dampingFactor=.25,l.enableZoom=!0,l.zoomSpeed=1,l.enableRotate=!0,l.rotateSpeed=1,l.enablePan=!0,l.panSpeed=1,l.screenSpacePanning=!1,l.keyPanSpeed=7,l.autoRotate=!1,l.autoRotateSpeed=2,l.enableKeys=!0,l.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},l.mouseButtons={ORBIT:Qo.LEFT,ZOOM:Qo.MIDDLE,PAN:Qo.RIGHT},l.target0=l.target.clone(),l.position0=l.object.position.clone(),l.zoom0=l.object.zoom,l._state=Ko.NONE,l._spherical=new rs,l._sphericalDelta=new rs,l._scale=1,l._panOffset=new Rt,l._zoomChanged=!1,l._rotateStart=new Pe,l._rotateEnd=new Pe,l._rotateDelta=new Pe,l._panStart=new Pe,l._panEnd=new Pe,l._panDelta=new Pe,l._dollyStart=new Pe,l._dollyEnd=new Pe,l._dollyDelta=new Pe,h._onContextMenubind=function(t){if(!1===this.enabled)return;t.preventDefault()}.bind(h),h._onMouseDownbind=function(t){if(!1===this.enabled)return;switch(t.preventDefault(),t.button){case this.mouseButtons.ORBIT:if(!1===this.enableRotate)return;(function(t){this._rotateStart.set(t.clientX,t.clientY)}).call(this,t),this._state=Ko.ROTATE;break;case this.mouseButtons.ZOOM:if(!1===this.enableZoom)return;(function(t){this._dollyStart.set(t.clientX,t.clientY)}).call(this,t),this._state=Ko.DOLLY;break;case this.mouseButtons.PAN:if(!1===this.enablePan)return;(function(t){this._panStart.set(t.clientX,t.clientY)}).call(this,t),this._state=Ko.PAN}this._state!==Ko.NONE&&(this._onMouseMovebind=la.bind(this),this._onMouseUpbind=function t(e){if(!1===this.enabled)return;(function(t){}).call(this,e);document.removeEventListener("mousemove",la.bind(this),!1);document.removeEventListener("mouseup",t.bind(this),!1);this.fire(Zo);this._state=Ko.NONE}.bind(this),document.addEventListener("mousemove",this._onMouseMovebind,!1),document.addEventListener("mouseup",this._onMouseUpbind,!1),this.fire(Yo))}.bind(h),h._onMouseWheelbind=function(t){if(!1===this.enabled||!1===this.enableZoom||this._state!==Ko.NONE&&this._state!==Ko.ROTATE)return;t.preventDefault(),t.stopPropagation(),this.fire(Yo),function(t){t.deltaY<0?aa.call(this,$o.call(this)):t.deltaY>0&&oa.call(this,$o.call(this));this.update()}.call(this,t),this.fire(Zo)}.bind(h),h._onTouchStartbind=function(t){if(!1===this.enabled)return;switch(t.preventDefault(),t.touches.length){case 1:if(!1===this.enableRotate)return;(function(t){this._rotateStart.set(t.touches[0].pageX,t.touches[0].pageY)}).call(this,t),this._state=Ko.TOUCH_ROTATE;break;case 2:if(!1===this.enableZoom&&!1===this.enablePan)return;(function(t){if(this.enableZoom){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(e*e+i*i);this._dollyStart.set(0,n)}if(this.enablePan){var r=.5*(t.touches[0].pageX+t.touches[1].pageX),s=.5*(t.touches[0].pageY+t.touches[1].pageY);this._panStart.set(r,s)}}).call(this,t),this._state=Ko.TOUCH_DOLLY_PAN;break;default:this._state=Ko.NONE}this._state!==Ko.NONE&&this.fire(Yo)}.bind(h),h._onTouchEndbind=function(t){if(!1===this.enabled)return;(function(t){}).call(this,t),this.fire(Zo),this._state=Ko.NONE}.bind(h),h._onTouchMove=function(t){if(!1===this.enabled)return;switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===this.enableRotate)return;if(this._state!==Ko.TOUCH_ROTATE)return;(function(t){this._rotateEnd.set(t.touches[0].pageX,t.touches[0].pageY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);var e=this.domElement===document?this.domElement.body:this.domElement;ta.call(this,2*Math.PI*this._rotateDelta.x/e.clientHeight),ea.call(this,2*Math.PI*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}).call(this,t);break;case 2:if(!1===this.enableZoom&&!1===this.enablePan)return;if(this._state!==Ko.TOUCH_DOLLY_PAN)return;(function(t){if(this.enableZoom){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(e*e+i*i);this._dollyEnd.set(0,n),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),oa.call(this,this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd)}if(this.enablePan){var r=.5*(t.touches[0].pageX+t.touches[1].pageX),s=.5*(t.touches[0].pageY+t.touches[1].pageY);this._panEnd.set(r,s),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),sa.call(this,this._panDelta.x,panDelta.y),this._panStart.copy(this._panEnd)}this.update()}).call(this,t);break;default:this._state=Ko.NONE}}.bind(h),h._onKeyDownbind=function(t){if(!1===this.enabled||!1===this.enableKeys||!1===this.enablePan)return;(function(t){switch(t.keyCode){case this.keys.UP:sa.call(this,0,this.keyPanSpeed),this.update();break;case this.keys.BOTTOM:sa.call(this,0,-this.keyPanSpeed),this.update();break;case this.keys.LEFT:sa.call(this,this.keyPanSpeed,0),this.update();break;case this.keys.RIGHT:sa.call(this,-this.keyPanSpeed,0),this.update()}}).call(this,t)}.bind(h),h.domElement.addEventListener("contextmenu",l._onContextMenubind,!1),h.domElement.addEventListener("mousedown",l._onMouseDownbind,!1),h.domElement.addEventListener("wheel",l._onMouseWheelbind,!1),h.domElement.addEventListener("touchstart",l._onTouchStartbind,!1),h.domElement.addEventListener("touchend",l._onTouchEndbind,!1),h.domElement.addEventListener("touchmove",l._onTouchMove,!1),window.addEventListener("keydown",l._onKeyDownbind,!1),l.update=(n=new Rt,r=(new pn).setFromUnitVectors(t.up,new Rt(0,1,0)),s=r.clone().inverse(),o=new Rt,a=new pn,function(){var t=h.object.position;return n.copy(t).sub(h.target),n.applyQuaternion(r),h._spherical.setFromVector3(n),h.autoRotate&&this._state===Ko.NONE&&ta.call(h,function(){return 2*Math.PI/60/60*this.autoRotateSpeed}.call(h)),h._spherical.theta+=h._sphericalDelta.theta,h._spherical.phi+=h._sphericalDelta.phi,h._spherical.theta=Math.max(h.minAzimuthAngle,Math.min(h.maxAzimuthAngle,h._spherical.theta)),h._spherical.phi=Math.max(h.minPolarAngle,Math.min(h.maxPolarAngle,h._spherical.phi)),h._spherical.makeSafe(),h._spherical.radius*=h._scale,h._spherical.radius=Math.max(h.minDistance,Math.min(h.maxDistance,h._spherical.radius)),h.target.add(h._panOffset),n.setFromSpherical(h._spherical),n.applyQuaternion(s),t.copy(h.target).add(n),h.object.lookAt(h.target),!0===h.enableDamping?(h._sphericalDelta.theta*=1-h.dampingFactor,h._sphericalDelta.phi*=1-h.dampingFactor,h._panOffset.multiplyScalar(1-h.dampingFactor)):(h._sphericalDelta.set(0,0,0),h._panOffset.set(0,0,0)),h._scale=1,!!(this._zoomChanged||o.distanceToSquared(h.object.position)>qo||8*(1-a.dot(h.object.quaternion))>qo)&&(h.fire(Xo),o.copy(h.object.position),a.copy(h.object.quaternion),this._zoomChanged=!1,!0)}),l.update(),l}return _inherits(e,N),_createClass(e,[{key:"getPolarAngle",value:function(){return _spherical.phi}},{key:"getAzimuthalAngle",value:function(){return _spherical.theta}},{key:"saveState",value:function(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}},{key:"reset",value:function(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.fire(Xo),this.update(),this._state=Ko.NONE}},{key:"dispose",value:function(){this.domElement.removeEventListener("contextmenu",this._onContextMenubind,!1),this.domElement.removeEventListener("mousedown",this._onMouseDownbind,!1),this.domElement.removeEventListener("wheel",this._onMouseWheelbind,!1),this.domElement.removeEventListener("touchstart",this.onTouchStart,!1),this.domElement.removeEventListener("touchend",this._onTouchEndbind,!1),this.domElement.removeEventListener("touchmove",this._onTouchMove,!1),document.removeEventListener("mousemove",this._onMouseMovebind,!1),document.removeEventListener("mouseup",this._onMouseUpbind,!1),window.removeEventListener("keydown",this._onKeyDownbind,!1),this._onContextMenubind=null,this._onMouseDownbind=null,this._onMouseWheelbind=null,this.onTouchStart=null,this._onTouchEndbind=null,this._onTouchMove=null,this._onMouseMovebind=null,this._onMouseUpbind=null,this._onKeyDownbind=null}}]),e}();function $o(){return Math.pow(.95,this.zoomSpeed)}function ta(t){this._sphericalDelta.theta-=t}function ea(t){this._sphericalDelta.phi-=t}var ia,na=function(){var t=new Rt;return function(e,i){t.setFromMatrixColumn(i,0),t.multiplyScalar(-e),this._panOffset.add(t)}}(),ra=function(){var t=new Rt;return function(e,i){!0===this.screenSpacePanning?t.setFromMatrixColumn(i,1):(t.setFromMatrixColumn(i,0),t.crossVectors(this.object.up,t)),t.multiplyScalar(e),this._panOffset.add(t)}}(),sa=(ia=new Rt,function(t,e){var i=this.domElement===document?this.domElement.body:this.domElement;if(this.object.isPerspectiveCamera){var n=this.object.position;ia.copy(n).sub(this.target);var r=ia.length();r*=Math.tan(this.object.fov/2*Math.PI/180),na.call(this,2*t*r/i.clientHeight,this.object.matrix),ra.call(this,2*e*r/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(na.call(this,t*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),ra.call(this,e*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)});function oa(t){this.object.isPerspectiveCamera?this._scale/=t:this.object.isOrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*t)),this.object.updateProjectionMatrix(),this._zoomChanged=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}function aa(t){this.object.isPerspectiveCamera?this._scale*=t:this.object.isOrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/t)),this.object.updateProjectionMatrix(),this._zoomChanged=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}function la(t){if(!1!==this.enabled)switch(t.preventDefault(),this._state){case Ko.ROTATE:if(!1===this.enableRotate)return;(function(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);var e=this.domElement===document?this.domElement.body:this.domElement;ta.call(this,2*Math.PI*this._rotateDelta.x/e.clientHeight),ea.call(this,2*Math.PI*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}).call(this,t);break;case Ko.DOLLY:if(!1===this.enableZoom)return;(function(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?oa.call(this,$o.call(this)):this._dollyDelta.y<0&&aa.call(this,$o.call(this)),this._dollyStart.copy(this._dollyEnd),this.update()}).call(this,t);break;case Ko.PAN:if(!1===this.enablePan)return;(function(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),sa.call(this,this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}).call(this,t)}}var ha=!1,ua=!1,ca=!1,da=!1,fa=null,pa=function(t){function e(t,i,n){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),s=r;return r.raycaster=new es,r.currMousePos=new Pe,r.camera=i,r.scene=t,r.target=null,r.domElement=void 0!==n?n:document,r._onMouseMovebind=s.onMouseMove.bind(s),r._onMousedownbind=s.onMousedown.bind(s),r._onMouseupbind=s.onMouseup.bind(s),r.domElement.addEventListener("mousemove",r._onMouseMovebind,!1),r.domElement.addEventListener("mousedown",r._onMousedownbind,!1),r.domElement.addEventListener("mouseup",r._onMouseupbind,!1),r}return _inherits(e,N),_createClass(e,[{key:"update",value:function(){if(ha){ha=!1,this.raycaster.setFromCamera(this.currMousePos,this.camera);var t=this.raycaster.intersectObjects(this.scene.children,!0);t.length>0?t[0].object==this.target?(this.target.fire({type:"mousemove",event:fa}),ua||(this.target.fire({type:"mouseover",event:fa}),ua=!0,ca=!1),da&&(this.target.fire({type:"click",event:fa}),da=!1)):(null===this.target||ca||(this.target.fire({type:"mouseout",event:fa}),ca=!0,ua=!1),this.target=t[0].object):null===this.target||ca||(this.target.fire({type:"mouseout"}),this.target=null,ca=!0,ua=!1)}}},{key:"dispose",value:function(){this.domElement.removeEventListener("mousedown",this._onMousedownbind,!1),this.domElement.removeEventListener("mouseup",this._onMouseupbind,!1),this.domElement.removeEventListener("mousemove",this._onMouseMovebind,!1),this._onMousedownbind=null,this._onMouseupbind=null,this._onMouseMovebind=null,ha=!1,ua=!1,ca=!1,da=!1,fa=null}},{key:"onMousedown",value:function(){fa=event}},{key:"onMouseup",value:function(){da=!0,ha=!0,this.fire({type:"click",event:event}),this.fire({type:"refresh"}),fa=event}},{key:"onMouseMove",value:function(t){t.preventDefault(),this.currMousePos.x=t.offsetX/this.domElement.clientWidth*2-1,this.currMousePos.y=-t.offsetY/this.domElement.clientHeight*2+1,this.fire({type:"move",event:t}),this.fire({type:"refresh"}),fa=t,ha=!0}}]),e}(),va=0,ya=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.domSelector=t.el,i.opt=t.opts,i.data=t.data,i.components=[],i.graphMap=t.graphs,i.componentMap=t.components,i.el=null,i.view=null,i.domView=null,i.stageView=null,i.canvasDom=null,i.width=0,i.height=0,i.renderer=null,i.renderView=null,i.app=null,i.currCoord=null,i._theme=Ho.colors.slice(0),i._createDomContainer(t.el),i._data=function(t){if(null==t&&(t=[]),t.length>0&&!Fs.isArray(t[0])){for(var e=[],i=[],n=0,r=0,s=t.length;r<s;r++){var o=t[r];if(0==r){for(var a in o)i.push(a);e.push(i),n=i.length}for(var l=[],h=0;h<n;h++)l.push(o[i[h]]);e.push(l)}return e}return t}(t.data),i.app=new Wo(i.width,i.height),i.renderer=i.app._framework.renderer,i.DefaultControls={autoRotate:!0,boxWidth:1e3,boxHeight:1e3,boxDepth:1e3,distance:1100,maxDistance:3e3,minDistance:600,minZoom:.2,maxZoom:1.5,alpha:40,beta:20,gamma:0},i.components=[],i.inited=!1,i.dataFrame=i._initData(i._data,t.opts),i.mainViewName="main_view",i.labelViewName="label_view",i.init(),i}return _inherits(e,N),_createClass(e,[{key:"init",value:function(){var t=ds.extend({},this.DefaultControls);this.opt.coord.controls=this.opt.coord.controls||{};var e=this.opt.coord.controls=ds.extend(t,this.opt.coord.controls);this._initRenderer(t);var i=this.orbitControls=new Jo(this.renderView._camera,this.view),n=this.interaction=new pa(this.rootStage,this.renderView._camera,this.view);i.minDistance=e.minDistance,i.maxDistance=e.maxDistance,i.minZoom=e.minZoom,i.maxZoom=e.maxZoom,i.enableDamping=!0,i.enablePan=!1,i.enableKeys=!1,i.autoRotate=e.autoRotate,i.autoRotateSpeed=1,i.on("start",ma),this._onChangeBind=function(t){this.app._framework.isUpdate=!0}.bind(this),i.on("change",this._onChangeBind),this._onRenderBeforeBind=function(){if(this.position0.equals(this.object.position)&&this.zoom0===this.object.zoom)return;this.saveState(),this.update()}.bind(i),this.app._framework.on("renderbefore",this._onRenderBeforeBind),this._onRenderAfterBind=function(){this.update()}.bind(n),this.app._framework.on("renderafter",this._onRenderAfterBind),n.on("refresh",this._onChangeBind),this.app.launch(),this._onWindowResizeBind=this.resize.bind(this),window.addEventListener("resize",this._onWindowResizeBind,!1),this.bindEvent()}},{key:"setCoord",value:function(t){this.currCoord=t,this.rootStage.add(this.currCoord.group)}},{key:"initComponent",value:function(){var t=this.opt;for(var e in t)if("coord"!=e){if("graphs"==e)for(var i=0;i<t.graphs.length;i++){var n=t.graphs[i].type;this.graphMap[n]&&this.addComponent(this.graphMap[n],t.graphs[i])}this.componentMap[e]&&this.addComponent(this.componentMap[e],t[e])}}},{key:"addComponent",value:function(t,e){if(t.prototype instanceof jo){var i=new t(this,e);this.components.push(i)}}},{key:"drawComponent",value:function(){var t=this;this.currCoord.drawUI(),this.components.forEach(function(e){t.currCoord.group.add(e.group),e.draw()})}},{key:"draw",value:function(){this.currCoord.initCoordUI(),this.drawComponent(),this.app._framework.isUpdate=!0}},{key:"getComponent",value:function(t){var e=null;return this.components.forEach(function(i){i.constructor.name==t&&(e=i)}),e}},{key:"bindEvent",value:function(){var t=this;this.on("tipShow",function(e){var i=t.getComponent("Tips3d"),n=e.event,r=n.offsetX,s=n.offsetY;null!==i&&i.show({eventInfo:e.data,pos:{x:r,y:s}})}),this.on("tipHide",function(e){var i=t.getComponent("Tips3d");null!==i&&i.hide()}),this.on("tipMove",function(e){var i=t.getComponent("Tips3d"),n=e.event,r=n.offsetX,s=n.offsetY;null!==i&&i.show({eventInfo:e.data,pos:{x:r,y:s}})})}},{key:"_createDomContainer",value:function(t){var e;this._cid="chartx3d_"+va++,this.el=lo(t),this.width=this.el.offsetWidth,this.height=this.el.offsetHeight,e=ho(this.width,this.height,this._cid),this.view=e.view,this.stageView=e.stageView,this.domView=e.domView,this.el.innerHTML="",this.el.appendChild(this.view),this.id="chartx_"+this._cid,this.el.setAttribute("chart_id",this.id),this.el.setAttribute("chartx3d_version","1.0")}},{key:"_initData",value:function(t,e){return Ns.call(this,t,e)}},{key:"_initRenderer",value:function(t){var e=this.app,i=null,n=null;e.createView(this.mainViewName),e.createView(this.labelViewName),i=this.renderView=e.getView(this.mainViewName),n=this.labelView=e.getView(this.labelViewName),this.rootStage=e.addGroup({name:"rootStage"}),i.addObject(this.rootStage),i.setSize(this.width,this.height),i.setBackground(16777215),i.setControls(t),i.project("perspective"),this.labelGroup=e.addGroup({name:"labelsGroup"});var r=this.labelGroup.matrix.elements;r[1]=-r[1],r[5]=-r[5],r[9]=-r[9],r[13]=-r[13],this.labelGroup.matrixAutoUpdate=!1,n.addObject(this.labelGroup),n.setSize(this.width,this.height),n.setControls(t),n.createScreenProject(),this.stageView.appendChild(this.renderer.domElement),this.canvasDom=this.renderer.domElement}},{key:"resize",value:function(){this.width=this.el.offsetWidth,this.height=this.el.offsetHeight,this.renderView.resize(this.width,this.height,this.opt.coord.controls.boxHeight)}},{key:"getTheme",value:function(t){var e=this._theme;return null!=t?e[t%e.length]:e}},{key:"reset",value:function(){}},{key:"resetData",value:function(){}},{key:"dispose",value:function(){this.currCoord.dispose(),this.components.forEach(function(t){t.dispose()}),this.renderer._state.reset(),this.renderer.dispose(),this.orbitControls.off("start",ma),this.orbitControls.off("change",this._onChangeBind),this.app._framework.off("renderbefore",this._onRenderBeforeBind),this._onRenderBeforeBind=null,this.app._framework.off("renderafter",this._onRenderAfterBind),this._onRenderAfterBind=null,this.interaction.off("refresh",this._onChangeBind),this._onChangeBind=null,window.removeEventListener("resize",this._onWindowResizeBind,!1),this._onWindowResizeBind=null,this.interaction.dispose(),this.orbitControls.dispose(),this.app.dispose()}}]),e}();function ma(){this.autoRotate=!1}var ga=function(t){function e(t,i,n,r,s){_classCallCheck(this,e);var o=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));o.coord={},o.origin=new Rt(0,0,0),o.center=new Rt(0,0,0),o.padding={left:0,top:0,right:0,bottom:0,front:0,back:0};var a=o._root=new ya({el:t,data:i,opts:n,graphs:r,components:s});return o.group=a.app.addGroup({name:"InertialSystem"}),a.setCoord(o),ds.extend(!0,o,o.setDefaultOpts(n)),o.id=a.id,o.destroy=function(){a.dispose(),o.fire({type:"destroy"})},o}return _inherits(e,N),_createClass(e,[{key:"setDefaultOpts",value:function(t){return t}},{key:"getBoundbox",value:function(){var t=new Xt,e=this._root.opt.coord.controls,i="ortho"==this._root.renderView.mode?.8*e.boxHeight:e.boxHeight,n=e.boxWidth,r=e.boxDepth,s=e.distance||new Rt(n,0,r).length(),o=this._root.renderView.getVisableSize(new Rt(0,0,-s)).ratio,a=.5*-n+this.padding.left*o,l=.5*-i+this.padding.bottom*o,h=this.padding.front-.5*s-r,u=.5*n-this.padding.right*o,c=.5*i-this.padding.top*o,d=.5*-s+this.padding.back;return t.min.set(a,l,h),t.max.set(u,c,d),t}},{key:"_getWorldPos",value:function(t){var e=t.clone();return this.group.updateMatrixWorld(),e.applyMatrix4(this.group.matrixWorld),e}},{key:"dataToPoint",value:function(t,e){}},{key:"pointToData",value:function(){}},{key:"initCoordUI",value:function(){return null}},{key:"drawUI",value:function(){this._root.initComponent()}},{key:"draw",value:function(){this._root.draw()}},{key:"dispose",value:function(){}}]),e}(),_a=function(t){function e(t,i){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.origin=new Rt(0,0,0),n.dir=new Rt(1,0,0),n.length=1,n.lineWidth=i.lineWidth||2,n.color=i.strokeStyle,n.axis=null,n.group.visible=!!i.enabled,n}return _inherits(e,jo),_createClass(e,[{key:"defaultStyle",value:function(){}},{key:"setStyle",value:function(){}},{key:"setOrigin",value:function(t){this.origin.copy(t)}},{key:"getOrigin",value:function(){return this.origin.clone()}},{key:"setDir",value:function(t){this.dir.copy(t)}},{key:"setLength",value:function(t){this.length=t}},{key:"setGroupName",value:function(t){this.group.name=t}},{key:"drawStart",value:function(){this.axis=this._root.app.createLine(this.origin,this.dir,this.length,this.lineWidth,this.color)}},{key:"update",value:function(){var t=this.getOrigin();this.axis.traverse(function(e){e.isLine2&&e.position.copy(t)})}},{key:"draw",value:function(){this.group.add(this.axis)}},{key:"dispose",value:function(){var t=[];for(this.group.traverse(function(e){e.isLine2&&(e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose(),t.push(e))});t.length;){var e=t.pop();e.parent.remove(e)}}}]),e}(),xa=function(t){function e(t,i){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.origins=[],n.dir=new Rt,n.lineWidth=i.lineWidth,n.length=i.lineLength,n.color=i.strokeStyle,n.offset=i.offset,n._tickLine=null,n.group.visible=!!i.enabled,n}return _inherits(e,jo),_createClass(e,[{key:"initData",value:function(t,e,i){var n=this,r=this,s=(new Rt).copy(r.dir).multiplyScalar(this._offset);this.origins=[],e.getSection().forEach(function(o,a){var l=i.call(n._coordSystem,o,e),h=t.dir.clone().multiplyScalar(l);h.add(t.origin),h.add(s),r.origins.push(h)})}},{key:"setDir",value:function(t){this.dir=t}},{key:"drawStart",value:function(){this._tickLine=this._root.app.createLine(this.origins,this.dir,this._length,this.lineWidth,this.color)}},{key:"update",value:function(){var t=this.origins,e=[],i=null,n=this.dir.clone(),r=this._length,s=0;this._tickLine.traverse(function(o){o.isLine2&&((e=[]).push([0,0,0]),(i=new Rt).copy(n),i.multiplyScalar(r),e.push(i.toArray()),o.geometry.setPositions(ds.flatten(e)),o.position.copy(t[s]),s++)})}},{key:"draw",value:function(){this.group.add(this._tickLine)}},{key:"dispose",value:function(){var t=[];for(this.group.traverse(function(e){e.isLine2&&(e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose(),t.push(e))});t.length;){var e=t.pop();e.parent.remove(e)}}},{key:"length",set:function(t){this._length=t},get:function(){return this._length}},{key:"offset",set:function(t){this._offset=t},get:function(){return this._offset}}]),e}(),ba=function(t){function e(t,i){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.origins=[],n.texts=[],n.fontColor=i.fontColor||"#333",n.fontSize=i.fontSize||12,n.rotation=0,n.origin=null,n.textAlign=i.textAlign,n.verticalAlign=i.verticalAlign,n.dir=new Rt,n.offset=new(Function.prototype.bind.apply(Rt,[null].concat(_toConsumableArray(Object.values(i.offset)))))||new Rt,n._tickTextGroup=null,n._tickTextGroup=n._root.app.addGroup({name:"tickTexts"}),n.group.visible=!!i.enabled,n.group.add(n._tickTextGroup),n}return _inherits(e,jo),_createClass(e,[{key:"initData",value:function(t,e,i){var n=this,r=this,s=(r.dir.clone(),this.offset);r.origins=[],e.getSection().forEach(function(o,a){var l=i.call(n._coordSystem,o,e),h=t.dir.clone().multiplyScalar(l);h.add(t.origin),h.add(s),r.origins.push(h)}),r.updataOrigins=this._updataOrigins(t,e,i)}},{key:"setDir",value:function(t){this.dir=t}},{key:"setTextAlign",value:function(t){this.textAlign=t}},{key:"setVerticalAlign",value:function(t){this.verticalAlign=t}},{key:"_updataOrigins",value:function(t,e,i){var n=t,r=e,s=i;return function(){this.initData(n,r,s)}}},{key:"getTextPos",value:function(t){var e=ds.indexOf(this.texts,t);return-1!=e?this.origins[e]:null}},{key:"drawStart",value:function(t){var e=this,i=e._root.app;t=t||[];var n=e.fontSize,r=e.fontColor,s=new Rt(0,0,-1);this.texts=t,i.creatSpriteText(t,{fontSize:n,color:r}).forEach(function(t,i){t.userData.position=e.origins[i].clone(),t.matrixWorldNeedsUpdate=!1,t.onBeforeRender=function(i,n,r){e.updataOrigins();var o=e._coordSystem.positionToScreen(e.getTextPos(this.userData.text).clone()),a=this.userData.size,l=.5*a[0],h=.5*a[1],u=new Rt;r.getWorldDirection(u);var c=s.dot(u);if("right"==e.textAlign){var d=c<0?1:-1;o.setX(o.x+l*d),t.position.copy(o)}if("left"==e.textAlign){var f=c<0?-1:1;o.setX(o.x+l*f),t.position.copy(o)}"top"==e.verticalAlign&&(o.setY(o.y-h),t.position.copy(o)),"bottom"==e.verticalAlign&&(o.setY(o.y+h),t.position.copy(o)),this.position.copy(o),this.updateMatrixWorld(!0)},e._tickTextGroup.add(t)})}},{key:"draw",value:function(){this.group.add(this._tickTextGroup)}},{key:"update",value:function(){}},{key:"dispose",value:function(){var t=[];for(this.group.traverse(function(e){e.isTextSprite&&(e.geometry&&e.geometry.dispose(),e.material&&(e.material.dispose(),e.material.map&&e.material.map.dispose()),t.push(e))});t.length;){var e=t.pop();e.parent.remove(e)}}}]),e}(),wa=function(t){function e(t,i){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t._coordSystem));return n._opt=i,n._coord=n._coordSystem.coord||{},n._cartesionUI=t,n.name=i.name,n.field=i.field||[],n.title={content:"",shapeType:"text",fontColor:"#999",fontSize:12,offset:2,textAlign:"center",textBaseline:"middle",strokeStyle:null,lineHeight:0},n._title=null,n.enabled=!0,n.tickLine={enabled:1,lineWidth:1,lineLength:20,strokeStyle:"#333",offset:0},n.axisLine={enabled:1,lineWidth:1,strokeStyle:"#333"},n.label={enabled:1,fontColor:"#333",fontSize:12,format:null,rotation:0,textAlign:"right",verticalAlign:"middle",lineHeight:1,offset:{x:0,y:0,z:40}},n.origin=new Rt,n.boundboxSize=new Rt,n.yAxisAttribute=n._coordSystem.yAxisAttribute[n.name],ds.extend(!0,n,i),n.init(i),n.group.visible=!!n.enabled,n._getName(),n}return _inherits(e,jo),_createClass(e,[{key:"init",value:function(t){var e=this;ds.isArray(this.field)||(this.field=[this.field]),this._initData(this.yAxisAttribute),this.getOrigin(),this._onChangeBind=function(){e._initModules()},this._root.orbitControls.on("change",this._onChangeBind),e._initModules()}},{key:"_initModules",value:function(){if(this.enabled){var t=new Rt(0,1,0),e=this._coordSystem,i=e.getBoundbox(),n=this.boundboxSize,r=n.x,s=n.z,o=this.origin.clone(),a=new Rt(0,0,1),l=this._cartesionUI.getFaceInfo(),h=this.label.textAlign,u=this.label.offset.z+this.axisLine.lineWidth+this.tickLine.lineLength+this.tickLine.offset;if(l.left.visible?l.back.visible?(a=new Rt(0,0,1),h="right"):(1==e.coord.yAxis.length&&(o=new Rt(0,0,-s)),a=new Rt(0,0,-1),h="left",u*=-1):l.back.visible?(o.setX(r),a=new Rt(0,0,1),h="left"):(o.setX(r),1==e.coord.yAxis.length&&(o=new Rt(r,0,-s)),a=new Rt(0,0,-1),h="right",u*=-1),this._axisLine){if(this._axisLine.getOrigin().equals(o))return;this._axisLine.setOrigin(o),this._axisLine.update(),this._tickLine.setDir(a),this._tickLine.initData(this._axisLine,this.yAxisAttribute,e.getYAxisPosition),this._tickLine.update(),this._tickText.setDir(a),this._tickText.initData(this._axisLine,this.yAxisAttribute,e.getYAxisPosition),this._tickText.setTextAlign(h),this._tickText.offset.setZ(u)}else this._axisLine=new _a(e,this.axisLine),this._axisLine.setDir(t),this._axisLine.setOrigin(o),this._axisLine.setLength(i.max.y),this._axisLine.setGroupName("yAxisLine"),this._axisLine.drawStart(),this.group.add(this._axisLine.group),this._tickLine=new xa(e,this.tickLine),this._tickLine.setDir(a),this._tickLine.initData(this._axisLine,this.yAxisAttribute,e.getYAxisPosition),this._tickLine.drawStart(),this.group.add(this._tickLine.group),this._tickText=new ba(e,this.label),this._tickText.offset.z=u,this._tickText.setTextAlign(h),this._tickText.setDir(a),this._tickText.initData(this._axisLine,this.yAxisAttribute,e.getYAxisPosition),this._tickText.drawStart(this._formatTextSection),this._root.labelGroup.add(this._tickText.group)}}},{key:"getOrigin",value:function(){var t=this._coordSystem,e=t.getBoundbox(),i=new Rt;e.getSize(i),this.boundboxSize=i.clone();var n=i.z,r=t.getOrigin(),s=t.coord.yAxis.length,o=ds.indexOf(t.coord.yAxis,this._opt),a=0;a=1==s?0:o/(s-1),r.setZ(n*-a),this.origin=r}},{key:"updateAxis",value:function(){}},{key:"_getName",value:function(){}},{key:"_initData",value:function(t){var e=this;this.dataSection=t.getSection(),e._formatTextSection=[],e._textElements=[],ds.each(e.dataSection,function(t,i){e._formatTextSection[i]=e._getFormatText(t,i)}),0!=this.label.rotation&&(this.label.textAlign="right"),!("minVal"in this._opt)&&(this.minVal=ds.min(this.dataSection)),(isNaN(this.minVal)||this.minVal==1/0)&&(this.minVal=0),!("maxVal"in this._opt)&&(this.maxVal=ds.max(this.dataSection)),(isNaN(this.maxVal)||this.maxVal==1/0)&&(this.maxVal=1),this._getName()}},{key:"_getFormatText",value:function(t,e){var i;return i=ds.isFunction(this.label.format)?this.label.format.apply(this,arguments):t,ds.isArray(i)&&(i=uo(i)),i||(i=t),i}},{key:"setLayout",value:function(t){}},{key:"draw",value:function(){this.enabled&&(this._axisLine.draw(),this._tickLine.draw(),this._tickText.draw())}},{key:"getBoundbox",value:function(){var t=new Xt,e=this.axisLine.getBoundBox(),i=this.tickLine.getBoundBox(),n=this.tickText.getBoundBox();return t.union(e),t.union(i),t.union(n),t}},{key:"dispose",value:function(){this._axisLine.dispose(),this._tickLine.dispose(),this._tickText.dispose(),this._root.orbitControls.off("change",this._onChangeBind),this._onChangeBind=null}}]),e}(),ka=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t._coordSystem)),n=i._opt=i._coordSystem.coord.xAxis;return i._cartesionUI=t,i.width=0,i.height=0,i.title={content:"",shapeType:"text",fontColor:"#999",fontSize:12,offset:2,textAlign:"center",textBaseline:"middle",strokeStyle:null,lineHeight:0},i._title=null,i.enabled=!0,i.axisLine={enabled:1,lineWidth:1,strokeStyle:"#333"},i.tickLine={enabled:1,lineWidth:1,lineLength:20,strokeStyle:"#333",offset:0},i.label={enabled:1,fontColor:"#333",fontSize:12,rotation:0,format:null,offset:{x:20,y:0,z:40},textAlign:"center",verticalAlign:"bottom",lineHeight:1,evade:!0},!n.isH||n.label&&void 0!==n.label.rotaion||(i.label.rotation=90),i.maxTxtH=0,i.pos={x:0,y:0},i.dataSection=[],i.layoutData=[],i.sprite=null,i.filter=null,i.isH=!1,i.animation=!1,i.maxVal=null,i.minVal=null,i.ceilWidth=0,i.layoutType="rule",i.trimLayout=null,i.posParseToInt=!1,ds.extend(!0,i,n.xAxis),i.init(n,i._coordSystem.xAxisAttribute),i.group.visible=!!i.enabled,i}return _inherits(e,jo),_createClass(e,[{key:"init",value:function(t,e){var i=this;this._initHandle(e),this._onChangeBind=function(){i._initModules()},this._root.orbitControls.on("change",this._onChangeBind),i._initModules()}},{key:"_initHandle",value:function(t){var e=this;t&&t.field&&(this.field=t.field),this.dataSection=t.getSection(),e._formatTextSection=[],e._textElements=[],ds.each(e.dataSection,function(t,i){e._formatTextSection[i]=e._getFormatText(t,i)}),0!=this.label.rotation&&(this.label.textAlign="right"),!("minVal"in this._opt)&&(this.minVal=ds.min(this.dataSection)),(isNaN(this.minVal)||this.minVal==1/0)&&(this.minVal=0),!("maxVal"in this._opt)&&(this.maxVal=ds.max(this.dataSection)),(isNaN(this.maxVal)||this.maxVal==1/0)&&(this.maxVal=1),this._getName(),this._setXAxisHeight()}},{key:"_getFormatText",value:function(t,e){var i;return i=ds.isFunction(this.label.format)?this.label.format.apply(this,arguments):t,ds.isArray(i)&&(i=uo(i)),i||(i=t),i}},{key:"_initModules",value:function(){var t=new Rt(1,0,0),e=this._coordSystem,i=e.getBoundbox(),n=new Rt;i.getSize(n);n.x;var r=n.y,s=n.z,o=e.getOrigin(),a=new Rt(0,0,1),l=this._cartesionUI.getFaceInfo(),h=this.label.verticalAlign,u=this.label.offset.z+this.axisLine.lineWidth+this.tickLine.lineLength+this.tickLine.offset;if(l.bottom.visible?(l.back.visible?(o=e.getOrigin(),a=new Rt(0,0,1)):(o=new Rt(0,0,-s),a=new Rt(0,0,-1),u*=-1),h="bottom"):(l.back.visible?(o=new Rt(0,r,0),a=new Rt(0,0,1)):(o=new Rt(0,r,-s),a=new Rt(0,0,-1),u*=-1),h="top"),this._axisLine){if(this._axisLine.getOrigin().equals(o))return;this._axisLine.setOrigin(o),this._axisLine.update(),this._tickLine.setDir(a),this._tickLine.initData(this._axisLine,e.xAxisAttribute,e.getXAxisPosition),this._tickLine.update(),this._tickText.setDir(a),this._tickText.offset.setZ(u),this._tickText.initData(this._axisLine,e.xAxisAttribute,e.getXAxisPosition),this._tickText.setVerticalAlign(h)}else this._axisLine=new _a(e,this.axisLine),this._axisLine.setDir(t),this._axisLine.setOrigin(o),this._axisLine.setLength(i.max.x),this._axisLine.setGroupName("xAxisLine"),this._axisLine.drawStart(),this.group.add(this._axisLine.group),this._tickLine=new xa(e,this.tickLine),this._tickLine.setDir(a),this._tickLine.initData(this._axisLine,e.xAxisAttribute,e.getXAxisPosition),this._tickLine.drawStart(),this.group.add(this._tickLine.group),this._tickText=new ba(e,this.label),this._tickText.offset.z+=this.axisLine.lineWidth+this.tickLine.lineWidth+this.tickLine.offset,this._tickText.setVerticalAlign(h),this._tickText.setDir(a),this._tickText.initData(this._axisLine,e.xAxisAttribute,e.getXAxisPosition),this._tickText.drawStart(this._formatTextSection),this._root.labelGroup.add(this._tickText.group)}},{key:"_getName",value:function(){}},{key:"updateAxis",value:function(){}},{key:"_setXAxisHeight",value:function(){var t=this._coordSystem;if(this.enabled){var e=0;if(this.label.enabled){var i=1.2*this.label.fontSize;e=Math.max(e,i)}var n=t.getRatioPixelToWorldByOrigin();this.height=(e+this.tickLine.lineLength+this.tickLine.offset+this.label.offset+this.axisLine.lineWidth)*n,this._maxTextHeight=e}else this.height=0}},{key:"setLayout",value:function(t){}},{key:"draw",value:function(){this._axisLine.draw(),this._tickLine.draw(),this._tickText.draw()}},{key:"dispose",value:function(){this._axisLine.dispose(),this._tickLine.dispose(),this._tickText.dispose(),this._root.orbitControls.off("change",this._onChangeBind),this._onChangeBind=null}}]),e}(),Sa=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t._coordSystem)),n=i._opt=i._coordSystem.coord.zAxis;return i._cartesionUI=t,i._coord=i._coordSystem.coord||{},i.width=0,i.height=0,i.title={content:"",shapeType:"text",fontColor:"#999",fontSize:12,offset:2,textAlign:"center",textBaseline:"middle",strokeStyle:null,lineHeight:0},i._title=null,i.enabled=!0,i.tickLine={enabled:1,lineWidth:1,lineLength:20,strokeStyle:"#333",offset:0},i.axisLine={enabled:1,lineWidth:1,strokeStyle:"#333"},i.label={enabled:1,fontColor:"#333",fontSize:12,rotation:0,format:null,offset:{x:40,y:0,z:0},textAlign:"left",verticalAlign:"middle",lineHeight:1},!n.isH||n.label&&void 0!==n.label.rotaion||(i.label.rotation=90),i.maxTxtH=0,i.pos={x:0,y:0},i.dataSection=[],i.layoutData=[],i.sprite=null,i.filter=null,i.isH=!1,i.animation=!1,i.maxVal=null,i.minVal=null,i.ceilWidth=0,i.layoutType="peak",i.trimLayout=null,i.posParseToInt=!1,ds.extend(!0,i,n.zAxis),i.init(n,i._coordSystem.zAxisAttribute),i.group.visible=!!i.enabled,i}return _inherits(e,jo),_createClass(e,[{key:"init",value:function(t,e){var i=this;this._initHandle(e),this._onChangeBind=function(){i._initModules()},this._root.orbitControls.on("change",this._onChangeBind),i._initModules()}},{key:"_initHandle",value:function(t){var e=this;t&&t.field&&(this.field=t.field),this.dataSection=t.getSection(),e._formatTextSection=[],e._textElements=[],ds.each(e.dataSection,function(t,i){e._formatTextSection[i]=e._getFormatText(t,i)}),0!=this.label.rotation&&(this.label.textAlign="right"),!("minVal"in this._opt)&&(this.minVal=ds.min(this.dataSection)),(isNaN(this.minVal)||this.minVal==1/0)&&(this.minVal=0),!("maxVal"in this._opt)&&(this.maxVal=ds.max(this.dataSection)),(isNaN(this.maxVal)||this.maxVal==1/0)&&(this.maxVal=1),this._getName(),this._setZAxisWidth()}},{key:"_getFormatText",value:function(t,e){var i;return i=ds.isFunction(this.label.format)?this.label.format.apply(this,arguments):t,ds.isArray(i)&&(i=uo(i)),i||(i=t),i}},{key:"_initModules",value:function(){var t=new Rt(0,0,-1),e=this._coordSystem,i=e.getBoundbox(),n=new Rt;i.getSize(n);var r=n.x,s=n.y,o=n.z,a=new Rt(r,0,0),l=new Rt(1,0,0),h=this._cartesionUI.getFaceInfo(),u=this.label.textAlign,c=this.label.offset.x+this.axisLine.lineWidth+this.tickLine.lineLength+this.tickLine.offset;if(h.bottom.visible?(h.left.visible?(a=new Rt(r,0,0),l=new Rt(1,0,0)):(a=new Rt(0,0,0),l=new Rt(-1,0,0)),h.front.visible?h.left.visible?u="right":(u="left",c=-c):h.left.visible?u="left":(u="right",c=-c)):(h.left.visible?(a=new Rt(r,s,0),l=new Rt(1,0,0)):(a=new Rt(0,s,0),l=new Rt(-1,0,0)),h.front.visible?h.left.visible?u="right":(u="left",c=-c):h.left.visible?u="left":(u="right",c=-c)),this._axisLine){if(this._axisLine.getOrigin().equals(a))return;this._axisLine.setOrigin(a),this._axisLine.update(),this._tickLine.setDir(l),this._tickLine.initData(this._axisLine,e.zAxisAttribute,e.getZAxisPosition),this._tickLine.update(),this._tickText.setDir(l),this._tickText.initData(this._axisLine,e.zAxisAttribute,e.getZAxisPosition),this._tickText.setTextAlign(u),this._tickText.offset.setX(c)}else this._axisLine=new _a(e,this.axisLine),this._axisLine.setDir(t),this._axisLine.setOrigin(a),this._axisLine.setLength(o),this._axisLine.setGroupName("zAxisLine"),this._axisLine.drawStart(),this.group.add(this._axisLine.group),this._tickLine=new xa(e,this.tickLine),this._tickLine.setDir(l),this._tickLine.initData(this._axisLine,e.zAxisAttribute,e.getZAxisPosition),this._tickLine.drawStart(),this.group.add(this._tickLine.group),this._tickText=new ba(e,this.label),this._tickText.offset.x=c,this._tickText.setDir(l),this._tickText.initData(this._axisLine,e.zAxisAttribute,e.getZAxisPosition),this._tickText.drawStart(this._formatTextSection),this._root.labelGroup.add(this._tickText.group)}},{key:"_getName",value:function(){}},{key:"_setZAxisWidth",value:function(){var t=this._coordSystem;if(this.enabled){var e=0;if(this.label.enabled){var i=Dr.getTextWidth(this._formatTextSection,["normal","normal",this.label.fontColor,this.label.fontSize].join(" "));e=Math.max(e,i)}this._maxTextWidth=e;var n=t.getRatioPixelToWorldByOrigin();this.width=(e+this.tickLine.lineLength+this.tickLine.offset+this.label.offset+this.axisLine.lineWidth)*n}else this.width=0}},{key:"setLayout",value:function(t){}},{key:"draw",value:function(){this._axisLine.draw(),this._tickLine.draw(),this._tickText.draw()}},{key:"dispose",value:function(){this._axisLine.dispose(),this._tickLine.dispose(),this._tickText.dispose(),this._root.orbitControls.off("change",this._onChangeBind),this._onChangeBind=null}}]),e}(),Ca=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t._coordSystem)),n=i._opt=i._coordSystem.coord.grid;return i.coord=i._coordSystem.coord,i._cartesionUI=t,i.enabled=!0,i.line={enabled:!0,lineType:"solid",strokeStyle:"#e5e5e5"},i.fill={enabled:!1,fillStyle:"#ccc",alpha:.1},ds.extend(!0,i,n),i.init(),i}return _inherits(e,jo),_createClass(e,[{key:"init",value:function(){var t=this,e=this._root.app;this.leftGroup=e.addGroup({name:"leftGroup"}),this.rightGroup=e.addGroup({name:"rightGroup"}),this.topGroup=e.addGroup({name:"topGroup"}),this.bottomGroup=e.addGroup({name:"bottomGroup"}),this.frontGroup=e.addGroup({name:"frontGroup"}),this.backGroup=e.addGroup({name:"backGroup"}),this.group.add(this.leftGroup),this.group.add(this.rightGroup),this.group.add(this.topGroup),this.group.add(this.bottomGroup),this.group.add(this.frontGroup),this.group.add(this.backGroup),this.group.renderOrder=-1,this._onChangeBind=function(){if(t.enabled){var e=t._cartesionUI.getFaceInfo();ds.each(e,function(e,i){t[i+"Group"].visible=e.visible})}},this._root.orbitControls.on("change",this._onChangeBind)}},{key:"drawFace",value:function(){var t=this,e=t._root.app;if(t.enabled){var i=this._coordSystem,n=this._cartesionUI.getFaceInfo(),r=i.getBoundbox(),s=new Rt;r.getSize(s);var o=s.x,a=s.y,l=s.z;t.fill.enabled&&(this.leftFace=e.createPlane(l,a,void 0,n.left,t.leftGroup,this.fill),this.rightFace=e.createPlane(l,a,void 0,n.right,t.rightGroup,this.fill),this.topFace=e.createPlane(o,l,void 0,n.top,t.topGroup,this.fill),this.bottomFace=e.createPlane(o,l,void 0,n.bottom,t.bottomGroup,this.fill),this.frontFace=e.createPlane(o,a,void 0,n.front,t.frontGroup,this.fill),this.backFace=e.createPlane(o,a,void 0,n.back,t.backGroup,this.fill))}}},{key:"drawLine",value:function(){var t=this,e=t._root.app;if(t.enabled){var i=this._coordSystem.getBoundbox(),n=new Rt;i.getSize(n);var r=n.x,s=n.y,o=n.z,a=t._coordSystem.xAxisAttribute.getSection(),l=t._coordSystem.getYAxis().attr,h=l.getSection(),u=t._coordSystem.zAxisAttribute.getSection();if(t.line.enabled){var c=[];h.forEach(function(e){var i=t._coordSystem.getYAxisPosition(e,l);c.push(new Rt(0,i,0)),c.push(new Rt(0,i,-o))}),u.forEach(function(e){var i=t._coordSystem.getZAxisPosition(e);c.push(new Rt(0,0,-i)),c.push(new Rt(0,s,-i))});var d=e.createCommonLine(c,this.line);t.leftGroup.add(d),c=[],h.forEach(function(e){var i=t._coordSystem.getYAxisPosition(e,l);c.push(new Rt(r,i,0)),c.push(new Rt(r,i,-o))}),u.forEach(function(e){var i=t._coordSystem.getZAxisPosition(e);c.push(new Rt(r,0,-i)),c.push(new Rt(r,s,-i))}),d=e.createCommonLine(c,this.line),t.rightGroup.add(d),c=[],a.forEach(function(e){var i=t._coordSystem.getXAxisPosition(e);c.push(new Rt(i,s,0)),c.push(new Rt(i,s,-o))}),u.forEach(function(e){var i=t._coordSystem.getZAxisPosition(e);c.push(new Rt(0,s,-i)),c.push(new Rt(r,s,-i))}),d=e.createCommonLine(c,this.line),t.topGroup.add(d),c=[],a.forEach(function(e){var i=t._coordSystem.getXAxisPosition(e);c.push(new Rt(i,0,0)),c.push(new Rt(i,0,-o))}),u.forEach(function(e){var i=t._coordSystem.getZAxisPosition(e);c.push(new Rt(0,0,-i)),c.push(new Rt(r,0,-i))}),d=e.createCommonLine(c,this.line),t.bottomGroup.add(d),c=[],a.forEach(function(e){var i=t._coordSystem.getXAxisPosition(e);c.push(new Rt(i,0,0)),c.push(new Rt(i,s,0))}),h.forEach(function(e){var i=t._coordSystem.getYAxisPosition(e,l);c.push(new Rt(0,i,0)),c.push(new Rt(r,i,0))}),d=e.createCommonLine(c,this.line),t.frontGroup.add(d),c=[],a.forEach(function(e){var i=t._coordSystem.getXAxisPosition(e);c.push(new Rt(i,0,-o)),c.push(new Rt(i,s,-o))}),h.forEach(function(e){var i=t._coordSystem.getYAxisPosition(e,l);c.push(new Rt(0,i,-o)),c.push(new Rt(r,i,-o))}),d=e.createCommonLine(c,this.line),t.backGroup.add(d)}}}},{key:"draw",value:function(){this.drawFace(),this.drawLine()}},{key:"dispose",value:function(){_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"dispose",this).call(this),this._root.orbitControls.off("change",this._onChangeBind),this._onChangeBind=null}}]),e}(),Aa=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));i._xAxis=null,i._yAxis=[],i._zAxis=null,i._grid=null;var n=t.coord;return i.type="cartesian3d",i.horizontal=!1,i.xAxis=n.xAxis||{},i.yAxis=n.yAxis||[],i.zAxis=n.zAxis||{},i.grid=n.grid||{},ds.extend(!0,i,n),n.horizontal&&(i.xAxis.isH=!0,i.zAxis.isH=!0,ds.each(i.yAxis,function(t){t.isH=!0})),"enabled"in n&&(ds.extend(!0,i.xAxis,{enabled:n.enabled}),ds.each(i.yAxis,function(t){ds.extend(!0,t,{enabled:n.enabled})}),ds.extend(!0,i.zAxis,{enabled:n.enabled}),i.grid.enabled=n.enabled),i.init(n),i}return _inherits(e,jo),_createClass(e,[{key:"init",value:function(t){this.yAxisGroup=this._root.app.addGroup({name:"yAxisGroup"}),this._initModules(),this._coordSystem.updateOrigin(new Rt(0,0,0))}},{key:"_initModules",value:function(){var t=this;this._grid=new Ca(this),this.group.add(this._grid.group),this._xAxis=new ka(this),this.group.add(this._xAxis.group),this._zAxis=new Sa(this),this.group.add(this._zAxis.group),this.yAxis.forEach(function(e){var i=new wa(t,e);t._yAxis.push(i),t.yAxisGroup.add(i.group)}),this.group.add(this.yAxisGroup)}},{key:"draw",value:function(){this._yAxis.forEach(function(t){t.draw()}),this._xAxis.draw(),this._zAxis.draw(),this._grid.draw()}},{key:"getFaceInfo",value:function(){var t=this._coordSystem.getBoundbox(),e=new Rt;t.getSize(e);var i=e.x,n=e.y,r=e.z,s=new Rt(0,0,0),o=new Rt(0,n,0),a=new Rt(0,0,-r),l=new Rt(0,n,-r),h=new Rt(i,0,0),u=new Rt(i,n,0),c=new Rt(i,0,-r),d=new Rt(i,n,-r),f=new Rt(0,0,1),p=this._coordSystem._getWorldPos(this._coordSystem.center).clone();return this._root.renderView._camera.getWorldPosition(p),{left:{dir:new Rt(1,0,0),center:(new Xt).setFromPoints([o,o,a,l]).getCenter(),visible:p.clone().cross(f).y<=0},right:{dir:new Rt(-1,0,0),center:(new Xt).setFromPoints([u,u,c,d]).getCenter(),visible:p.clone().cross(f).y>0},top:{dir:new Rt(0,-1,0),center:(new Xt).setFromPoints([o,u,l,d]).getCenter(),visible:p.clone().cross(f).x<0},bottom:{dir:new Rt(0,1,0),center:(new Xt).setFromPoints([s,h,a,c]).getCenter(),visible:p.clone().cross(f).x>=0},front:{dir:new Rt(0,0,-1),center:(new Xt).setFromPoints([s,h,u,o]).getCenter(),visible:p.dot(f)<0},back:{dir:new Rt(0,0,1),center:(new Xt).setFromPoints([a,c,d,l]).getCenter(),visible:p.dot(f)>=0}}}},{key:"dispose",value:function(){this._yAxis.forEach(function(t){t.dispose()}),this._xAxis.dispose(),this._zAxis.dispose(),this._grid.dispose()}}]),e}(),La=function(){function t(e){_classCallCheck(this,t),this._root=e,this.field="",this.data=null,this._section=[],this._userSection=[],this.colors=[],this._colorMap={}}return _createClass(t,[{key:"setField",value:function(t){this.field=t,this.data=this.getAxisDataFrame(this.field)}},{key:"setColors",value:function(t){var e=this,i=ds.flatten(this.field);this.colors=[],this._colorMap={},i.forEach(function(i,n){var r=t[i];r&&(e.colors.push(r),e._colorMap[i]=r)}),this.colors.forEach(function(t,i){e._userSection[i]&&(e._colorMap[e._userSection[i]]=t)})}},{key:"getColor",value:function(t){return this._colorMap[t]}},{key:"setData",value:function(t){this.data=t}},{key:"getData",value:function(t){return this.getAxisDataFrame(t)}},{key:"setOrgSection",value:function(t){this._section=t}},{key:"setCustomSection",value:function(t){this._userSection=t}},{key:"getSection",value:function(){return this._userSection.length?this._userSection:this._section}},{key:"getOrgSection",value:function(){return this._section}},{key:"getCustomSection",value:function(){return this._userSection}},{key:"computeDataSection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this._setDataSection(this.field);t=t.concat(e);for(var i=ds.flatten(t),n=0,r=i.length;n<r;n++)i[n]=Number(i[n]||0),isNaN(i[n])&&(i.splice(n,1),n--,r--);this._section=Rs(i)}},{key:"_setDataSection",value:function(t){var e=1;return ds.each(t,function(t){ds.isArray(t)&&t.length>1&&(e=2)}),1==e?this._oneDimensional(t):2==e?this._twoDimensional(t):void 0}},{key:"_oneDimensional",value:function(t){for(var e=this.getAxisDataFrame(t),i=ds.flatten(e),n=0,r=i.length;n<r;n++)i[n]=i[n]||0;return i}},{key:"_twoDimensional",value:function(t){var e,i=this.getAxisDataFrame(t),n=[];return ds.each(i,function(t,i){if(t.length)if(ds.isArray(t[0])){var r=[],s=t[0].length,o=t.length;for(i=0;i<s;i++){for(var a=0,l=0,h=0,u=0,c=0;c<o;c++)!e&&(e=t[c][i]),e=Math.min(e,t[c][i]),t[c][i]>=0?(a+=t[c][i],l++):(h+=t[c][i],u++);l&&r.push(a),u&&r.push(h)}n.push(r)}else n.push(t)}),n.push(e),ds.flatten(n)}},{key:"getAxisDataFrame",value:function(t){return this._root.dataFrame.getDataOrg(t,function(t){return null==t||""==t?t:isNaN(Number(t))?t:Number(t)})}}]),t}(),Ma=new WeakMap,Pa=function(t){function e(t,i,n,r,s){_classCallCheck(this,e);var o=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n,r,s));return o.origin=new Rt(0,0,0),o.center=new Rt(0,0,0),o.offset=new Rt(0,0,0),o.boundbox=new Xt,o.xAxisAttribute=new La(o._root),o.yAxisAttribute={},o.zAxisAttribute=new La(o._root),o._coordUI=null,o.group.name="cartesian3dSystem",o.init(),o}return _inherits(e,ga),_createClass(e,[{key:"setDefaultOpts",value:function(t){if(this._zSection=[],this.coord={xAxis:{layoutType:"rule",posParseToInt:!1},yAxis:[],zAxis:{enabled:!0,field:"",layoutType:"rule"}},(t=ds.clone(t)).coord.yAxis){var e=[];ds.each(ds.flatten([t.coord.yAxis]),function(t,i){if(t._used=!1,ds.isEmpty(t.name)){if(0!=i)return;t.name="default_axis_for_Y"}e.push(ds.clone(t))}),t.coord.yAxis=e}else t.coord.yAxis=[];var i=function(e){var i=null;return t.coord.yAxis&&ds.each(ds.flatten([t.coord.yAxis]),function(t){t.name==e&&(t._used=!0,i=t)}),i};if(t.graphs)for(var n=0;n<t.graphs.length;n++){var r=t.graphs[n];if(this._zSection.push(r.field.toString()),"bar3d"==r.type&&(this.coord.xAxis.layoutType="peak",this.coord.zAxis.layoutType="peak"),r.field){var s=r.yAxisName;r.yAxisName||(s="default_axis_for_Y");var o=i(s);if(o)ds.isEmpty(o.field)&&(o.field=[]),ds.isArray(o.field)?ds.isArray(r.field)?o.field=o.field.concat(r.field):o.field.push(r.field):ds.isArray(r.field)?o.field=[o.field].concat(r.field):o.field=[o.field].push(r.field);else{var a={field:[],name:s,_used:!0};ds.isArray(r.field)?a.field=a.field.concat(r.field):a.field.push(r.field),t.coord.yAxis.push(a)}}else t.graphs.splice(n--,1)}for(n=0;n<t.coord.yAxis.length;n++)t.coord.yAxis[n].layoutType||(t.coord.yAxis[n].layoutType="proportion"),(ds.isEmpty(t.coord.yAxis[n].field)||0==t.coord.yAxis[n]._used)&&t.coord.yAxis.splice(n--,1),t.coord.yAxis[n]&&delete t.coord.yAxis[n]._used;return t}},{key:"init",value:function(){var t=this,e=ds.clone(this.coord);try{e.xAxis.field?this.xAxisAttribute.setField(e.xAxis.field):console.error("Xfield,coord.xAxis.field");var i=ds.flatten(this.xAxisAttribute.data);"proportion"==this.coord.xAxis.layoutType&&(1==i.length&&(i.push(0),i.push(2*i[0])),i=i.sort(function(t,e){return t-e}),i=Rs(i)),i=ds.uniq(i),this.xAxisAttribute.setOrgSection(i),e.xAxis.dataSection&&this.xAxisAttribute.setCustomSection(e.xAxis.dataSection);var n=[];e.yAxis.forEach(function(t){t.field.forEach(function(t){ds.isArray(t)?t.forEach(function(t){n.push(t)}):n.push(t)})});var r={},s=this._root.getTheme.bind(this._root);n.forEach(function(t,e){var i=s(e);r[t]=i});var o=0,a=1/0;for(var l in e.yAxis.forEach(function(e){var i=t.yAxisAttribute[e.name];i||(i=new La(t._root),t.yAxisAttribute[e.name]=i,Ma.set(t.yAxisAttribute[e.name],e)),i.setField(e.field);var n=i.data,s=[];if(1!=n.length||ds.isArray(n[0])||s.push(2*n[0]),"proportion"==e.layoutType)i.computeDataSection(s);else{var l=ds.flatten(i.data);i.setOrgSection(l)}e.dataSection&&(a=Math.min(a,e.dataSection.length),i.setCustomSection(e.dataSection)),i.setColors(r),o=Math.max(o,i.getSection().length)}),o=a===1/0?o:a,this.yAxisAttribute){var h=this.yAxisAttribute[l].getSection(),u=(h[h.length-1]-h[0])/(o-1);if(u>1&&(u=Math.ceil(u)),h.length!==o){for(var c=[],d=0;d<o;d++)c.push(h[0]+d*u);this.yAxisAttribute[l].setCustomSection(c)}}if(e.zAxis.field){this.zAxisAttribute.setField(e.zAxis.field);i=ds.flatten(this.zAxisAttribute.data);"proportion"==this.coord.zAxis.layoutType&&(1==i.length&&(i.push(0),i.push(2*i[0])),i=i.sort(function(t,e){return t-e}),i=Rs(i)),i=ds.uniq(i),this.zAxisAttribute.setOrgSection(i)}else this.zAxisAttribute.setOrgSection(this._zSection);e.zAxis.dataSection&&this.zAxisAttribute.setCustomSection(e.zAxis.dataSection)}catch(t){console.error("!",t)}this.getBoundbox(),this.addLights()}},{key:"getYAxis",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default_axis_for_Y",e=this.yAxisAttribute[t];return e||(t=this.coord.yAxis[0].name,e=this.yAxisAttribute[t]),{attr:e,opts:Ma.get(e)}}},{key:"getBoundbox",value:function(){var t=_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getBoundbox",this).call(this),i=this.offset.clone();return this.baseBoundbox=t,this.boundbox.min.set(0,0,0),this.boundbox.max.set(t.max.x-t.min.x-i.x,t.max.y-t.min.y-i.y,t.max.z-t.min.z-i.z),this._root.opt.coord.zAxis&&this._root.opt.coord.zAxis.depth&&(this.boundbox.max.z=this._root.opt.coord.zAxis.depth),this.center=this.boundbox.getCenter(),this.center.setZ(-this.center.z),this.boundbox}},{key:"getRatioPixelToWorldByOrigin",value:function(t){var i=_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getBoundbox",this).call(this);return void 0===t&&(t=i.min.clone()).setZ(i.max.z),this._root.renderView.getVisableSize(t).ratio}},{key:"updateOrigin",value:function(t){this.offset=t.clone(),this.boundbox=this.getBoundbox(),this.setWorldOrigin(),this.updatePosition()}},{key:"updatePosition",value:function(){var t=this.center.clone();t=this._getWorldPos(t);var e=this._root.renderView,i=e._camera,n=i.position.distanceTo(t),r=It.degToRad(e.controls.alpha),s=It.degToRad(e.controls.beta),o=n*Math.sin(r),a=n*Math.cos(r),l=a*Math.sin(s),h=a*Math.cos(s),u=new Rt(l,o,h);u.add(t),i.position.copy(u),i.lookAt(t),this._root.orbitControls.target.copy(t)}},{key:"addLights",value:function(){var t=new Qr(16777215,.8);this._root.rootStage.add(t);var e=this.center.clone();e=this._getWorldPos(e);var i=[],n=new Rt(-1,-1,1);i[0]=new Zr(13421772,.8),n.multiplyScalar(1e4),i[0].position.copy(n),i[0].target.position.copy(e),this._root.rootStage.add(i[0]),i[1]=new Zr(13421772,.8),(n=new Rt(1,-1,1)).multiplyScalar(1e4),i[1].position.copy(n),i[1].target.position.copy(e),this._root.rootStage.add(i[1])}},{key:"setWorldOrigin",value:function(){var t=_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getBoundbox",this).call(this),i=this.offset.clone(),n=t.min.clone();n.setZ(t.max.z),n.add(i),this.group.position.copy(n)}},{key:"getOrigin",value:function(){return this.origin.clone()}},{key:"initCoordUI",value:function(){this._coordUI=new Aa(this),this.group.add(this._coordUI.group)}},{key:"drawUI",value:function(){_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"drawUI",this).call(this),this._coordUI.draw()}},{key:"getXAxisPosition",value:function(t){var e=0,i=this.boundbox.max.x-this.boundbox.min.x,n=this.xAxisAttribute.getSection().length,r=ds.indexOf(this.xAxisAttribute.getSection(),t),s=this.coord.xAxis.layoutType;if(1==n)e=i/2;else if("rule"==s&&(e=r/(n-1)*i),"proportion"==s&&(e=i*((t-minVal)/(maxVal-minVal))),"peak"==s){var o=i/n;e=o*(r+1)-o/2}return isNaN(e)&&(e=0),e}},{key:"getYAxisPosition",value:function(t,e){var i=0,n=this.boundbox.max.y-this.boundbox.min.y,r=e.getSection().length,s=ds.indexOf(e.getSection(),t),o=ds.find(this.coord.yAxis,function(t){return!t.align||"left"==t.align}).layoutType,a=Math.max.apply(null,e.getSection()),l=Math.min.apply(null,e.getSection());if(1==r)i=n/2;else if("rule"==o&&(i=s/(r-1)*n),"proportion"==o&&(i=n*((t-l)/(a-l))),"peak"==o){var h=n/r;i=h*(s+1)-h/2}return isNaN(i)&&(i=0),i}},{key:"getZAxisPosition",value:function(t){var e=0,i=this.boundbox.max.z-this.boundbox.min.z,n=this.zAxisAttribute.getSection().length,r=ds.indexOf(this.zAxisAttribute.getSection(),t),s=this.coord.zAxis.layoutType;if(1==n)e=i/2;else if("rule"==s&&(e=r/(n-1)*i),"proportion"==s&&(e=i*((t-minVal)/(maxVal-minVal))),"peak"==s){var o=i/n;e=o*(r+1)-o/2}return isNaN(e)&&(e=0),e}},{key:"getCeilSize",value:function(){var t=new Rt,e=this.boundbox.getSize(),i=this.xAxisAttribute.getSection().length,n=this.getYAxis().attr.getSection().length,r=this.zAxisAttribute.getSection().length;return"peak"==this.coord.xAxis.layoutType?t.setX(e.x/i):t.setX(e.x/(i+1)),t.setY(e.y/(n+1)),"peak"==this.coord.zAxis.layoutType?t.setZ(e.z/r):t.setZ(e.z/(r+1)),t}},{key:"positionToScreen",value:function(t){return Ea.call(this,t)}},{key:"dispose",value:function(){this._coordUI.dispose()}}]),e}(),Ea=function(){var t=new Ht;return function(e){var i=this._root.renderView._camera,n=.5*this._root.width,r=.5*this._root.height,s=this.group.localToWorld(e);return s.project(i,t),s.x=s.x*n+n,s.y=-s.y*r+r,s}}(),Ta=function(t){function e(t,i){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.currCoord));return n.type="bar3d",n.node={shapeType:"cube",materialType:"phong",fillStyle:null},n.label={enabled:!1,animation:!0,fontColor:null,fontSize:12,format:null,lineWidth:0,strokeStyle:null,rotation:0,align:"center",verticalAlign:"bottom",position:"top",offsetX:0,offsetY:0},n.proportion=!1,n.allGroupNum=1,ds.extend(!0,n,i),n.materialMap=new Map,n.init(),n}return _inherits(e,jo),_createClass(e,[{key:"init",value:function(){this.barsGroup=this._root.app.addGroup({name:"bars_gruop"})}},{key:"computePos",value:function(){var t=this,e=[],i=[];ds.isArray(this.field)?e=this.field.slice(0):e.push(this.field),this.allGroupNum=e.length;var n=this._coordSystem.zAxisAttribute.getOrgSection(),r=this._coordSystem.zAxisAttribute.getCustomSection();this.drawPosData=[];var s=this._coordSystem.xAxisAttribute.data,o=this._coordSystem.getYAxis(this.yAxisName).attr;o.data;1==s.length&&(s=ds.flatten(s));var a=[];a=o.getData(this.field),this._coordSystem.coord.zAxis.dataSection&&(i=i.concat(this._coordSystem.coord.zAxis.dataSection));var l=[],h=function(){this.isStack=!1,this.value=null,this.stackValue=null,this.floor=0,this.level=0,this.field="",this.group=null};s.forEach(function(i,s){l=[],a.forEach(function(o,a){var u=e[a],c=function(t){var e=-1,i="";return ds.each(n,function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=arguments[1];-1!==r.indexOf(t)&&(e=s,i=n[s])}),r.length?r[e]:i}(e.toString());if(o.length>1)o.forEach(function(e,n){var r=ds.flatten(e).slice(0),o=u[n];r.forEach(function(e,r){if(r===s){var u=new h;u.floor=n,u.level=a+n,u.field=o,u.group=a+1,n>0?(u.isStack=!0,u.value=new Rt(i,e,c),u.stackValue=new Rt(i,l[r],c)):(u.isStack=!0,u.stackValue=new Rt(i,0,c),u.value=new Rt(i,e,c)),t.drawPosData.push(u)}}),ds.flatten(e).slice(0).forEach(function(t,e){l[e]=(l[e]||0)+t})});else{var d=new h;d.field=u,d.group=a+1,ds.flatten(o).slice(0).forEach(function(e,n){n===s&&(d.value=new Rt(i,e,c),t.drawPosData.push(d))})}})})}},{key:"getMaterial",value:function(t){var e=null;switch(this.node.materialType){case"phong":e=qr;break;case"lambert":e=Hr;break;case"base":e=lr;break;default:e=qr}return new e({color:this._getColor(this.node.fillStyle,t),transparent:!0,opacity:1,depthTest:!0,depthWrite:!0,side:W})}},{key:"draw",value:function(){var t=this,e=this,i=this._root.app;this.computePos();var n=this._coordSystem.getYAxis(this.yAxisName).attr,r=this._coordSystem.getCeilSize(),s=this._coordSystem.getXAxisPosition.bind(this._coordSystem),o=this._coordSystem.getYAxisPosition.bind(this._coordSystem),a=this._coordSystem.getZAxisPosition.bind(this._coordSystem),l=r.x/this.allGroupNum*.7,h=.7*r.z,u=1;this.drawPosData.forEach(function(c){var d=new Rt,f=new Rt;d.setX(s(c.value.x)),d.setY(o(c.value.y,n)),d.setZ(a(c.value.z));var p=r.x/(2*t.allGroupNum)*.9,v=2*(c.group-1)+1;f.setX(d.x+(p*v-.5*r.x*.9)-.5*l),"cylinder"==t.node.shapeType||"cone"==t.node.shapeType?f.setZ(-d.z+.5*l):f.setZ(-d.z+.5*h),c.isStack?f.setY(o(c.stackValue.y,n)):f.setY(0),u=Math.max(Math.abs(d.y),.01);var y=e.getMaterial(c),m=null;if("cone"==t.node.shapeType){m=i.createCone(l,u,h,y);var g=(new Xt).setFromObject(m);f.x+=g.getCenter().x}else if("cylinder"==t.node.shapeType){m=i.createCylinder(l,u,h,y);var _=(new Xt).setFromObject(m);f.x+=_.getCenter().x}else m=i.createBox(l,u,h,y);m.position.copy(f);var x=c.value,b=x.x,w=x.y,k=x.z,S=f.x,C=f.y,A=f.z;m.userData.info={title:k,value:{x:b,y:w,z:k},pos:{x:S,y:C,z:A},color:t._getColor(t.node.fillStyle,c)},t.group.add(m),m.on("mouseover",function(t){e.onMouseOver.call(this),e._root.fire({type:"tipShow",event:t.event,data:this.userData.info})}),m.on("mouseout",function(t){e.onMouseOut.call(this),e._root.fire({type:"tipHide",event:t.event,data:this.userData.info})}),m.on("mousemove",function(t){e._root.fire({type:"tipMove",event:t.event,data:this.userData.info})}),m.on("click",t.onClick)})}},{key:"onMouseOver",value:function(t){this.userData.color=this.material.color.clone();var e={};this.material.color.getHSL(e),this.material.setValues({color:(new Nt).setHSL(e.h,e.s,e.l+.1)})}},{key:"onMouseOut",value:function(){$("#target").hide(),this.material.setValues({color:this.userData.color})}},{key:"onClick",value:function(t){}},{key:"_getColor",value:function(t,e){var i=this._coordSystem.getYAxis(this.yAxisName).attr.getColor(e.field);return ds.isString(t)&&(i=t),ds.isArray(t)&&(i=ds.flatten(t)[ds.indexOf(_flattenField,field)]),ds.isFunction(t)&&(i=t.apply(this,[rectData])),i}},{key:"dispose",value:function(){var t=this;this.materialMap.clear(),this.group.traverse(function(e){e.has("click",t.onClick)&&e.off("click",t.onClick),e.has("mouseover",t.onMouseOver)&&e.off("mouseover",t.onMouseOver),e.has("mouseout",t.onMouseOut)&&e.off("mouseout",t.onMouseOut)}),_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"dispose",this).call(this)}}]),e}(),Oa=function(t){function e(t,i){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.currCoord));return n.type="line3d",n.line={enabled:1,shapeType:"brokenLine",strokeStyle:"#ccc",lineWidth:2,lineType:"solid",smooth:!0},n.icon={enabled:1,shapeType:"circle",corner:!1,radius:3,fillStyle:"#ffffff",strokeStyle:null,lineWidth:2},n.area={enabled:1,fillStyle:null,alpha:.3},ds.extend(!0,n,i),n.init(),n}return _inherits(e,jo),_createClass(e,[{key:"init",value:function(){}},{key:"_getColor",value:function(t,e){var i=this._coordSystem.getYAxis(this.yAxisName).attr.getColor(e.field);return ds.isString(t)&&(i=t),ds.isArray(t)&&(i=ds.flatten(t)[ds.indexOf(_flattenField,field)]),ds.isFunction(t)&&(i=t.apply(this,[rectData])),i}},{key:"computePos",value:function(){var t=this,e=[],i=[];ds.isArray(this.field)?e=this.field.slice(0):e.push(this.field);var n=this._coordSystem.zAxisAttribute.getOrgSection(),r=this._coordSystem.zAxisAttribute.getCustomSection();this.drawPosData=[];var s=this._coordSystem.xAxisAttribute.data,o=this._coordSystem.getYAxis(this.yAxisName).attr;o.data;1==s.length&&(s=ds.flatten(s));var a=[];a=o.getData(this.field),this._coordSystem.coord.zAxis.dataSection&&(i=i.concat(this._coordSystem.coord.zAxis.dataSection));var l=[],h=function(){this.isStack=!1,this.value=null,this.stackValue=null,this.floor=0,this.level=0,this.field=""},u=function(i){s.forEach(function(n,r){l=[],a.forEach(function(s,o){var a=e[o];if(s.length>1)s.forEach(function(e,s){var u=ds.flatten(e).slice(0),c=a[s];u.forEach(function(e,a){if(a===r){var u=new h;u.floor=s,u.level=o+s,u.field=c,s>0?(u.isStack=!0,u.value=new Rt(n,e,i),u.stackValue=new Rt(n,l[a],i)):(u.isStack=!0,u.stackValue=new Rt(n,0,i),u.value=new Rt(n,e,i)),t.drawPosData.push(u)}}),ds.flatten(e).slice(0).forEach(function(t,e){l[e]=(l[e]||0)+t})});else{var u=new h;u.field=a,ds.flatten(s).slice(0).forEach(function(e,s){s===r&&(u.value=new Rt(n,e,i),t.drawPosData.push(u))})}})})},c=e.toString();if(ds.isEmpty(t._coordSystem.zAxisAttribute.field)){var d=function(t){var e=-1,i="";return ds.each(n,function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=arguments[1];-1!==r.indexOf(t)&&(e=s,i=n[s])}),r.length?r[e]:i}(c);u(d)}else n.forEach(function(t){u(t)})}},{key:"draw",value:function(){var t=this,e=this,i=this._root.app,n={};this.computePos();var r=this._coordSystem.getYAxis(this.yAxisName).attr,s=this._coordSystem.getCeilSize(),o=this._coordSystem.getXAxisPosition.bind(this._coordSystem),a=this._coordSystem.getYAxisPosition.bind(this._coordSystem),l=this._coordSystem.getZAxisPosition.bind(this._coordSystem);s.x,s.z;this.drawPosData.forEach(function(t){var i=new Rt,s=new Rt;i.setX(o(t.value.x)),i.setY(a(t.value.y,r)),i.setZ(l(t.value.z)),ds.isEmpty(e._coordSystem.zAxisAttribute.field)?n[t.field]=n[t.field]||[]:n[t.value.z]=n[t.value.z]||[],t.isStack?(s.setX(i.x),s.setY(a(t.stackValue.y+t.value.y,r)),s.setZ(-i.z)):(s.setX(i.x),s.setY(i.y),s.setZ(-i.z)),ds.isEmpty(e._coordSystem.zAxisAttribute.field)?n[t.field].push(s):n[t.value.z].push(s)});var h=function(r){var s=t._getColor(null,{field:r})||"red",o=null;e.line.smooth?o=new cs(n[r]).getSpacedPoints(200):o=n[r];var a=i.createBrokenLine(o,2,s,!0);t.group.add(a);var l=[];o.forEach(function(t){l=l.concat(t.toArray())}),l.unshift(l[0],0,l[2]),l.push(l[3*(o.length-1)],0,l[3*(o.length-1)+2]);var h=i.createPolygonPlane(l,{fillStyle:s});t.group.add(h),n[r].forEach(function(e){var n=i.createCirclePlane(10,{fillStyle:s});n.position.copy(e),t.group.add(n)})};for(var u in n)h(u)}}]),e}(),Da=function(t){function e(t,i){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.currCoord));return n.tipDomContainer=t.domView,n.cW=t.width,n.cH=t.height,n.dW=0,n.dH=0,n.borderRadius="5px",n.sprite=null,n.content=null,n.fillStyle="rgba(255,255,255,0.95)",n.fontColor="#999",n.strokeStyle="#ccc",n.position="right",n._tipDom=null,n.offsetX=10,n.offsetY=10,n.eventInfo=null,n.positionInRange=!0,n.enabled=!0,n.pointer="line",n.pointerAnim=!0,n._tipsPointer=null,ds.extend(!0,n,i),n.group.on("removed",function(){n._tipDom=null}),console.log("tips component loaded!"),n}return _inherits(e,jo),_createClass(e,[{key:"show",value:function(t){this.enabled&&(t.eventInfo&&(this.eventInfo=t.eventInfo,this._setContent(t)?this._setPosition(t):this.hide()))}},{key:"move",value:function(t){if(this.enabled){if(t.eventInfo)this.eventInfo=t.eventInfo,this._setContent(t)?this._setPosition(t):this._hideDialogTips();this._tipsPointerMove(t)}}},{key:"hide",value:function(){this.enabled&&this._hideDialogTips()}},{key:"_hideDialogTips",value:function(){this.eventInfo&&(this.eventInfo=null,this._removeContent())}},{key:"_setPosition",value:function(t){if(this.enabled&&this._tipDom){var e=t.pos,i=this._checkX(e.x+this.offsetX),n=this._checkY(e.y+this.offsetY);this._tipDom.style.cssText+=";visibility:visible;left:"+i+"px;top:"+n+"px;-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;","left"==this.position&&(this._tipDom.style.left=this._checkX(e.x-this.offsetX-this._tipDom.offsetWidth)+"px")}}},{key:"_creatTipDom",value:function(t){var e=this;e._tipDom=document.createElement("div"),e._tipDom.className="chart-tips",e._tipDom.style.cssText+="-moz-border-radius:"+e.borderRadius+"; -webkit-border-radius:"+e.borderRadius+"; border-radius:"+e.borderRadius+";background:"+e.fillStyle+";border:1px solid "+e.strokeStyle+";visibility:hidden;position:absolute;enabled:inline-block;*enabled:inline;*zoom:1;padding:6px;color:"+e.fontColor+";line-height:1.5",e._tipDom.style.cssText+="; -moz-box-shadow:1px 1px 3px "+e.strokeStyle+"; -webkit-box-shadow:1px 1px 3px "+e.strokeStyle+"; box-shadow:1px 1px 3px "+e.strokeStyle+";",e._tipDom.style.cssText+="; border:none;white-space:nowrap;word-wrap:normal;",e._tipDom.style.cssText+="; text-align:left;",e.tipDomContainer.appendChild(this._tipDom)}},{key:"_removeContent",value:function(){this._tipDom&&(this.tipDomContainer.removeChild(this._tipDom),this._tipDom=null)}},{key:"_setContent",value:function(t){var e=this._getContent(t);if(e||0===e)return this._tipDom||this._creatTipDom(t),this._tipDom.innerHTML=e,this.dW=this._tipDom.offsetWidth,this.dH=this._tipDom.offsetHeight,e}},{key:"_getContent",value:function(t){return this.content?ds.isFunction(this.content)?this.content(t.eventInfo):this.content:this._getDefaultContent(t.eventInfo)}},{key:"_getDefaultContent",value:function(t){var e="";void 0!==t.title&&null!==t.title&&""!==t.title&&(e+="<div style='font-size:14px;border-bottom:1px solid #f0f0f0;padding:4px;margin-bottom:6px;'>"+t.title+"</div>");var i=t.color||t.fillStyle||t.strokeStyle;return e+="<div style='line-height:1.5;font-size:12px;padding:0 4px;'>",i&&(e+="<div style='background:"+i+";margin-right:8px;margin-top:5px;width:8px;height:8px;border-radius:4px;overflow:hidden;font-size:0;'></div>"),ds.each(t.value,function(t,i){e+='<div><span style="margin-right:5px">- '+i+":</span><span>"+t+"</span></div>"}),e+="</div>"}},{key:"_checkX",value:function(t){if(this.positionInRange){var e=this.dW+2;t<0&&(t=0),t+e>this.cW&&(t=this.cW-e)}return t}},{key:"_checkY",value:function(t){if(this.positionInRange){var e=this.dH+2;t<0&&(t=0),t+e>this.cH&&(t=this.cH-e)}return t}},{key:"_tipsPointerShow",value:function(t){var e=this.root._coord;if(e&&"rect"==e.type&&this.pointer){var i=this._tipsPointer,n=e.origin.y-e.height,r=0;"line"==this.pointer&&(r=e.origin.x+t.eventInfo.xAxis.x),"region"==this.pointer&&(r=e.origin.x+t.eventInfo.xAxis.x-e._xAxis.ceilWidth/2,t.eventInfo.xAxis.ind<0&&(r=e.origin.x)),i?this.pointerAnim&&"proportion"!=e._xAxis.layoutType?(i.__animation&&i.__animation.stop(),i.__animation=i.animate({x:r,y:n},{duration:200})):(i.context.x=r,i.context.y=n):("line"==this.pointer&&(i=new Line({context:{x:r,y:n,start:{x:0,y:0},end:{x:0,y:e.height},lineWidth:1,strokeStyle:"#cccccc"}})),"region"==this.pointer&&(i=new Rect({context:{width:e._xAxis.ceilWidth,height:e.height,x:r,y:n,fillStyle:"#cccccc",globalAlpha:.3}})),this.root.graphsSprite.addChild(i,0),this._tipsPointer=i)}}},{key:"_tipsPointerHide",value:function(){var t=this.root._coord;t&&"rect"==t.type&&this.pointer&&this._tipsPointer&&(this._tipsPointer.destroy(),this._tipsPointer=null)}},{key:"_tipsPointerMove",value:function(t){var e=this.root._coord;if(e&&"rect"==e.type&&this.pointer&&this._tipsPointer){var i=this._tipsPointer,n=e.origin.x+t.eventInfo.xAxis.x;"region"==this.pointer&&(n=e.origin.x+t.eventInfo.xAxis.x-e._xAxis.ceilWidth/2,t.eventInfo.xAxis.ind<0&&(n=e.origin.x));var r=e.origin.y-e.height;n!=i.__targetX&&(this.pointerAnim&&"proportion"!=e._xAxis.layoutType?(i.__animation&&i.__animation.stop(),i.__targetX=n,i.__animation=i.animate({x:n,y:r},{duration:200,onComplete:function(){delete i.__targetX,delete i.__animation}})):(i.context.x=n,i.context.y=r))}}}]),e}(),za={box:Pa},Ia={bar3d:Ta,line3d:Oa},Ra={tips3d:Da},Na=[];Na&&Na.length&&O.setGlobalTheme(Na);var Ua={create:function(t,e,i){var n=this,r=null,s=function(){n.instances[r.id]=null,delete n.instances[r.id]},o=E(t).getAttribute("chart_id");if(null!=o){var a=n.instances[o];a&&(a.destroy(),a.off("destroy",s)),delete n.instances[o]}var l=ga;return i.coord&&i.coord.type&&(l=za[i.coord.type]),(r=new l(t,e,i,Ia,Ra))&&(r.draw(),n.instances[r.id]=r,r.on("destroy",s)),r},options:{}};for(var Fa in O)Ua[Fa]=O[Fa];return Ua}();